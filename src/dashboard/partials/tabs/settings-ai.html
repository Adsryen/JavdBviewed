<div class="settings-page" id="ai-settings">
    <div class="settings-page-header">
        <button class="settings-back-btn" data-action="back-to-settings">
            <i class="fas fa-arrow-left"></i> 返回设置
        </button>
        <h2>AI设置</h2>
        <p class="settings-description">配置AI功能，对接New API兼容的AI服务，支持流式对话和多模型选择。</p>
    </div>
    <div class="settings-page-body">
        <!-- 基础配置 -->
        <div class="settings-card settings-section">
            <h4><i class="fas fa-cog"></i> 基础配置</h4>

            <div class="form-group-checkbox">
                <input type="checkbox" id="aiEnabled">
                <label for="aiEnabled">
                    <i class="fas fa-power-off"></i>
                    启用AI功能
                </label>
                <p class="input-description">开启后可以使用AI聊天和智能助手功能。</p>
            </div>

            <div class="form-group">
                <label for="aiApiUrl">
                    <i class="fas fa-link"></i>
                    API服务地址:
                </label>
                <input type="url" id="aiApiUrl" class="text-input"
                       placeholder="https://api.openai.com 或其他兼容服务地址">
                <p class="input-description">支持OpenAI API或One API兼容的服务地址。（不需要加"/v1"）</p>
            </div>

            <div class="form-group">
                <label for="aiApiKey">
                    <i class="fas fa-key"></i>
                    API密钥:
                </label>
                <div class="form-group-inline">
                    <input type="password" id="aiApiKey" class="text-input"
                           placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                    <button type="button" id="toggleApiKeyVisibility" class="btn btn-secondary">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button type="button" id="testAiConnection" class="btn btn-primary">
                        <i class="fas fa-plug"></i>
                        测试连接
                    </button>
                </div>
                <p class="input-description">从AI服务提供商获取的API密钥，用于身份验证。</p>
            </div>

            <div id="aiConnectionStatus" class="connection-status" style="display: none;">
                <!-- 连接状态将在这里显示 -->
            </div>
        </div>

        <!-- 模型选择 -->
        <div class="settings-card settings-section">
            <h4><i class="fas fa-brain"></i> 模型选择</h4>

            <div class="form-group">
                <label for="aiSelectedModel">
                    <i class="fas fa-robot"></i>
                    当前模型:
                </label>
                <div class="form-group-inline">
                    <select id="aiSelectedModel" class="select-input">
                        <option value="">请先配置API并测试连接</option>
                    </select>
                    <button type="button" id="refreshModels" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        刷新
                    </button>
                </div>
                <p class="input-description">选择要使用的AI模型，不同模型有不同的能力和价格。</p>
            </div>

            <div id="modelInfo" class="model-info" style="display: none;">
                <!-- 模型信息将在这里显示 -->
            </div>

            <div id="modelStats" class="model-stats" style="display: none;">
                <!-- 模型统计信息将在这里显示 -->
            </div>
        </div>

        <!-- 测试功能 -->
        <div class="settings-card settings-section">
            <h4><i class="fas fa-vial"></i> 测试功能</h4>

            <div class="form-group">
                <label for="aiTestInput">
                    <i class="fas fa-comment"></i>
                    测试对话:
                </label>
                <div class="form-group-inline">
                    <input type="text" id="aiTestInput" class="text-input"
                           placeholder="输入测试消息，例如：你好">
                    <button type="button" id="sendTestMessage" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i>
                        发送
                    </button>
                </div>
                <p class="input-description">测试AI功能是否正常工作。</p>
            </div>

            <div id="aiTestResult" class="test-result" style="display: none;">
                <!-- 测试结果将在这里显示 -->
            </div>
        </div>

        <!-- 对话参数 -->
        <div class="settings-card settings-section ai-conversation-params">
            <h4><i class="fas fa-cog"></i> 对话参数</h4>

            <div class="params-grid">
                <!-- 输入框类型 -->
                <div class="param-item">
                    <label for="aiTemperature">
                        创造性: <span id="temperatureValue">0.7</span>
                        <i class="fas fa-question-circle param-tooltip" title="控制AI回答的创造性，值越高越有创意，值越低越准确"></i>
                    </label>
                    <input type="range" id="aiTemperature" min="0.1" max="2.0" step="0.1" value="0.7" class="range-input">
                </div>

                <div class="param-item">
                    <label for="aiMaxTokens">
                        最大回复长度
                        <i class="fas fa-question-circle param-tooltip" title="限制AI单次回复的最大长度，1 token ≈ 0.75个英文单词。支持1-1,000,000 tokens"></i>
                    </label>
                    <input type="number" id="aiMaxTokens" class="number-input"
                           min="1" max="1000000" value="2048">
                </div>

                <div class="param-item">
                    <label for="aiTimeout">
                        超时时间 (秒)
                        <i class="fas fa-question-circle param-tooltip" title="API请求的超时时间，建议30-60秒"></i>
                    </label>
                    <input type="number" id="aiTimeout" class="number-input"
                           min="5" max="300" value="30">
                </div>

                <!-- 系统提示词（全宽） -->
                <div class="param-item param-full">
                    <label for="aiSystemPrompt">
                        系统提示词
                        <i class="fas fa-question-circle param-tooltip" title="定义AI的角色和行为方式，影响所有对话的回复风格"></i>
                    </label>
                    <textarea id="aiSystemPrompt" class="textarea-input" rows="2"
                              placeholder="你是一个有用的AI助手，请用中文回答问题。">你是一个有用的AI助手，请用中文回答问题。</textarea>
                </div>

                <!-- 复选框类型 -->
                <div class="param-item param-checkbox">
                    <input type="checkbox" id="aiStreamEnabled" checked>
                    <label for="aiStreamEnabled">
                        启用流式输出
                        <i class="fas fa-question-circle param-tooltip" title="实时显示AI回复内容，类似ChatGPT的打字效果"></i>
                    </label>
                </div>
            </div>
        </div>

        <!-- 高级功能 -->
        <div class="settings-card settings-section">
            <h4><i class="fas fa-tools"></i> 高级功能</h4>

            <div class="form-group">
                <label>
                    <i class="fas fa-cog"></i>
                    设置管理:
                </label>
                <div class="form-group-inline">
                    <button type="button" id="exportAiSettings" class="btn btn-export">
                        <i class="fas fa-download"></i>
                        导出设置
                    </button>
                    <button type="button" id="importAiSettings" class="btn btn-import">
                        <i class="fas fa-upload"></i>
                        导入设置
                    </button>
                    <button type="button" id="clearTestResults" class="btn btn-clear">
                        <i class="fas fa-trash"></i>
                        清除测试结果
                    </button>
                    <button id="resetAiSettings" class="btn btn-reset">
                        <i class="fas fa-undo"></i>
                        重置为默认
                    </button>
                </div>
                <p class="input-description">导出设置用于备份，导入设置用于恢复配置（不包含API密钥）。</p>
            </div>
        </div>
    </div>
</div>
