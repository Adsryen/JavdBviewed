                <div class="settings-container">
                    <!-- 移动端菜单切换按钮 -->
                    <button class="settings-menu-toggle" id="settingsMenuToggle">
                        <i class="fas fa-bars"></i>
                        <span>设置菜单</span>
                    </button>

                    <!-- 设置侧边栏 -->
                    <div class="settings-sidebar" id="settingsSidebar">
                        <div class="settings-nav">
                            <div class="settings-nav-item active" data-section="display-settings">
                                <i class="fas fa-eye"></i>
                                <span>显示设置</span>
                            </div>
                            <div class="settings-nav-item" data-section="enhancement-settings">
                                <i class="fas fa-magic"></i>
                                <span>功能增强</span>
                            </div>
                            <div class="settings-nav-item" data-section="search-engine-settings">
                                <i class="fas fa-search"></i>
                                <span>搜索引擎</span>
                            </div>
                            <div class="settings-nav-item" data-section="ai-settings">
                                <i class="fas fa-robot"></i>
                                <span>AI设置</span>
                            </div>
                            <div class="settings-nav-item" data-section="privacy-settings">
                                <i class="fas fa-shield-alt"></i>
                                <span>隐私保护</span>
                            </div>
                            <div class="settings-nav-item" data-section="webdav-settings">
                                <i class="fas fa-cloud"></i>
                                <span>WebDAV同步</span>
                            </div>
                            <div class="settings-nav-item" data-section="sync-settings">
                                <i class="fas fa-sync-alt"></i>
                                <span>同步设置</span>
                            </div>
                            <div class="settings-nav-item" data-section="drive115-settings">
                                <i class="fas fa-cloud-download-alt"></i>
                                <span>115网盘</span>
                            </div>
                            <div class="settings-nav-item" data-section="emby-settings">
                                <i class="fas fa-film"></i>
                                <span>Emby增强</span>
                            </div>
                            <div class="settings-nav-item" data-section="insights-settings">
                                <i class="fas fa-chart-line"></i>
                                <span>报告（测试中）</span>
                            </div>
                            <div class="settings-nav-item" data-section="log-settings">
                                <i class="fas fa-file-alt"></i>
                                <span>日志设置</span>
                            </div>
                            <div class="settings-nav-item" data-section="advanced-settings">
                                <i class="fas fa-cogs"></i>
                                <span>高级配置</span>
                            </div>
                            <div class="settings-nav-item" data-section="network-test-settings">
                                <i class="fas fa-network-wired"></i>
                                <span>网络测试</span>
                            </div>
                            <div class="settings-nav-item" data-section="global-actions">
                                <i class="fas fa-tools"></i>
                                <span>全局操作</span>
                            </div>
                            <div class="settings-nav-item" data-section="update-settings">
                                <i class="fas fa-sync-alt"></i>
                                <span>检查更新</span>
                            </div>
                        </div>
                    </div>

                    <!-- 设置内容区域 -->
                    <div class="settings-content">
                        <!-- 显示设置 -->
                        <div class="settings-panel active" id="display-settings">
                            <div class="settings-panel-header">
                                <h3>列表显示设置</h3>
                                <p class="settings-description">控制在JavDB网站上访问时，是否自动隐藏符合条件的影片。</p>
                            </div>
                            <div class="settings-panel-body">
                                <h4>番号过滤</h4>
                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="hideViewed">
                                    <label for="hideViewed">隐藏已标记"看过"的影片</label>
                                </div>
                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="hideBrowsed">
                                    <label for="hideBrowsed">隐藏已浏览详情页的影片</label>
                                </div>
                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="hideVR">
                                    <label for="hideVR">隐藏所有VR影片</label>
                                </div>
                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="hideWant">
                                    <label for="hideWant">隐藏想看的影片</label>
            </div>
<!-- 演员过滤（列表） -->
            <div class="settings-subsection">
                <h4>演员过滤（列表）</h4>
                <p class="settings-description">基于本地演员库与订阅信息，近似识别标题中的演员并进行过滤。(通过标题识别，故存在一定误差)</p>
                <p class="settings-description" style="margin-top: 4px;">
                    说明：以下三项属于<b>功能增强（列表增强）</b>相关开关，JSON配置也不归入“列表显示设置”内。
                </p>
                <div class="form-group-checkbox">
                    <input type="checkbox" id="hideBlacklistedActorsInList">
                    <label for="hideBlacklistedActorsInList">隐藏含黑名单演员的作品</label>
                </div>
                <div class="form-group-checkbox">
                    <input type="checkbox" id="hideNonFavoritedActorsInList">
                    <label for="hideNonFavoritedActorsInList">隐藏未收藏演员的作品（标题近似匹配）</label>
                </div>
                <div class="form-group-checkbox">
                    <input type="checkbox" id="treatSubscribedAsFavorited">
                    <label for="treatSubscribedAsFavorited">订阅视为收藏</label>
            </div>
        </div>
    </div>
</div>
                        <div class="settings-panel" id="search-engine-settings">
                            <div class="settings-panel-header">
                                <h3>搜索引擎设置</h3>
                                <p class="settings-description">自定义点击番号后跳转的搜索网站。使用 <code>{{ID}}</code> 作为番号占位符。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="search-engine-header">
                                    <div class="engine-icon">图标</div>
                                    <div class="engine-name">搜索引擎名称</div>
                                    <div class="engine-url">URL模板</div>
                                    <div class="engine-icon-url">图标地址</div>
                                    <div class="engine-actions">操作</div>
                                </div>
                                <div id="search-engine-list">
                                    <!-- 搜索引擎列表将由 JS 动态填充 -->
                                </div>
                                <button id="add-search-engine" class="button-like">
                                    <i class="fas fa-plus"></i> 添加新的搜索引擎
                                </button>
                            </div>
                        </div>

                        <!-- WebDAV设置 -->
                        <div class="settings-panel" id="webdav-settings">
                            <div class="settings-panel-header">
                                <h3>WebDAV 设置</h3>
                                <p class="settings-description">通过WebDAV协议，将您的观看记录备份到兼容的云存储服务（如：坚果云、Nextcloud等）。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="webdav-controls-container">
                                    <!-- 主开关 -->
                                    <div class="webdav-controls-row webdav-main-control">
                                        <div class="form-group-checkbox webdav-enable-control">
                                            <input type="checkbox" id="webdavEnabled">
                                            <label for="webdavEnabled">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                启用 WebDAV 同步
                                            </label>
                                        </div>
                                    </div>

                                    <!-- 子控件区域 -->
                                    <div class="webdav-sub-controls" id="webdavSubControls">
                                        <!-- 自动同步设置 -->
                                        <div class="webdav-section">
                                            <div class="webdav-section-header">
                                                <i class="fas fa-cog"></i>
                                                <span>同步设置</span>
                                            </div>
                                            <div class="webdav-section-content">
                                                <div class="form-group-checkbox webdav-auto-control">
                                                    <input type="checkbox" id="webdavAutoSync">
                                                    <label for="webdavAutoSync">
                                                        <i class="fas fa-sync-alt"></i>
                                                        自动上传
                                                    </label>
                                                </div>

                                                <div class="webdav-inline-controls">
                                                    <div class="form-group-inline webdav-interval-control">
                                                        <label for="webdav-sync-interval">
                                                            <i class="fas fa-clock"></i>
                                                            同步间隔:
                                                        </label>
                                                        <input type="number" id="webdav-sync-interval" class="number-input" min="1" max="1440" value="30">
                                                        <span class="input-suffix">分钟</span>
                                                    </div>

                                                    <div class="form-group-inline webdav-retention-control">
                                                        <label for="webdav-retention-days">
                                                            <i class="fas fa-trash-alt"></i>
                                                            保留备份:
                                                        </label>
                                                        <input type="number" id="webdav-retention-days" class="number-input" min="0" max="3650" value="7">
                                                        <span class="input-suffix">天</span>
                                                    </div>

                                                    <div class="form-group-inline webdav-warning-control">
                                                        <label for="webdav-warning-days">
                                                            <i class="fas fa-exclamation-triangle"></i>
                                                            预警阈值:
                                                        </label>
                                                        <input type="number" id="webdav-warning-days" class="number-input" min="0" max="3650" value="7">
                                                        <span class="input-suffix">天</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 备份数据范围 -->
                                        <div class="webdav-section">
                                            <div class="webdav-section-header">
                                                <i class="fas fa-database"></i>
                                                <span>备份数据范围</span>
                                            </div>
                                            <div class="webdav-section-content">
                                                <p class="webdav-section-description">选择要备份到云端的数据类型</p>
                                                <div class="webdav-data-range-options">
                                                    <div class="form-group-checkbox">
                                                        <input type="checkbox" id="webdavBackupCoreData" checked>
                                                        <label for="webdavBackupCoreData">
                                                            <i class="fas fa-database"></i>
                                                            核心数据
                                                            <span class="checkbox-description">观看记录、用户资料</span>
                                                        </label>
                                                    </div>
                                                    <div class="form-group-checkbox">
                                                        <input type="checkbox" id="webdavBackupActorData" checked>
                                                        <label for="webdavBackupActorData">
                                                            <i class="fas fa-users"></i>
                                                            演员数据
                                                            <span class="checkbox-description">演员库、演员订阅</span>
                                                        </label>
                                                    </div>
                                                    <div class="form-group-checkbox">
                                                        <input type="checkbox" id="webdavBackupNewWorksData">
                                                        <label for="webdavBackupNewWorksData">
                                                            <i class="fas fa-star"></i>
                                                            新作品数据
                                                            <span class="checkbox-description">新作品订阅和记录</span>
                                                        </label>
                                                    </div>
                                                    <div class="form-group-checkbox">
                                                        <input type="checkbox" id="webdavBackupSystemConfig" checked>
                                                        <label for="webdavBackupSystemConfig">
                                                            <i class="fas fa-cog"></i>
                                                            系统配置
                                                            <span class="checkbox-description">拓展设置、域名配置、搜索引擎等</span>
                                                        </label>
                                                    </div>
                                                    <div class="form-group-checkbox">
                                                        <input type="checkbox" id="webdavBackupLogsData">
                                                        <label for="webdavBackupLogsData">
                                                            <i class="fas fa-file-alt"></i>
                                                            日志数据
                                                            <span class="checkbox-description">操作日志</span>
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div id="webdav-fields-container">
                                    <div class="form-group" data-subtab="list">
                                        <label for="webdavUrl">WebDAV 地址:</label>
                                        <input type="text" id="webdavUrl" placeholder="例如: https://dav.jianguoyun.com/dav/" style="width: 100%; max-width: none; box-sizing: border-box;">
                                    </div>
                                    <div class="form-group" data-subtab="video">
                                        <label for="webdavUser">用户名:</label>
                                        <input type="text" id="webdavUser" style="width: 100%; max-width: none; box-sizing: border-box;">
                                    </div>
                                    <div class="form-group" data-subtab="video">
                                        <label for="webdavPass">密码/应用密钥:</label>
                                        <div class="password-input-container" style="position: relative; display: block; width: 100%;">
                                            <input type="password" id="webdavPass" style="width: 100%; max-width: none; padding-right: 45px; box-sizing: border-box;">
                                            <button type="button" id="toggleWebdavPasswordVisibility" class="toggle-password-btn" title="显示/隐藏密码" style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: transparent; border: none; cursor: pointer; padding: 6px; color: #64748b; z-index: 1000; display: flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 3px;">
                                                <i class="fas fa-eye" style="font-size: 14px; line-height: 1;"></i>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="button-group">
                                        <button type="button" id="saveWebdavSettings">保存设置</button>
                                        <button type="button" id="testWebdavConnection">测试连接</button>
                                        <button type="button" id="diagnoseWebdavConnection">诊断连接</button>
                                    </div>
                                    <div class="form-group" data-subtab="video">
                                        <p>上次同步: <span id="last-sync-time">从未</span></p>
                                    </div>
                                </div>

                                <div id="fileListContainer" class="settings-section hidden">
                                    <h4>云端文件列表 (点击恢复)</h4>
                                    <ul id="fileList"></ul>
                                </div>
                            </div>
                        </div>

                        <!-- 同步设置 -->
                        <div class="settings-panel" id="sync-settings">
                            <div class="settings-panel-header">
                                <h3>同步设置</h3>
                                <p class="settings-description">配置从JavDB同步观看记录、想看列表和演员数据的URL地址和行为参数。</p>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 视频数据同步配置 -->
                                <div class="form-section">
                                    <h4>视频数据同步配置</h4>
                                    <p class="section-description">配置观看记录和想看列表的同步URL地址，页码参数将由程序自动添加。</p>

                                    <div class="form-group" data-subtab="list">
                                        <label for="dataSyncWantWatchUrl">想看列表URL:</label>
                                        <input type="url" id="dataSyncWantWatchUrl" class="text-input" placeholder="https://javdb.com/users/want_watch_videos">
                                        <p class="input-description">想看视频列表的URL地址，程序会自动添加页码参数。</p>
                                    </div>

                                    <div class="form-group" data-subtab="list">
                                        <label for="dataSyncWatchedVideosUrl">已看列表URL:</label>
                                        <input type="url" id="dataSyncWatchedVideosUrl" class="text-input" placeholder="https://javdb.com/users/watched_videos">
                                        <p class="input-description">已观看视频列表的URL地址，程序会自动添加页码参数。</p>
                                    </div>

                                </div>

                                <!-- 演员数据同步配置 -->
                                <div class="form-section">
                                    <h4>演员数据同步配置</h4>
                                    <p class="section-description">配置演员数据同步的行为和URL地址。</p>

                                    <div class="form-group" data-subtab="video">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="actorSyncEnabled">
                                            <span class="checkmark"></span>
                                            启用演员同步功能
                                        </label>
                                        <p class="input-description">开启后可以从JavDB同步收藏演员数据到本地。</p>
                                    </div>

                                    <div class="form-group" data-subtab="actor">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="actorAutoSync">
                                            <span class="checkmark"></span>
                                            自动同步演员数据
                                        </label>
                                        <p class="input-description">定期自动同步演员数据，避免手动操作。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncInterval">演员同步间隔 (分钟):</label>
                                        <input type="number" id="actorSyncInterval" class="number-input" min="60" max="10080" value="1440">
                                        <p class="input-description">自动同步演员数据的时间间隔，建议设置为24小时(1440分钟)或更长。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncCollectionUrl">收藏演员URL:</label>
                                        <input type="url" id="actorSyncCollectionUrl" class="text-input" placeholder="https://javdb.com/users/collection_actors">
                                        <p class="input-description">收藏演员列表的URL地址，程序会自动添加页码参数。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncDetailUrl">演员详情URL模板:</label>
                                        <input type="text" id="actorSyncDetailUrl" class="text-input" placeholder="https://javdb.com/actors/{{ACTOR_ID}}">
                                        <p class="input-description">演员详情页的URL模板，{{ACTOR_ID}}将被替换为实际的演员ID。</p>
                                    </div>
                                </div>

                                <!-- 通用同步行为配置 -->
                                <div class="form-section">
                                    <h4>通用同步行为配置</h4>
                                    <p class="section-description">配置所有数据同步时的请求间隔和批量处理设置。</p>

                                    <div class="form-group">
                                        <label for="dataSyncRequestInterval">请求间隔 (秒):</label>
                                        <input type="number" id="dataSyncRequestInterval" class="number-input" min="1" max="60" value="3">
                                        <p class="input-description">每次请求之间的间隔时间，建议至少3秒以缓解服务器压力。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="dataSyncBatchSize">批量处理大小:</label>
                                        <input type="number" id="dataSyncBatchSize" class="number-input" min="10" max="100" value="20">
                                        <p class="input-description">每批处理的视频数量，建议设置为20-50之间。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="dataSyncMaxRetries">最大重试次数:</label>
                                        <input type="number" id="dataSyncMaxRetries" class="number-input" min="1" max="10" value="3">
                                        <p class="input-description">网络请求失败时的最大重试次数。</p>
                                    </div>
                                    <div class="form-group">
                                        <label for="actorSyncRequestInterval">演员同步请求间隔 (秒):</label>
                                        <input type="number" id="actorSyncRequestInterval" class="number-input" min="3" max="60" value="3">
                                        <p class="input-description">演员详情页请求间隔，建议至少3秒以缓解服务器压力。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncBatchSize">演员批量处理大小:</label>
                                        <input type="number" id="actorSyncBatchSize" class="number-input" min="10" max="50" value="20">
                                        <p class="input-description">每批处理的演员数量，通常一页包含20个演员。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncMaxRetries">演员同步最大重试次数:</label>
                                        <input type="number" id="actorSyncMaxRetries" class="number-input" min="1" max="10" value="3">
                                        <p class="input-description">演员数据获取失败时的最大重试次数。</p>
                                    </div>
                                </div>

                                <!-- 测试功能 -->
                                <div class="form-section">
                                    <h4>测试功能</h4>
                                    <p class="section-description">测试同步配置是否正确。</p>

                                    <div class="button-group">
                                        <button type="button" id="testActorSyncConnection" class="button-like" style="background-color: #17a2b8;">
                                            <i class="fas fa-network-wired"></i>
                                            测试演员同步连接
                                        </button>
                                        <button type="button" id="testActorSyncParsing" class="button-like" style="background-color: #28a745;">
                                            <i class="fas fa-code"></i>
                                            测试演员数据解析
                                        </button>
                                    </div>

                                    <div id="actorSyncTestResults" class="test-results" style="margin-top: 15px;"></div>
                                </div>

                                <!-- 保存按钮 -->
                                <div class="form-section">
                                    <div class="button-group">
                                        <button type="button" id="saveSyncSettings" class="button-like">
                                            <i class="fas fa-save"></i>
                                            保存同步设置
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>




                        <!-- 隐私保护 -->
                        <div class="settings-panel" id="privacy-settings">
                            <div class="settings-panel-header">
                                <h3>隐私保护设置</h3>
                                <p class="settings-description">配置截图模式和私密模式，保护您的隐私数据不被意外泄露。</p>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 截图模式设置 -->
                                <div class="settings-section privacy-card">
                                    <div class="privacy-section-header">
                                        <h4><i class="fas fa-camera"></i> 截图模式</h4>
                                        <div class="privacy-toggle-wrapper">
                                            <input type="checkbox" id="screenshotModeEnabled" class="privacy-toggle">
                                            <label for="screenshotModeEnabled" class="privacy-toggle-label">
                                                <span class="privacy-toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <p class="settings-description">对敏感内容应用模糊效果，防止截图时泄露隐私。</p>

                                    <div class="privacy-settings-grid">
                                        <div class="form-group">
                                            <label for="blurIntensity" class="privacy-label">
                                                <i class="fas fa-adjust"></i> 模糊强度:
                                                <span id="blurIntensityValue" class="privacy-value">5</span>
                                            </label>
                                            <input type="range" id="blurIntensity" min="1" max="10" value="5" class="privacy-slider">
                                        </div>

                                        <div class="form-group">
                                            <label for="autoBlurTrigger" class="privacy-label">
                                                <i class="fas fa-magic"></i> 自动模糊触发条件
                                            </label>
                                            <select id="autoBlurTrigger" class="privacy-select">
                                                <option value="manual">手动控制</option>
                                                <option value="tab-leave">离开标签页时</option>
                                                <option value="extension-reopen">重新打开拓展时</option>
                                                <option value="idle-timeout">空闲超时时</option>
                                            </select>
                                        </div>

                                    </div>

                                    <!-- 模糊区域选择 -->
                                    <div class="privacy-blur-areas">
                                        <label class="privacy-label">
                                            <i class="fas fa-layer-group"></i> 选择要模糊的区域
                                        </label>
                                        <div class="blur-areas-grid">
                                            <div class="form-group-checkbox privacy-checkbox">
                                                <input type="checkbox" id="blurSidebar" data-area="sidebar" checked>
                                                <label for="blurSidebar">侧边栏</label>
                                            </div>
                                            <div class="form-group-checkbox privacy-checkbox">
                                                <input type="checkbox" id="blurNavigation" data-area="navigation" checked>
                                                <label for="blurNavigation">导航栏</label>
                                            </div>
                                            <div class="form-group-checkbox privacy-checkbox">
                                                <input type="checkbox" id="blurVideoLibrary" data-area="video-library" checked>
                                                <label for="blurVideoLibrary">番号库</label>
                                            </div>
                                            <div class="form-group-checkbox privacy-checkbox">
                                                <input type="checkbox" id="blurActorLibrary" data-area="actor-library" checked>
                                                <label for="blurActorLibrary">演员库</label>
                                            </div>
                                            <div class="form-group-checkbox privacy-checkbox">
                                                <input type="checkbox" id="blurPlaylistPage" data-area="playlist-page" checked>
                                                <label for="blurPlaylistPage">新作品</label>
                                            </div>
                                            <div class="form-group-checkbox privacy-checkbox">
                                                <input type="checkbox" id="blurListsPage" data-area="lists-page" checked>
                                                <label for="blurListsPage">清单管理</label>
                                            </div>
                                            <div class="form-group-checkbox privacy-checkbox">
                                                <input type="checkbox" id="blurHomePage" data-area="home-page" checked>
                                                <label for="blurHomePage">首页</label>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <!-- 私密模式设置 -->
                                <div class="settings-section privacy-card">
                                    <div class="privacy-section-header">
                                        <h4><i class="fas fa-lock"></i> 私密模式</h4>
                                        <div class="privacy-toggle-wrapper">
                                            <input type="checkbox" id="privateModeEnabled" class="privacy-toggle">
                                            <label for="privateModeEnabled" class="privacy-toggle-label">
                                                <span class="privacy-toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <p class="settings-description">在截图模式基础上增加密码验证，适用于公共电脑环境。</p>

                                    <div class="privacy-settings-grid">
                                        <div class="form-group">
                                            <label class="privacy-label">
                                                <i class="fas fa-key"></i> 密码状态
                                            </label>
                                            <div class="privacy-status-row">
                                                <span id="passwordStatus" class="privacy-status privacy-status-warning">未设置</span>
                                                <div class="privacy-btn-group">
                                                    <button id="setPasswordBtn" class="privacy-btn privacy-btn-primary">
                                                        <i class="fas fa-plus"></i> 设置密码
                                                    </button>
                                                    <button id="changePasswordBtn" class="privacy-btn privacy-btn-secondary" style="display: none;">
                                                        <i class="fas fa-edit"></i> 更改密码
                                                    </button>
                                                    <button id="removePasswordBtn" class="privacy-btn privacy-btn-danger" style="display: none;">
                                                        <i class="fas fa-trash"></i> 取消密码
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="privacy-hint">
                                                <i class="fas fa-info-circle"></i>
                                                密码要求：至少6位，支持纯数字或字母数字组合
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="sessionTimeout" class="privacy-label">
                                                <i class="fas fa-hourglass-half"></i> 无操作超时时间（分钟）
                                            </label>
                                            <input type="number" id="sessionTimeout" min="1" max="120" value="10" class="privacy-input">
                                            <div class="privacy-hint">
                                                <i class="fas fa-info-circle"></i>
                                                超过此时间无任何操作将自动锁定
                                            </div>
                                        </div>
                                    </div>

                                    <div class="privacy-options">
                                        <div class="form-group-checkbox privacy-checkbox">
                                            <input type="checkbox" id="requirePassword">
                                            <label for="requirePassword">
                                                <i class="fas fa-shield-alt"></i> 需要密码验证
                                            </label>
                                        </div>

                                        <div class="form-group-checkbox privacy-checkbox">
                                            <input type="checkbox" id="lockOnTabLeave">
                                            <label for="lockOnTabLeave">
                                                <i class="fas fa-sign-out-alt"></i> 离开标签页时自动锁定
                                            </label>
                                        </div>

                                        <div class="form-group-checkbox privacy-checkbox">
                                            <input type="checkbox" id="lockOnExtensionClose">
                                            <label for="lockOnExtensionClose">
                                                <i class="fas fa-times-circle"></i> 关闭拓展时自动锁定
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- 密码恢复设置 -->
                                <div class="settings-section privacy-card">
                                    <div class="privacy-section-header">
                                        <h4><i class="fas fa-life-ring"></i> 密码恢复</h4>
                                    </div>
                                    <p class="settings-description">设置密码恢复选项，以防忘记密码。</p>

                                    <div class="privacy-settings-grid">
                                        <div class="form-group">
                                            <label class="privacy-label">
                                                <i class="fas fa-question-circle"></i> 安全问题
                                            </label>
                                            <div class="privacy-status-row">
                                                <span id="securityQuestionsStatus" class="privacy-status privacy-status-warning">未设置</span>
                                                <button id="setupSecurityQuestionsBtn" class="privacy-btn privacy-btn-secondary">
                                                    <i class="fas fa-cog"></i> 设置安全问题
                                                </button>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="privacy-label">
                                                <i class="fas fa-code"></i> 备份恢复码
                                            </label>
                                            <div class="privacy-status-row">
                                                <span id="backupCodeStatus" class="privacy-status privacy-status-warning">未生成</span>
                                                <button id="generateBackupCodeBtn" class="privacy-btn privacy-btn-secondary">
                                                    <i class="fas fa-key"></i> 生成备份码
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="privacy-alert privacy-alert-warning">
                                        <div class="privacy-alert-icon">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <div class="privacy-alert-content">
                                            <strong>重要提醒：</strong>
                                            <ul>
                                                <li>请妥善保存备份恢复码，它只会显示一次</li>
                                                <li>如果忘记密码且没有恢复选项，只能重置所有数据</li>
                                                <li>建议至少设置一种恢复方式</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 网络测试 -->
                        <div class="settings-panel" id="network-test-settings">
                            <div class="settings-panel-header">
                                <h3>网络连通性测试</h3>
                                <p class="settings-description">测试拓展涉及的所有外部服务的网络连通性，帮助诊断网络问题。</p>
                            </div>
                            <div class="settings-panel-body">

                                <!-- 手动测试区域 -->
                                <div class="network-test-section">
                                    <div class="section-header">
                                        <h4><i class="fas fa-edit"></i> 手动测试</h4>
                                        <p class="section-description">输入任意URL进行网络延迟测试</p>
                                    </div>
                                    <div class="form-group-inline">
                                        <div class="input-with-icon">
                                            <i class="fas fa-link icon"></i>
                                            <input type="text" id="ping-url" placeholder="例如: https://javdb.com" value="https://javdb.com">
                                        </div>
                                        <button id="start-ping-test" class="button-like">
                                            <span class="button-text">开始测试</span>
                                            <div class="spinner hidden"></div>
                                        </button>
                                    </div>
                                    <div id="ping-results-container" style="margin-top: 20px; display: none;">
                                        <h4>测试结果:</h4>
                                        <div id="ping-results"></div>
                                    </div>
                                </div>

                                <!-- 批量测试区域 -->
                                <div class="network-test-section" style="margin-top: 30px;">
                                    <div class="section-header">
                                        <h4><i class="fas fa-rocket"></i> 一键测试</h4>
                                        <p class="section-description">快速检测拓展涉及的所有外部服务的连通性</p>
                                    </div>

                                    <!-- 统计信息 -->
                                    <div class="domain-stats">
                                        <div class="stat-item">
                                            <span class="stat-label">总域名数:</span>
                                            <span class="stat-value" id="total-domains">-</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">已启用:</span>
                                            <span class="stat-value" id="enabled-domains">-</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">上次测试:</span>
                                            <span class="stat-value" id="last-test-time">从未</span>
                                        </div>
                                    </div>

                                    <!-- 批量测试控制按钮 -->
                                    <div class="batch-test-controls">
                                        <button id="test-all-domains" class="button-like primary">
                                            <i class="fas fa-play"></i>
                                            <span class="button-text">测试所有域名</span>
                                            <div class="spinner hidden"></div>
                                        </button>
                                        <button id="test-core-domains" class="button-like secondary">
                                            <i class="fas fa-home"></i>
                                            <span class="button-text">仅测试核心服务</span>
                                        </button>
                                        <button id="toggle-domain-config" class="button-like secondary">
                                            <i class="fas fa-cog"></i>
                                            <span class="button-text">配置域名</span>
                                        </button>
                                        <button id="clear-batch-results" class="button-like tertiary">
                                            <i class="fas fa-trash"></i>
                                            <span class="button-text">清空结果</span>
                                        </button>
                                    </div>

                                    <!-- 域名配置面板 -->
                                    <div id="domain-config-panel" class="domain-config-panel" style="display: none;">
                                        <div class="config-header">
                                            <h5><i class="fas fa-cog"></i> 域名测试配置</h5>
                                            <p>选择要测试的服务域名，只有启用的域名会被测试</p>
                                        </div>
                                        <div id="domain-config-content" class="domain-config-content">
                                            <!-- 动态生成的域名配置项 -->
                                        </div>
                                        <div class="config-actions">
                                            <button id="select-all-domains" class="button-like small secondary">全选</button>
                                            <button id="deselect-all-domains" class="button-like small secondary">全不选</button>
                                            <button id="reset-default-domains" class="button-like small tertiary">恢复默认</button>
                                        </div>
                                    </div>

                                    <!-- 批量测试结果 -->
                                    <div id="batch-test-results" class="batch-results-container" style="display: none;">
                                        <div class="batch-results-placeholder">
                                            <i class="fas fa-info-circle"></i>
                                            <p>点击上方按钮开始批量测试</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 115网盘设置 -->
                        <div class="settings-panel" id="drive115-settings">
                            <div class="settings-panel-header">
                                <h3>115网盘离线下载</h3>
                                <div class="settings-panel-actions" style="margin-left:auto; display:flex; align-items:center; gap:8px;">
                                    
                                </div>
                                <p class="settings-description">配置115网盘离线下载功能，支持磁链自动下载和验证。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="drive115-settings-container">
                                    <!-- 新版（v2）Token 模式 -->
                                    <div class="settings-section" id="drive115V2Pane">
                                        <!-- 分组：模式与接口 -->
                                        <div class="settings-group">
                                            <h4>模式与接口</h4>
                                            <div class="form-group">
                                                <div class="drive115-toggle-wrapper" style="display:flex; align-items:center; gap:10px;">
                                                    <span class="drive115-toggle-text">启用 115 离线下载</span>
                                                    <label class="drive115-toggle-label" style="margin:0;">
                                                        <div class="drive115-toggle-switch">
                                                            <input type="checkbox" id="drive115EnableV2" class="drive115-toggle-input">
                                                            <span class="drive115-toggle-slider"></span>
                                                        </div>
                                                    </label>
                                                </div>
                                                <p class="input-description">
                                                    新版将使用 access_token/refresh_token，不依赖旧版登录页面与签名流程。
                                                    <a id="drive115V2HelpLink" href="https://api.oplist.org/" target="_blank" rel="noopener noreferrer">如何获取 token？</a>
                                                    <span class="inline-note">注：115开放平台已关闭新接入应用，故借“openlist”开源项目提供的工具获取token。后续接入115开放平台后，再优化该功能。</span>
                                                </p>
                                            </div>

                                            <div class="form-group">
                                                <label for="drive115V2ApiBaseUrl">接口域名（v2）:</label>
                                                <input type="text" id="drive115V2ApiBaseUrl" placeholder="例如：https://proapi.115.com" />
                                                <p class="input-description">可自定义 v2 接口基础域名，默认 <code>https://proapi.115.com</code>。无需以斜杠结尾。</p>
                                            </div>
                                        </div>

                                        <!-- 分组：凭据与有效期 -->
                                        <div class="settings-group">
                                            <h4>凭据与有效期</h4>
                                            <div class="form-group">
                                                <label for="drive115V2AccessToken">access_token:</label>
                                                <textarea id="drive115V2AccessToken" class="textarea-input" placeholder="粘贴 access_token" rows="3" style="white-space: pre-wrap; word-break: break-all; overflow-wrap: anywhere; overflow:hidden; resize: none; line-height:1.4;"></textarea>
                                                <p class="input-description" style="margin-top:6px;">
                                                    到期：<span id="drive115V2TokenExpiry">未知</span>
                                                </p>
                                            </div>

                                            <div class="form-group">
                                                <label for="drive115V2RefreshToken">refresh_token:</label>
                                                <div class="form-group-inline">
                                                    <textarea id="drive115V2RefreshToken" class="textarea-input" placeholder="粘贴 refresh_token" rows="3" style="white-space: pre-wrap; word-break: break-all; overflow-wrap: anywhere; overflow:hidden; resize: none; line-height:1.4;"></textarea>
                                                    
                                                    <button id="drive115V2ManualRefresh" class="button-like">手动刷新 access_token</button>
                                                </div>
                                                <p class="input-description">点击“手动刷新”会复制 refresh_token，并打开帮助页面以指导刷新流程。</p>
                                            </div>

                                            <div class="form-group">
                                                <div class="form-group-inline" style="align-items:center; gap:12px;">
                                                    <label class="drive115-toggle-label" style="margin:0;">
                                                        <span class="drive115-toggle-text">自动刷新 access_token</span>
                                                        <div class="drive115-toggle-switch">
                                                            <input type="checkbox" id="drive115V2AutoRefresh" class="drive115-toggle-input">
                                                            <span class="drive115-toggle-slider"></span>
                                                        </div>
                                                    </label>
                                                    <div style="display:flex; align-items:center; gap:6px;">
                                                        <label for="drive115V2AutoRefreshSkewSec" style="white-space:nowrap;">提前刷新(秒):</label>
                                                        <input type="number" id="drive115V2AutoRefreshSkewSec" min="0" step="1" value="60" style="width:100px;">
                                                    </div>
                                                </div>
                                                <p class="input-description">开启后，当 access_token 过期或将在指定秒数内过期时，将自动使用 refresh_token 刷新并保存。</p>
                                            </div>
                                        </div>

                                        <!-- 分组：用户信息 -->
                                        <div class="settings-group">
                                            <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
                                                <h4 style="margin:0;">用户信息</h4>
                                                <div class="action-buttons-top" style="margin:0;">
                                                    <button id="drive115V2FetchUserInfo" class="btn">刷新用户信息</button>
                                                </div>
                                            </div>
                                            <p id="drive115V2UserInfoStatus" class="input-description" data-kind="info" style="margin:8px 0 12px; color:#888;">未加载</p>
                                            <div id="drive115V2UserInfoBox" class="drive115-user-info-box" style="border:1px dashed var(--border-primary); padding:12px; border-radius:8px; background:var(--bg-hover); min-height:40px;">
                                                <!-- 115 用户信息将由脚本渲染到此处 -->
                                            </div>
                                        </div>

                                        <!-- 分组：添加云下载任务（多链接） -->
                                        <div class="settings-group">
                                            <h4>添加云下载任务（多链接）</h4>
                                            <div class="form-group">
                                                <label for="drive115V2AddUrls">下载链接（每行一个，支持 HTTP/HTTPS/FTP/Magnet/eD2k）:</label>
                                                <textarea id="drive115V2AddUrls" class="textarea-input" placeholder="每行一条，例如：\nmagnet:?xt=urn:btih:...\nhttps://example.com/file.zip" rows="4" style="white-space: pre-wrap; word-break: break-all; overflow-wrap: anywhere; overflow:hidden; resize: none; line-height:1.4;"></textarea>
                                                <p class="input-description">将多条链接按行分隔粘贴到此处。空行会被自动忽略。</p>
                                            </div>
                                            <div class="form-group">
                                                <label for="drive115V2WpPathId">保存到目录ID（可选）:</label>
                                                <input type="text" id="drive115V2WpPathId" placeholder="不填默认根目录（wp_path_id）" />
                                                <p class="input-description">填写 115 目录 ID（wp_path_id/cid）。留空或 0 表示根目录。</p>
                                            </div>
                                            <div class="form-group">
                                                <button id="drive115V2AddUrlsBtn" class="button-like">添加云下载任务</button>
                                                <span id="drive115V2AddUrlsStatus" class="input-description" style="margin-left:10px; color:#888;"></span>
                                            </div>
                                            <div id="drive115V2AddUrlsResult" class="test-results" style="margin-top:8px;"></div>
                                        </div>

                                        <!-- 分组：下载设置 -->
                                        <div class="settings-group">
                                            <h4>下载设置</h4>
                                            <div class="form-grid drive115-download-settings">
                                                <div class="form-group">
                                                    <label for="drive115DownloadDir">下载目录ID:</label>
                                                    <input type="text" id="drive115DownloadDir" placeholder="请输入目录ID（cid），例如：123456789">
                                                    <p class="input-description">仅支持填写目录ID（cid）。<button type="button" id="drive115HowToCidToggle" class="link-button" style="margin-left:8px;">如何获取ID？</button></p>
                                                    <div id="drive115HowToCid" class="help-collapsible" style="display:none; margin-top:6px;">
                                                        <ol style="padding-left:18px; margin:6px 0;">
                                                            <li>在 115 网页端打开目标文件夹</li>
                                                            <li>查看浏览器地址栏，找到 <code>cid=xxxxxxxx</code></li>
                                                            <li>复制 <code>cid=</code> 后面的数字，粘贴到上面的输入框</li>
                                                        </ol>
                                                        <p style="color:#666; margin:4px 0 0;">例如：<code>https://115.com/?cid=123456789&...</code>，目录ID即 <code>123456789</code></p>
                                                    </div>
                                                    <p id="drive115DownloadDirError" class="input-error" style="display:none;">请输入目录ID</p>
                                                </div>

                                                <div class="form-group">
                                                    <label for="drive115VerifyCount">验证次数:</label>
                                                    <input type="number" id="drive115VerifyCount" class="number-input" min="1" max="20" value="5">
                                                    <p class="input-description">下载后验证文件的重试次数，建议3-5次。</p>
                                                </div>

                                                <div class="form-group">
                                                    <label for="drive115MaxFailures">最大失败数:</label>
                                                    <input type="number" id="drive115MaxFailures" class="number-input" min="0" max="50" value="5">
                                                    <p class="input-description">批量下载时允许的最大失败次数，0表示不限制。</p>
                                                </div>

                                                <div class="form-group">
                                                    <label class="checkbox-label">
                                                        <input type="checkbox" id="drive115AutoNotify" checked>
                                                        <span class="checkmark"></span>
                                                        自动通知
                                                    </label>
                                                    <p class="input-description">下载完成后自动显示通知。</p>
                                                </div>
                                                
                                            </div>
                                        </div>

                                        <!-- 分组：测试功能 -->
                                        <div class="settings-group">
                                            <h4>测试功能</h4>
                                            <div class="form-group">
                                                <label for="testSearchInput">测试搜索:</label>
                                                <div class="form-group-inline">
                                                    <input type="text" id="testSearchInput" placeholder="输入番号或关键词">
                                                    <button id="testDrive115Search" class="button-like">测试搜索</button>
                                                </div>
                                                <p class="input-description">测试115网盘搜索功能是否正常工作。</p>
                                            </div>
                                            <div id="testResults" class="test-results"></div>
                                        </div>

                                        <!-- 分组：日志查看 -->
                                        <div class="settings-group">
                                            <h4>115网盘日志</h4>
                                            <div class="action-buttons-top">
                                                <button id="refreshDrive115Logs" class="btn">刷新日志</button>
                                                <button id="clearDrive115Logs" class="btn danger">清空日志</button>
                                                <button id="exportDrive115Logs" class="btn">导出日志</button>
                                            </div>
                                            <div id="drive115LogStats" class="log-stats"></div>
                                            <div id="drive115LogsList" class="logs-list"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 功能增强设置 -->
                        <div class="settings-panel" id="enhancement-settings">
                            <div class="settings-panel-header">
                                <h3>功能增强设置</h3>
                                <p class="settings-description">解锁强大的增强功能，让您的 JavDB 体验更加丰富和高效！这些功能将显著提升浏览效率、数据完整性和操作便捷性。</p>

                                <!-- 功能提示 -->
                                <div class="enhancement-notice">
                                    <i class="fas fa-info-circle"></i>
                                    <span>增强功能可能存在细微问题，如遇到任何异常请在 <a href="https://github.com/Adsryen/JavdBviewed/issues" target="_blank" rel="noopener noreferrer">GitHub Issues</a> 反馈。</span>
                                </div>

                                <div id="enhancementSubTabs" class="subtabs">
                                    <button type="button" class="subtab-link" data-subtab="list">列表页增强</button>
                                    <button type="button" class="subtab-link" data-subtab="video">影片页增强</button>
                                    <button type="button" class="subtab-link" data-subtab="actor">演员页增强</button>
                                    <span style="flex:1"></span>
                                    <button type="button" id="showOrchestratorBtn" class="button-like" title="查看当前页面功能编排">编排可视化</button>
                                </div>


                            </div>
                            <div class="settings-panel-body">
                                <!-- 隐藏的checkbox元素，用于JavaScript逻辑 -->
                                <div style="display: none;">
                                    <input type="checkbox" id="enableTranslation">
                                    <input type="checkbox" id="enableContentFilter">
                                    <input type="checkbox" id="enableMagnetSearch">
                                    <input type="checkbox" id="enableAnchorOptimization">
                                    <input type="checkbox" id="enableListEnhancement">
                                    <input type="checkbox" id="enableVideoPreview">
                                    <input type="checkbox" id="enableHighQualityCover">
                                    <input type="checkbox" id="enableClickEnhancement">
                                    <input type="checkbox" id="enableScrollPaging">
                                    <input type="checkbox" id="enableActorWatermark">
                                    <input type="checkbox" id="enableActorEnhancement">
                                    <input type="checkbox" id="enableVideoEnhancement">
                                    <!-- 影片页增强子项（右侧通用开关的状态源） -->
                                    <input type="checkbox" id="veShowLoadingIndicator">
                                    <input type="checkbox" id="veEnableReviewBreaker">
                                    <input type="checkbox" id="veEnableFC2Breaker">
                                    <input type="checkbox" id="veEnableActorRemarks">
                                    <!-- 新增：影片页增强 - 本地同步类子项（隐藏 checkbox 作为状态源） -->
                                    <input type="checkbox" id="veEnableWantSync">
                                    <input type="checkbox" id="veAutoMarkWatchedAfter115">
                                    <!-- 新增：演员页增强 - 影片分段显示（隐藏 checkbox 作为状态源） -->
                                    <input type="checkbox" id="aeEnableTimeSegmentationDivider">
                                </div>

                                <!-- 数据增强 -->
                                <div class="settings-section" data-subtab="video">

                                    <div class="form-group">
                                        <label class="checkbox-label" style="opacity: 0.6;">
                                            <input type="checkbox" id="enableImageCache" disabled>
                                            <span class="checkmark"></span>
                                            🚀 智能图片缓存 <span style="color: #ff9800; font-size: 12px; font-weight: bold; background: #fff3e0; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">开发中</span>
                                        </label>
                                        <p class="input-description" style="opacity: 0.7;">
                                            <strong>效果：</strong>缓存高质量封面和演员头像，第二次访问时瞬间加载<br>
                                            <strong>使用：</strong>自动工作，无需手动操作，显著提升页面加载速度<br>
                                            <strong style="color: #ff9800;">状态：</strong>功能正在开发完善中，暂时不可用
                                        </p>

                                        <!-- 智能图片缓存子设置 -->
                                        <div class="sub-settings" style="display: none; opacity: 0.6;">
                                            <div class="sub-settings-header">
                                                <h5><i class="fas fa-cog"></i> 缓存配置</h5>
                                                <p class="sub-description">配置图片缓存的相关参数</p>
                                            </div>

                                            <div class="form-group">
                                                <label for="cacheExpiration">⏰ 缓存过期时间 (小时):</label>
                                                <input type="number" id="cacheExpiration" class="number-input" min="1" max="168" value="24" disabled>
                                                <p class="input-description">
                                                    <strong>说明：</strong>增强数据的缓存保存时间，建议24小时。时间越长加载越快，但数据更新越慢
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🈳 智能标题翻译</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableTranslation"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>自动将日文标题翻译为中文，支持 Google 翻译与 AI 翻译<br>
                                            <strong>使用：</strong>在视频详情页会在原标题下方显示中文翻译，帮助理解内容
                                        </p>

                                        <!-- 翻译服务配置（作为子设置，悬浮展开） -->
                                        <div id="translationConfig" class="translation-config sub-settings" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #007bff;">
                                            <div class="translation-status">
                                                <h5 style="margin: 0 0 10px 0; color: #495057;">
                                                    <i class="fas fa-language"></i> 翻译服务配置
                                                </h5>
                                                <div class="current-service" style="margin-bottom: 15px;">
                                                    <span style="font-weight: 500;">当前使用：</span>
                                                    <span id="currentTranslationService" style="color: #007bff; font-weight: 600;">Google 翻译</span>
                                                </div>
                                            </div>

                                            <div class="form-group" style="margin-bottom: 15px;">
                                                <label for="translationProvider" style="display: block; margin-bottom: 5px; font-weight: 500;">
                                                    <i class="fas fa-cogs"></i> 翻译服务类型：
                                                </label>
                                                <select id="translationProvider" class="select-input" style="width: 100%;">
                                                    <option value="traditional">Google 翻译</option>
                                                    <option value="ai">AI 翻译</option>
                                                </select>
                                                <p class="input-description" style="margin-top: 5px; font-size: 12px;">
                                                    Google 服务稳定快速；AI 服务更智能但需要先在 AI 设置中配置
                                                </p>
                                            </div>

                                            <!-- 传统翻译服务配置 -->
                                            <div id="traditionalTranslationConfig" class="translation-provider-config">
                                                <div class="form-group" style="margin-bottom: 10px;">
                                                    <label for="traditionalTranslationService" style="display: block; margin-bottom: 5px; font-weight: 500;">
                                                        翻译服务：
                                                    </label>
                                                    <select id="traditionalTranslationService" class="select-input" style="width: 100%;">
                                                        <option value="google">Google 翻译 (免费)</option>
                                                    </select>
                                                </div>

                                                <div id="traditionalApiKeyGroup" class="form-group" style="display: none; margin-bottom: 10px;">
                                                    <label for="traditionalApiKey" style="display: block; margin-bottom: 5px; font-weight: 500;">
                                                        API密钥：
                                                    </label>
                                                    <input type="password" id="traditionalApiKey" class="text-input"
                                                           placeholder="输入API密钥" style="width: 100%;">
                                                    <p class="input-description" style="margin-top: 5px; font-size: 12px;">
                                                        Google 翻译无需密钥
                                                    </p>
                                                </div>
                                            </div>

                                            <!-- AI翻译服务配置 -->
                                            <div id="aiTranslationConfig" class="translation-provider-config" style="display: none;">
                                                <div class="ai-translation-status" style="padding: 10px; background: #e3f2fd; border-radius: 4px; margin-top: 10px;">
                                                    <div style="display: flex; align-items: center; gap: 8px;">
                                                        <i class="fas fa-info-circle" style="color: #1976d2;"></i>
                                                        <span style="font-size: 12px; color: #1976d2;">
                                                            AI 翻译将直接使用“AI 设置”中的当前模型。如未设置，请先前往配置
                                                        </span>
                                                    </div>
                                                    <div style="margin-top:8px; font-size: 12px; color:#333;">
                                                        当前模型：<span id="aiCurrentModel" style="font-weight:600; color:#007bff;">未设置</span>
                                                        <button id="goAiSettingsBtn" class="btn-secondary btn-sm" style="margin-left:8px;">前往 AI 设置</button>
                                                    </div>
                                                    <div id="aiModelEmptyTip" style="display:none; margin-top:8px; font-size:12px; color:#d9534f;">
                                                        未检测到当前模型，请点击“前往 AI 设置”进行配置
                                                    </div>
                                                </div>
                                                <!-- 翻译目标与显示方式配置已移动到通用区域（适用于所有提供商） -->
                                            </div>
                                        
                                            <!-- 翻译目标与显示方式配置（适用于所有提供商） -->
                                            <div class="form-group" style="margin-top: 12px;">
                                                <label style="display:block; margin-bottom:6px; font-weight:600;">翻译目标位置</label>
                                                <label class="checkbox-label" style="display:flex; align-items:center; gap:8px;">
                                                    <input type="checkbox" id="translateCurrentTitle">
                                                    <span class="checkmark"></span>
                                                    影片页标题（current-title）
                                                </label>
                                            </div>

                                            <div class="form-group" style="margin-top: 8px;">
                                                <label for="translationDisplayMode" style="display:block; margin-bottom:6px; font-weight:600;">显示方式</label>
                                                <select id="translationDisplayMode" class="select-input" style="width: 100%;">
                                                    <option value="append">保留原始（追加显示）</option>
                                                    <option value="replace">替换原始标题</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 状态标记增强 主开关与子设置（显示在“影片页增强”子标签内） -->
                                    <div class="form-group" data-subtab="video">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🎬 状态标记增强</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <!-- 主开关：控制子设置区块显隐 -->
                                                <button class="enhancement-toggle" data-target="enableVideoEnhancement"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>功能：</strong>在影片详情页注入增强区块，支持“想看”点击同步到本地番号库，以及 115 推送后自动标记“已看”。<br>
                                            <strong>说明：</strong>此主开关仅控制设置区块显示与核心增强；具体子功能可单独开关。
                                        </p>

                                        <!-- 子设置容器：由 data-target=enableVideoEnhancement 控制显隐 -->
                                        <div id="videoEnhancementConfig" class="sub-settings" style="display: none;">
                                            <!-- 子项：点击“想看”时同步到番号库 -->
                                            <div class="form-group">
                                                <label class="checkbox-label">
                                                    <div class="enhancement-feature-info">
                                                        <div class="enhancement-feature-title">
                                                            <h6 class="enhancement-feature-name">✅ 点击“想看”时同步到番号库</h6>
                                                            <span class="enhancement-feature-status available">可用</span>
                                                        </div>
                                                    </div>
                                                    <div class="enhancement-toggle-wrapper">
                                                        <button class="enhancement-toggle" data-target="veEnableWantSync"></button>
                                                    </div>
                                                </label>
                                                <p class="input-description">
                                                    开启后，在 JavDB 影片页点击“想看”按钮，将自动把该影片以“想看”状态写入本地番号库（若不存在则自动创建）。
                                                </p>
                                            </div>

                                            <!-- 子项：115 推送成功后自动标记“已看” -->
                                            <div class="form-group">
                                                <label class="checkbox-label">
                                                    <div class="enhancement-feature-info">
                                                        <div class="enhancement-feature-title">
                                                            <h6 class="enhancement-feature-name">☑️ 115 推送成功后自动标记“已看”</h6>
                                                            <span class="enhancement-feature-status available">可用</span>
                                                        </div>
                                                    </div>
                                                    <div class="enhancement-toggle-wrapper">
                                                        <button class="enhancement-toggle" data-target="veAutoMarkWatchedAfter115"></button>
                                                    </div>
                                                </label>
                                                <p class="input-description">
                                                    开启后，当从影片页触发 115 推送成功，将自动将本片标记为“已看”。
                                                </p>
                                            </div>
                                        </div>
                                    </div>


                                </div>

                                <!-- 用户体验 -->
                                <div class="settings-section">
                                    <div class="form-group" data-subtab="list">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🎯 智能内容过滤</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableContentFilter"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在列表页过滤关键字，支持正则表达式，可隐藏、高亮或标记匹配内容<br>
                                            <strong>使用：</strong>在下方设置过滤规则，保存后在列表页自动生效
                                        </p>

                                        <!-- 内容过滤详细配置 -->
                                        <div class="sub-settings" id="contentFilterConfig" style="display: none;">
                                            <div class="sub-settings-header">
                                                <h5>🎯 过滤规则配置</h5>
                                                <p class="sub-description">配置关键字过滤规则，支持正则表达式，可隐藏、高亮或标记匹配的内容。</p>
                                            </div>

                                            <div class="filter-rules-container">
                                                <div class="filter-rules-header">
                                                    <span>过滤规则列表</span>
                                                    <button type="button" id="addFilterRule" class="btn-secondary btn-sm">
                                                        <i class="fas fa-plus"></i> 添加规则
                                                    </button>
                                                </div>

                                                <div id="filterRulesList" class="filter-rules-list">
                                                    <!-- 过滤规则将由 JS 动态填充 -->
                                                    <div class="empty-state">
                                                        <p>暂无过滤规则，点击"添加规则"开始配置</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 新：🖱️ 启用点击增强（独立区块，右侧通用开关） -->
                                    <div class="form-group" data-subtab="list">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🖱️ 启用点击增强</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableClickEnhancement"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>左键直接在当前标签打开，右键在后台新标签打开（不中断当前浏览）。<br>
                                            <strong>说明：</strong>该增强会统一列表中卡片/标题的点击行为，减少多余的页面跳转。<br>
                                            <strong>适用：</strong>所有影片列表页（首页、搜索、分类、演员页的作品列表等）。
                                        </p>
                                    </div>

                                    <!-- 新：🎬 视频预览增强（独立区块） -->
                                    <div class="form-group" data-subtab="list">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🎬 视频预览增强</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableVideoPreview"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在列表页鼠标悬停时显示视频预览片段（需要预览源支持）<br>
                                            <strong>使用：</strong>鼠标悬停在视频封面上即可预览，无需点击进入详情页<br>
                                            <strong>延迟：</strong><span id="currentPreviewDelay">—</span> ms（可在本块子设置中调整“预览延迟时间”）
                                        </p>

                                        <!-- 视频预览增强独立子设置 -->
                                        <div class="sub-settings" id="listVideoPreviewConfig" style="display: none;">
                                            <div class="sub-settings-header">
                                                <h5>🎬 预览设置</h5>
                                                <p class="sub-description">控制悬停预览的延迟、音量和来源。</p>
                                            </div>

                                            <div class="form-group">
                                                <label for="previewDelay">预览延迟时间 (毫秒):</label>
                                                <input type="number" id="previewDelay" class="number-input" min="100" max="5000" value="1000">
                                                <p class="input-description">鼠标悬浮多久后开始播放预览，建议1000毫秒。</p>
                                            </div>

                                            <div class="form-group volume-control-group">
                                                <div class="volume-header">
                                                    <label for="previewVolume">🔊 预览音量</label>
                                                    <span id="previewVolumeValue" class="volume-percentage">20%</span>
                                                </div>
                                                <div class="volume-slider-wrapper">
                                                    <input type="range" id="previewVolume" class="modern-range" min="0" max="1" step="0.01" value="0.2">
                                                    <div class="range-track-fill"></div>
                                                </div>
                                                <p class="input-description">预览视频的音量大小，建议保持较低音量。</p>
                                            </div>

                                            <div class="form-group">
                                                <label>预览来源</label>
                                                <div class="radio-group" id="previewSourceGroup">
                                                    <label class="radio-item"><input type="radio" name="previewSource" id="previewSourceAuto" value="auto" checked> 自动（推荐）</label>
                                                    <label class="radio-item"><input type="radio" name="previewSource" id="previewSourceJavDB" value="javdb"> JavDB</label>
                                                    <label class="radio-item"><input type="radio" name="previewSource" id="previewSourceJavSpyl" value="javspyl"> JavSpyl</label>
                                                    <label class="radio-item"><input type="radio" name="previewSource" id="previewSourceAVPreview" value="avpreview"> AVPreview</label>
                                                    <label class="radio-item"><input type="radio" name="previewSource" id="previewSourceVBGFL" value="vbgfl"> 厂牌规则（VBGFL）</label>
                                                </div>
                                                <p class="input-description">选择悬停预览的首选来源。自动会按 JavSpyl → AVPreview → 厂牌规则 → JavDB 的顺序尝试。</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 新：📜 启用滚动翻页（独立区块，右侧通用开关） -->
                                    <div class="form-group" data-subtab="list">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">📜 启用滚动翻页</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableScrollPaging"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>当滚动到页面底部时自动加载下一页列表，实现连续浏览。<br>
                                            <strong>提示：</strong>如遇到站点限速或触发反爬，请适当停顿或关闭此项。<br>
                                            <strong>适用：</strong>支持分页的影片列表页。
                                        </p>
                                    </div>

                                    <!-- 新：🖼️ 高质量封面 -->
                                    <div class="form-group" data-subtab="list">
                                        <label class="checkbox-label" style="opacity: 0.6;">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🖼️ 高质量封面</h6>
                                                    <span class="enhancement-feature-status deprecated">已弃用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableHighQualityCover" disabled></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在列表页自动将缩略图URL替换为高质量封面URL<br>
                                            <strong>说明：</strong>JavDB 现已默认使用高质量封面，此功能无需启用
                                        </p>
                                    </div>

                                    <!-- 新：🖍️ 演员水印（订阅/黑名单） -->
                                    <div class="form-group" data-subtab="list">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🖍️ 演员水印（订阅/黑名单）</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableActorWatermark"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在影片封面角落显示演员状态水印，小圆点颜色区分订阅（绿色）与黑名单（红色）。<br>
                                            <strong>识别：</strong>根据标题末尾的演员名匹配本地演员库（含别名）。未匹配到则不显示水印。
                                        </p>

                                        <!-- 演员水印子设置 -->
                                        <div class="sub-settings" id="actorWatermarkConfig" style="display: none;">
                                            <div class="sub-settings-header">
                                                <h5>🖍️ 水印设置</h5>
                                                <p class="sub-description">自定义水印位置与透明度，以减少视觉干扰。</p>
                                            </div>

                                            <div class="form-group">
                                                <label for="actorWatermarkPosition">水印位置</label>
                                                <select id="actorWatermarkPosition" class="select-input">
                                                    <option value="top-left">左上</option>
                                                    <option value="top-right">右上</option>
                                                    <option value="bottom-left">左下</option>
                                                    <option value="bottom-right">右下</option>
                                                </select>
                                            </div>

                                            <div class="form-group volume-control-group">
                                                <div class="volume-header">
                                                    <label for="actorWatermarkOpacity">透明度</label>
                                                    <span id="actorWatermarkOpacityValue" class="volume-percentage">40%</span>
                                                </div>
                                                <div class="volume-slider-wrapper">
                                                    <input type="range" id="actorWatermarkOpacity" class="modern-range" min="0" max="1" step="0.05" value="0.4">
                                                    <div class="range-track-fill"></div>
                                                </div>
                                                <p class="input-description">降低透明度以减少干扰，0为全透明，1为不透明。</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 新：📝 演员备注（Wiki/xslist）（独立区块） -->
                                    <div class="form-group" data-subtab="video">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">📝 演员备注（Wiki / xslist）</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="veEnableActorRemarks"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>显示演员基础备注（年龄/身高/罩杯/引退）与 Wiki 外链。<br>
                                            <strong>数据源：</strong>Wikipedia → xslist（与原脚本一致）。
                                        </p>

                                        <div class="sub-settings" id="actorRemarksConfig" style="display: none;">
                                            <div class="sub-settings-header">
                                                <h5>📝 演员备注配置</h5>
                                                <p class="sub-description">控制展示样式与缓存策略</p>
                                            </div>

                                            <div class="form-row">
                                                <div class="form-group-inline">
                                                    <label for="veActorRemarksMode">展示模式：</label>
                                                    <select id="veActorRemarksMode" class="select-input">
                                                        <option value="panel">面板</option>
                                                        <option value="inline">内嵌胶囊</option>
                                                    </select>
                                                </div>
                                                <div class="form-group-inline">
                                                    <label for="veActorRemarksTTL">缓存TTL（天）：</label>
                                                    <input type="number" id="veActorRemarksTTL" class="number-input" min="0" max="30" value="0">
                                                    <span class="input-suffix">天</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 新：⌛ 显示加载指示器（独立区块） -->
                                    <div class="form-group" data-subtab="video">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">⌛ 显示加载指示器</h6>
                                                    <span class="enhancement-feature-status beta">测试中</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="veShowLoadingIndicator"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在影片页增强功能加载时显示进度指示器<br>
                                            <strong>使用：</strong>让您清楚了解增强功能的加载状态，提升用户体验
                                        </p>
                                    </div>

                                    <!-- 新：🔓 破解评论区功能（独立区块） -->
                                    <div class="form-group" data-subtab="video">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🔓 破解评论区</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="veEnableReviewBreaker"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>集成JAV-JHS的API，破解影片评论区限制，显示完整评论内容<br>
                                            <strong>使用：</strong>在影片详情页自动显示破解后的评论，支持分页浏览和关键词过滤<br>
                                            <strong>数据源：</strong>使用JAV-JHS的代理API服务器获取评论数据
                                        </p>
                                    </div>

                                    <!-- 新：🚫 破解FC2拦截功能（独立区块） -->
                                    <div class="form-group" data-subtab="video">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🚫 破解FC2拦截</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="veEnableFC2Breaker"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>整合123av和fc2ppvdb数据源，绕过FC2视频访问限制<br>
                                            <strong>使用：</strong>在FC2影片页显示增强信息，包括视频预览、演员信息和销售者详情<br>
                                            <strong>数据源：</strong>从123av.com和fc2ppvdb.com获取FC2视频的详细信息
                                        </p>
                                    </div>

                                    <div class="form-group" data-subtab="video">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">⚓ 锚点优化</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableAnchorOptimization"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在视频详情页优化快捷按钮位置，添加预览图和磁链快捷跳转<br>
                                            <strong>使用：</strong>仅在详情页生效，在页面右侧显示优化的快捷按钮<br>
                                            <strong>适用：</strong>视频详情页（/v/xxx），不适用于列表页和搜索页
                                        </p>

                                        <!-- 锚点优化详细配置 -->
                                        <div class="sub-settings" id="anchorOptimizationConfig" style="display: none;">
                                            <div class="sub-settings-header">
                                                <h5>⚓ 锚点优化配置</h5>
                                                <p class="sub-description">自定义详情页快捷按钮的位置和功能。仅在视频详情页生效。</p>
                                            </div>

                                            <!-- 锚点配置并排选项 -->
                                            <div class="anchor-config-container">
                                                <div class="anchor-config-option">
                                                    <div class="config-header">
                                                        <span class="config-title">📍 按钮位置</span>
                                                        <div class="modern-select-wrapper">
                                                            <select id="anchorButtonPosition" class="modern-select">
                                                                <option value="right-center">右侧中央</option>
                                                                <option value="right-bottom">右下角</option>
                                                            </select>
                                                            <span class="select-arrow">▼</span>
                                                        </div>
                                                    </div>
                                                    <p class="config-description">选择优化后按钮的显示位置</p>
                                                </div>

                                                <div class="anchor-config-option">
                                                    <div class="config-header">
                                                        <span class="config-title">🖼️ 显示预览图按钮</span>
                                                        <label class="modern-toggle">
                                                            <input type="checkbox" id="showPreviewButton" checked>
                                                            <span class="toggle-slider"></span>
                                                        </label>
                                                    </div>
                                                    <p class="config-description">在快捷按钮中显示"预览图"按钮，点击可快速跳转到预览图区域。</p>
                                                </div>
                                            </div>

                                            <div class="info-box">
                                                <p><strong>按钮顺序（从上到下）：</strong></p>
                                                <ol>
                                                    <li>🖼️ 预览图 - 跳转到预览图区域</li>
                                                    <li>🧲 磁链下载 - 跳转到磁链下载区域</li>
                                                    <li>⬆️ TOP - 返回页面顶部</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group" data-subtab="actor">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🎯 影片类别过滤</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableActorEnhancement"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在演员页按影片类别/标签进行过滤，并自动保存过滤条件，跨演员页智能应用<br>
                                            <strong>使用：</strong>在演员页选择类别/标签后自动保存；切换到其他演员页时自动应用兼容的过滤条件<br>
                                            <strong>适用：</strong>演员页面（/actors/xxx），支持影片类别/标签过滤条件的自动保存与智能应用
                                        </p>

                                        <!-- 影片类别过滤详细配置 -->
                                        <div class="sub-settings" id="actorEnhancementConfig" style="display: none;">
                                            <div class="sub-settings-header">
                                                <h5>🎯 影片类别过滤配置</h5>
                                                <p class="sub-description">自定义演员页的类别/标签过滤器行为，提升浏览效率。</p>
                                            </div>

                                            <!-- 演员页配置选项 -->
                                            <div class="dual-toggle-container">
                                                <div class="toggle-option">
                                                    <div class="toggle-header">
                                                        <span class="toggle-title">🔄 自动应用过滤器</span>
                                                        <label class="modern-toggle">
                                                            <input type="checkbox" id="enableAutoApplyTags" checked>
                                                            <span class="toggle-slider"></span>
                                                        </label>
                                                    </div>
                                                    <p class="toggle-description">自动将上次使用的过滤条件应用到新的演员页</p>
                                                    
                                                    <!-- 上次应用的标签显示 -->
                                                    <div class="last-applied-tags" id="lastAppliedTagsDisplay" style="margin-top: 10px;">
                                                        <div class="tag-display-header">
                                                            <span class="tag-display-title">📋 上次应用的过滤条件：</span>
                                                            <div class="tag-actions">
                                                                <button class="btn-small btn-outline" id="clearLastAppliedTags" title="清除记录">🗑️</button>
                                                            </div>
                                                        </div>
                                                        <div class="applied-tags-container" id="appliedTagsContainer">
                                                            <span class="no-tags-message">暂无记录</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="toggle-option">
                                                    <div class="toggle-header">
                                                        <span class="toggle-title">🏷️ 默认过滤条件</span>
                                                        <!-- 动态生成的复选框组 -->
                                                        <div id="actorDefaultTagsGroup" class="checkbox-group">
                                                            <!-- 由 JavaScript 动态生成 -->
                                                        </div>
                                                    </div>
                                                    <p class="toggle-description">当没有保存记录或兼容性检查失败时使用的默认过滤条件</p>
                                                </div>
                                            </div>

                                            <div class="info-box">
                                                <p><strong>功能说明：</strong></p>
                                                <ul>
                                                    <li>🔄 <strong>自动同步：</strong>在演员页选择类别/标签后自动保存，切换演员时智能应用</li>
                                                    <li>🧠 <strong>智能兼容：</strong>只应用当前演员页支持的过滤条件，避免无效过滤</li>
                                                    <li>📝 <strong>默认回退：</strong>当无保存记录或兼容性检查失败时，使用默认过滤条件</li>
                                                    <li>💾 <strong>存储限制：</strong>最多保存10个演员的过滤器记录，自动清理旧记录</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group" data-subtab="actor">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🧭 影片分段显示</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="aeEnableTimeSegmentationDivider"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在演员页的作品列表中，按时间阈值（默认6个月）在“近N个月”和“更早”之间插入一条高亮分隔线，增强时间分段的可读性。
                                        </p>

                                        <!-- 子设置：时间阈值（月） -->
                                        <div class="sub-settings" id="actorTimeSegmentationConfig" style="display: none;">
                                            <div class="sub-settings-header">
                                                <h5>🧭 分段配置</h5>
                                                <p class="sub-description">设置“近N个月”的时间阈值。</p>
                                            </div>
                                            <div class="form-group">
                                                <label for="aeTimeSegmentationMonths">时间阈值（月）:</label>
                                                <input type="number" id="aeTimeSegmentationMonths" class="number-input" min="1" max="24" value="6">
                                                <p class="input-description">用于区分“近N个月”和“更早”的临界值，默认 6 个月。</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group" data-subtab="video">
                                        <label class="checkbox-label">
                                            <div class="enhancement-feature-info">
                                                <div class="enhancement-feature-title">
                                                    <h6 class="enhancement-feature-name">🧲 磁力资源搜索</h6>
                                                    <span class="enhancement-feature-status available">可用</span>
                                                </div>
                                            </div>
                                            <div class="enhancement-toggle-wrapper">
                                                <button class="enhancement-toggle" data-target="enableMagnetSearch"></button>
                                            </div>
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在视频详情页自动搜索多个站点的磁力资源，自动识别画质和字幕<br>
                                            <strong>使用：</strong>进入视频详情页自动开始搜索，结果显示在磁力链接区域
                                        </p>

                                        <!-- 磁力搜索详细配置 -->
                                        <div class="sub-settings" id="magnetSourcesConfig" style="display: none;">
                                            <div class="sub-settings-header">
                                                <h5>🔍 搜索源配置</h5>
                                                <p class="sub-description">选择要搜索的磁力资源站点，建议保持默认选择以获得最佳搜索效果。</p>
                                            </div>

                                            <div class="sources-grid">
                                                <label class="checkbox-label">
                                                    <input type="checkbox" id="magnetSourceSukebei" checked>
                                                    <span class="checkmark"></span>
                                                    Sukebei (SUK)
                                                </label>
                                                <label class="checkbox-label">
                                                    <input type="checkbox" id="magnetSourceBtdig" checked>
                                                    <span class="checkmark"></span>
                                                    BTdig (BTD)
                                                </label>
                                                <label class="checkbox-label">
                                                    <input type="checkbox" id="magnetSourceBtsow" checked>
                                                    <span class="checkmark"></span>
                                                    BTSOW (BTS)
                                                </label>
                                                <label class="checkbox-label">
                                                    <input type="checkbox" id="magnetSourceTorrentz2">
                                                    <span class="checkmark"></span>
                                                    Torrentz2 (TZ2)
                                                </label>
                                            </div>

                                            <div class="info-box">
                                                <p><strong>搜索源说明：</strong></p>
                                                <ul>
                                                    <li><strong>Sukebei</strong> - 专业的成人内容磁力搜索引擎</li>
                                                    <li><strong>BTdig</strong> - 通用磁力搜索引擎</li>
                                                    <li><strong>BTSOW</strong> - 高质量磁力资源搜索</li>
                                                    <li><strong>Torrentz2</strong> - 综合磁力搜索聚合器</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>

                                    
                                </div>

                                <!-- 开发中 -->
                                <div class="settings-section">
                                </div>


                            </div>
                        </div>

                        <!-- 高级配置 -->
                        <div class="settings-panel" id="advanced-settings">
                            <div class="settings-panel-header">
                                <h3>高级配置</h3>
                                <p class="settings-description">高级用户可以在此处查看和编辑原始配置数据。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="settings-section">
                                    <h4>原始设置 (JSON)</h4>
                                    <div class="action-buttons-top">
                                        <button id="viewJsonBtn" class="btn">查看设置</button>
                                        <button id="editJsonBtn" class="btn">编辑设置</button>
                                        <button id="exportJsonBtn" class="btn">导出完整备份</button>
                                    </div>
                                    <p class="section-description">查看和编辑扩展的原始配置数据，支持JSON格式导入导出。</p>
                                </div>



                                <div class="settings-section">
                                    <h4>原始番号库数据 (Raw Records)</h4>
                                    <div class="action-buttons-top">
                                        <button id="viewRawRecordsBtn" class="btn">查看数据</button>
                                        <button id="checkDataStructureBtn" class="btn">检查数据结构</button>
                                    </div>
                                    <p class="section-description">查看番号库的原始数据结构，检查数据完整性和格式。</p>
                                </div>

                                <div class="settings-section">
                                    <h4>演员库管理</h4>
                                    <div class="action-buttons-top">
                                        <button id="viewActorsBtn" class="btn">查看演员数据</button>
                                        <button id="editActorsBtn" class="btn">编辑</button>
                                    </div>
                                    <div class="actors-stats" id="actorsStats" style="display:none">
                                        <div class="stats-grid">
                                            <div class="stat-item">
                                                <span class="stat-label">总演员数:</span>
                                                <span class="stat-value" id="totalActorsCount">0</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">女演员:</span>
                                                <span class="stat-value" id="femaleActorsCount">0</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">男演员:</span>
                                                <span class="stat-value" id="maleActorsCount">0</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">性别未知:</span>
                                                <span class="stat-value" id="unknownGenderCount">0</span>
                                            </div>
                                        </div>
                                    </div>

                                    <p class="section-description">查看演员库的详细数据，包含演员信息和统计数据。</p>
                                </div>

                                <div class="settings-section">
                                    <h4>原始日志 (Raw Logs)</h4>
                                    <div class="action-buttons-top">
                                        <button id="viewRawLogsBtn" class="btn">查看日志</button>
                                        <button id="testLogBtn" class="btn">测试日志</button>
                                    </div>
                                    <p class="section-description">查看扩展运行时产生的详细日志信息，用于调试和问题排查。</p>
                                </div>
                            </div>
                        </div>

                        <!-- 日志设置 -->
                        <div class="settings-panel" id="log-settings">
                            <div class="settings-panel-header">
                                <h3>日志设置</h3>
                                <p class="settings-description">配置扩展程序的日志记录行为。</p>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 全局控制 -->
                                <div class="logging-section log-global">
                                    <h4><i class="fas fa-sliders-h"></i> 全局控制</h4>
                                    <p class="section-description">控制所有日志的全局行为和存储设置。</p>

                                    <div class="log-controls" style="margin-bottom: 20px;">
                                        <button type="button" id="consoleMuteAll" class="btn btn-secondary">
                                            <i class="fas fa-volume-mute"></i> 全部静默
                                        </button>
                                        <button type="button" id="consoleEnableAll" class="btn btn-primary">
                                            <i class="fas fa-volume-up"></i> 全部启用
                                        </button>
                                        <button type="button" id="consoleResetDefault" class="btn btn-info">
                                            <i class="fas fa-undo"></i> 恢复默认
                                        </button>
                                    </div>

                                    <div class="form-group">
                                        <label for="consoleLevel">日志级别（全局阈值）</label>
                                        <select id="consoleLevel" class="text-input">
                                            <option value="OFF">OFF - 关闭所有日志</option>
                                            <option value="ERROR">ERROR - 仅错误</option>
                                            <option value="WARN">WARN - 警告及以上</option>
                                            <option value="INFO">INFO - 信息及以上</option>
                                            <option value="DEBUG" selected>DEBUG - 全部显示</option>
                                        </select>
                                        <p class="input-description">全局过滤：只显示该级别及以上的日志。与下方"功能模块日志"联动生效（两者都满足才显示）。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="maxLogEntries">最大日志记录数</label>
                                        <input type="number" id="maxLogEntries" class="number-input" min="100" max="10000" value="1000">
                                        <p class="input-description">持久化日志的最大保存条数（100-10000），超出后自动清理旧日志。</p>
                                    </div>

                                    <!-- 旧的日志开关（向后兼容） -->
                                    <div style="display: none;">
                                        <input type="checkbox" id="verboseMode">
                                        <input type="checkbox" id="showPrivacyLogs">
                                        <input type="checkbox" id="showStorageLogs">
                                    </div>
                                </div>

                                <!-- 日志格式设置 -->
                                <div class="logging-section log-format">
                                    <h4><i class="fas fa-paint-brush"></i> 显示格式</h4>
                                    <p class="section-description">自定义控制台日志的显示样式。</p>

                                    <div class="checkbox-grid" style="display:grid; grid-template-columns: repeat(2, 1fr); gap:12px;">
                                        <div class="form-group-checkbox">
                                            <input type="checkbox" id="consoleShowTimestamp" checked>
                                            <label for="consoleShowTimestamp">
                                                <i class="fas fa-clock"></i> 显示时间戳
                                            </label>
                                        </div>
                                        <div class="form-group-checkbox">
                                            <input type="checkbox" id="consoleShowMilliseconds">
                                            <label for="consoleShowMilliseconds">
                                                <i class="fas fa-stopwatch"></i> 显示毫秒
                                            </label>
                                        </div>
                                        <div class="form-group-checkbox">
                                            <input type="checkbox" id="consoleShowSource" checked>
                                            <label for="consoleShowSource">
                                                <i class="fas fa-tag"></i> 显示来源标签
                                            </label>
                                        </div>
                                        <div class="form-group-checkbox">
                                            <input type="checkbox" id="consoleColor" checked>
                                            <label for="consoleColor">
                                                <i class="fas fa-palette"></i> 彩色输出
                                            </label>
                                        </div>
                                    </div>

                                    <div class="form-group" style="margin-top: 15px;">
                                        <label for="consoleTimeZone">时区设置</label>
                                        <select id="consoleTimeZone" class="text-input">
                                            <optgroup label="亚洲">
                                                <option value="Asia/Shanghai" selected>中国标准时间 (UTC+8)</option>
                                                <option value="Asia/Hong_Kong">香港时间 (UTC+8)</option>
                                                <option value="Asia/Taipei">台北时间 (UTC+8)</option>
                                                <option value="Asia/Tokyo">日本标准时间 (UTC+9)</option>
                                                <option value="Asia/Seoul">韩国标准时间 (UTC+9)</option>
                                                <option value="Asia/Singapore">新加坡时间 (UTC+8)</option>
                                                <option value="Asia/Bangkok">曼谷时间 (UTC+7)</option>
                                                <option value="Asia/Dubai">迪拜时间 (UTC+4)</option>
                                            </optgroup>
                                            <optgroup label="欧洲">
                                                <option value="Europe/London">伦敦时间 (UTC+0/+1)</option>
                                                <option value="Europe/Paris">巴黎时间 (UTC+1/+2)</option>
                                                <option value="Europe/Berlin">柏林时间 (UTC+1/+2)</option>
                                                <option value="Europe/Moscow">莫斯科时间 (UTC+3)</option>
                                            </optgroup>
                                            <optgroup label="美洲">
                                                <option value="America/New_York">纽约时间 (UTC-5/-4)</option>
                                                <option value="America/Chicago">芝加哥时间 (UTC-6/-5)</option>
                                                <option value="America/Denver">丹佛时间 (UTC-7/-6)</option>
                                                <option value="America/Los_Angeles">洛杉矶时间 (UTC-8/-7)</option>
                                                <option value="America/Toronto">多伦多时间 (UTC-5/-4)</option>
                                                <option value="America/Vancouver">温哥华时间 (UTC-8/-7)</option>
                                                <option value="America/Sao_Paulo">圣保罗时间 (UTC-3)</option>
                                            </optgroup>
                                            <optgroup label="大洋洲">
                                                <option value="Australia/Sydney">悉尼时间 (UTC+10/+11)</option>
                                                <option value="Australia/Melbourne">墨尔本时间 (UTC+10/+11)</option>
                                                <option value="Pacific/Auckland">奥克兰时间 (UTC+12/+13)</option>
                                            </optgroup>
                                            <optgroup label="其他">
                                                <option value="UTC">协调世界时 (UTC+0)</option>
                                            </optgroup>
                                        </select>
                                        <p class="input-description">选择您所在的时区，用于格式化日志时间戳显示。</p>
                                    </div>
                                </div>

                                <!-- 功能模块日志开关 -->
                                <div class="logging-section log-modules">
                                    <h4><i class="fas fa-th-large"></i> 功能模块日志</h4>
                                    <p class="section-description">按功能模块精细控制日志输出。<strong>注意：需同时满足上方"日志级别"阈值才会显示。</strong></p>

                                    <!-- 树状结构 -->
                                    <div class="log-tree">
                                        <!-- 核心功能 -->
                                        <div class="log-tree-node">
                                            <div class="log-tree-header">
                                                <i class="fas fa-cube"></i>
                                                <span class="log-tree-title">核心功能</span>
                                                <span class="log-tree-desc">扩展的基础运行模块</span>
                                            </div>
                                            <div class="log-tree-children">
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleCore">
                                                    <label for="logModuleCore">
                                                        <i class="fas fa-cog"></i>
                                                        <span class="item-name">核心系统</span>
                                                        <span class="item-tag">[CORE]</span>
                                                    </label>
                                                    <span class="item-desc">扩展主程序、初始化、配置加载</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleOrchestrator">
                                                    <label for="logModuleOrchestrator">
                                                        <i class="fas fa-project-diagram"></i>
                                                        <span class="item-name">任务编排</span>
                                                        <span class="item-tag">[ORCH]</span>
                                                    </label>
                                                    <span class="item-desc">任务调度、协调、队列管理</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleStorage">
                                                    <label for="logModuleStorage">
                                                        <i class="fas fa-database"></i>
                                                        <span class="item-name">数据存储</span>
                                                        <span class="item-tag">[STORAGE]</span>
                                                    </label>
                                                    <span class="item-desc">本地数据库读写、缓存操作</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 业务功能 -->
                                        <div class="log-tree-node">
                                            <div class="log-tree-header">
                                                <i class="fas fa-briefcase"></i>
                                                <span class="log-tree-title">业务功能</span>
                                                <span class="log-tree-desc">核心业务逻辑模块</span>
                                            </div>
                                            <div class="log-tree-children">
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleActor">
                                                    <label for="logModuleActor">
                                                        <i class="fas fa-user"></i>
                                                        <span class="item-name">演员管理</span>
                                                        <span class="item-tag">[ACTOR]</span>
                                                    </label>
                                                    <span class="item-desc">演员数据同步、订阅、收藏</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleMagnet">
                                                    <label for="logModuleMagnet">
                                                        <i class="fas fa-magnet"></i>
                                                        <span class="item-name">磁力搜索</span>
                                                        <span class="item-tag">[MAGNET]</span>
                                                    </label>
                                                    <span class="item-desc">磁力链接搜索、解析、下载</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleSync">
                                                    <label for="logModuleSync">
                                                        <i class="fas fa-sync"></i>
                                                        <span class="item-name">数据同步</span>
                                                        <span class="item-tag">[SYNC]</span>
                                                    </label>
                                                    <span class="item-desc">WebDAV、云端备份与恢复</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 扩展功能 -->
                                        <div class="log-tree-node">
                                            <div class="log-tree-header">
                                                <i class="fas fa-puzzle-piece"></i>
                                                <span class="log-tree-title">扩展功能</span>
                                                <span class="log-tree-desc">增强与集成模块</span>
                                            </div>
                                            <div class="log-tree-children">
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleDrive115">
                                                    <label for="logModuleDrive115">
                                                        <i class="fas fa-cloud"></i>
                                                        <span class="item-name">115网盘</span>
                                                        <span class="item-tag">[115]</span>
                                                    </label>
                                                    <span class="item-desc">115网盘离线下载、文件管理</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModulePrivacy">
                                                    <label for="logModulePrivacy">
                                                        <i class="fas fa-shield-alt"></i>
                                                        <span class="item-name">隐私保护</span>
                                                        <span class="item-tag">[PRIVACY]</span>
                                                    </label>
                                                    <span class="item-desc">隐私模式、密码锁、数据加密</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleAI">
                                                    <label for="logModuleAI">
                                                        <i class="fas fa-robot"></i>
                                                        <span class="item-name">AI功能</span>
                                                        <span class="item-tag">[AI]</span>
                                                    </label>
                                                    <span class="item-desc">AI对话、智能分析、推荐</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 系统功能 -->
                                        <div class="log-tree-node">
                                            <div class="log-tree-header">
                                                <i class="fas fa-cogs"></i>
                                                <span class="log-tree-title">系统功能</span>
                                                <span class="log-tree-desc">系统级功能模块</span>
                                            </div>
                                            <div class="log-tree-children">
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleUpdate">
                                                    <label for="logModuleUpdate">
                                                        <i class="fas fa-sync-alt"></i>
                                                        <span class="item-name">更新检查</span>
                                                        <span class="item-tag">[UPDATE]</span>
                                                    </label>
                                                    <span class="item-desc">版本检查、更新提示</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleHelp">
                                                    <label for="logModuleHelp">
                                                        <i class="fas fa-question-circle"></i>
                                                        <span class="item-name">帮助系统</span>
                                                        <span class="item-tag">[HELP]</span>
                                                    </label>
                                                    <span class="item-desc">帮助面板、内容映射</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleSettings">
                                                    <label for="logModuleSettings">
                                                        <i class="fas fa-sliders-h"></i>
                                                        <span class="item-name">设置管理</span>
                                                        <span class="item-tag">[SETTINGS]</span>
                                                    </label>
                                                    <span class="item-desc">设置加载、保存、验证</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 其他 -->
                                        <div class="log-tree-node">
                                            <div class="log-tree-header">
                                                <i class="fas fa-ellipsis-h"></i>
                                                <span class="log-tree-title">其他</span>
                                                <span class="log-tree-desc">通用与调试模块</span>
                                            </div>
                                            <div class="log-tree-children">
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleGeneral">
                                                    <label for="logModuleGeneral">
                                                        <i class="fas fa-list"></i>
                                                        <span class="item-name">通用日志</span>
                                                        <span class="item-tag">[GENERAL]</span>
                                                    </label>
                                                    <span class="item-desc">未分类的通用日志信息</span>
                                                </div>
                                                <div class="log-tree-item">
                                                    <input type="checkbox" id="logModuleDebug">
                                                    <label for="logModuleDebug">
                                                        <i class="fas fa-bug"></i>
                                                        <span class="item-name">调试模式</span>
                                                        <span class="item-tag">[DEBUG]</span>
                                                    </label>
                                                    <span class="item-desc">详细的调试信息（开发用）</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 说明提示 -->
                                    <div class="log-help-box">
                                        <i class="fas fa-info-circle"></i>
                                        <div class="log-help-content">
                                            <strong>如何使用：</strong>
                                            <ul>
                                                <li>勾选模块后，该模块的日志会在浏览器控制台（F12）中显示</li>
                                                <li>日志格式：<code>[时间] [级别] [标签] 消息内容</code></li>
                                                <li>例如：<code>[14:46:30] [INFO] [DB] 初始化完成</code> 表示核心系统的信息日志</li>
                                                <li>建议：日常使用保持默认配置，遇到问题时再启用相关模块的日志</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI设置 -->
                        <div class="settings-panel" id="ai-settings">
                            <div class="settings-panel-header">
                                <h3>AI设置</h3>
                                <p class="settings-description">配置AI功能，对接New API兼容的AI服务，支持流式对话和多模型选择。</p>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 基础配置 -->
                                <div class="settings-section">
                                    <h4><i class="fas fa-cog"></i> 基础配置</h4>

                                    <div class="form-group-checkbox">
                                        <input type="checkbox" id="aiEnabled">
                                        <label for="aiEnabled">
                                            <i class="fas fa-power-off"></i>
                                            启用AI功能
                                        </label>
                                        <p class="input-description">开启后可以使用AI聊天和智能助手功能。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="aiApiUrl">
                                            <i class="fas fa-link"></i>
                                            API服务地址:
                                        </label>
                                        <input type="url" id="aiApiUrl" class="text-input"
                                               placeholder="https://api.openai.com 或其他兼容服务地址">
                                        <p class="input-description">支持OpenAI API或One API兼容的服务地址。（不需要加“/v1”）</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="aiApiKey">
                                            <i class="fas fa-key"></i>
                                            API密钥:
                                        </label>
                                        <div class="form-group-inline">
                                            <input type="password" id="aiApiKey" class="text-input"
                                                   placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                                            <button type="button" id="toggleApiKeyVisibility" class="btn btn-secondary">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button type="button" id="testAiConnection" class="btn btn-primary">
                                                <i class="fas fa-plug"></i>
                                                测试连接
                                            </button>
                                        </div>
                                        <p class="input-description">从AI服务提供商获取的API密钥，用于身份验证。</p>
                                    </div>

                                    <div id="aiConnectionStatus" class="connection-status" style="display: none;">
                                        <!-- 连接状态将在这里显示 -->
                                    </div>
                                </div>

                                <!-- 模型选择 -->
                                <div class="settings-section">
                                    <h4><i class="fas fa-brain"></i> 模型选择</h4>

                                    <div class="form-group">
                                        <label for="aiSelectedModel">
                                            <i class="fas fa-robot"></i>
                                            当前模型:
                                        </label>
                                        <div class="form-group-inline">
                                            <select id="aiSelectedModel" class="select-input">
                                                <option value="">请先配置API并测试连接</option>
                                            </select>
                                            <button type="button" id="refreshModels" class="btn btn-secondary">
                                                <i class="fas fa-sync-alt"></i>
                                                刷新
                                            </button>
                                        </div>
                                        <p class="input-description">选择要使用的AI模型，不同模型有不同的能力和价格。</p>
                                    </div>

                                    <div id="modelInfo" class="model-info" style="display: none;">
                                        <!-- 模型信息将在这里显示 -->
                                    </div>

                                    <div id="modelStats" class="model-stats" style="display: none;">
                                        <!-- 模型统计信息将在这里显示 -->
                                    </div>
                                </div>

                                <!-- 测试功能 -->
                                <div class="settings-section">
                                    <h4><i class="fas fa-vial"></i> 测试功能</h4>

                                    <div class="form-group">
                                        <label for="aiTestInput">
                                            <i class="fas fa-comment"></i>
                                            测试对话:
                                        </label>
                                        <div class="form-group-inline">
                                            <input type="text" id="aiTestInput" class="text-input"
                                                   placeholder="输入测试消息，例如：你好">
                                            <button type="button" id="sendTestMessage" class="btn btn-primary">
                                                <i class="fas fa-paper-plane"></i>
                                                发送
                                            </button>
                                        </div>
                                        <p class="input-description">测试AI功能是否正常工作。</p>
                                    </div>

                                    <div id="aiTestResult" class="test-result" style="display: none;">
                                        <!-- 测试结果将在这里显示 -->
                                    </div>
                                </div>

                                <!-- 对话参数 -->
                                <div class="settings-section ai-conversation-params">
                                    <h4><i class="fas fa-cog"></i> 对话参数</h4>

                                    <div class="params-grid">
                                        <!-- 输入框类型 -->
                                        <div class="param-item">
                                            <label for="aiTemperature">
                                                创造性: <span id="temperatureValue">0.7</span>
                                                <i class="fas fa-question-circle param-tooltip" title="控制AI回答的创造性，值越高越有创意，值越低越准确"></i>
                                            </label>
                                            <input type="range" id="aiTemperature" min="0.1" max="2.0" step="0.1" value="0.7" class="range-input">
                                        </div>

                                        <div class="param-item">
                                            <label for="aiMaxTokens">
                                                最大回复长度
                                                <i class="fas fa-question-circle param-tooltip" title="限制AI单次回复的最大长度，1 token ≈ 0.75个英文单词。支持1-1,000,000 tokens"></i>
                                            </label>
                                            <input type="number" id="aiMaxTokens" class="number-input"
                                                   min="1" max="1000000" value="2048">
                                        </div>

                                        <div class="param-item">
                                            <label for="aiTimeout">
                                                超时时间 (秒)
                                                <i class="fas fa-question-circle param-tooltip" title="API请求的超时时间，建议30-60秒"></i>
                                            </label>
                                            <input type="number" id="aiTimeout" class="number-input"
                                                   min="5" max="300" value="30">
                                        </div>

                                        <!-- 系统提示词（全宽） -->
                                        <div class="param-item param-full">
                                            <label for="aiSystemPrompt">
                                                系统提示词
                                                <i class="fas fa-question-circle param-tooltip" title="定义AI的角色和行为方式，影响所有对话的回复风格"></i>
                                            </label>
                                            <textarea id="aiSystemPrompt" class="textarea-input" rows="2"
                                                      placeholder="你是一个有用的AI助手，请用中文回答问题。">你是一个有用的AI助手，请用中文回答问题。</textarea>
                                        </div>

                                        <!-- 复选框类型 -->
                                        <div class="param-item param-checkbox">
                                            <input type="checkbox" id="aiStreamEnabled" checked>
                                            <label for="aiStreamEnabled">
                                                启用流式输出
                                                <i class="fas fa-question-circle param-tooltip" title="实时显示AI回复内容，类似ChatGPT的打字效果"></i>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- 高级功能 -->
                                <div class="settings-section">
                                    <h4><i class="fas fa-tools"></i> 高级功能</h4>

                                    <div class="form-group">
                                        <label>
                                            <i class="fas fa-cog"></i>
                                            设置管理:
                                        </label>
                                        <div class="form-group-inline">
                                            <button type="button" id="exportAiSettings" class="btn btn-export">
                                                <i class="fas fa-download"></i>
                                                导出设置
                                            </button>
                                            <button type="button" id="importAiSettings" class="btn btn-import">
                                                <i class="fas fa-upload"></i>
                                                导入设置
                                            </button>
                                            <button type="button" id="clearTestResults" class="btn btn-clear">
                                                <i class="fas fa-trash"></i>
                                                清除测试结果
                                            </button>
                                            <button id="resetAiSettings" class="btn btn-reset">
                                                <i class="fas fa-undo"></i>
                                                重置为默认
                                            </button>
                                        </div>
                                        <p class="input-description">导出设置用于备份，导入设置用于恢复配置（不包含API密钥）。</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 全局操作 -->
                        <div class="settings-panel" id="global-actions">
                            <div class="settings-panel-header">
                                <h3>全局操作</h3>
                                <p class="settings-description">执行全局性的数据管理操作。请谨慎使用这些功能。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="settings-section">
                                    <h4>数据管理</h4>
                                    <div class="action-buttons-top">
                                        <button id="clearAllBtn" class="btn danger">清空所有本地记录</button>
                                        <button id="exportAllBtn" class="btn">导出所有数据</button>
                                        <button id="importAllBtn" class="btn">导入数据</button>
                                        <input type="file" id="importAllFile" accept=".json" style="display: none;">
                                    </div>
                                    <p class="input-description">
                                        <strong>清空所有本地记录:</strong> 删除所有本地存储的视频记录、演员数据和设置。此操作不可撤销！<br>
                                        <strong>导出所有数据:</strong> 将所有数据导出为JSON文件，用于备份或迁移。<br>
                                        <strong>导入数据:</strong> 从JSON文件导入数据，可用于恢复备份或迁移数据。
                                    </p>
                                </div>

                                <div class="settings-section">
                                    <h4>缓存管理</h4>
                                    <div class="action-buttons-top">
                                        <button id="clearCacheBtn" class="btn">清空缓存</button>
                                        <button id="clearTempDataBtn" class="btn">清空临时数据</button>
                                    </div>
                                    <p class="input-description">
                                        <strong>清空缓存:</strong> 清除所有缓存的图片、头像等临时文件。<br>
                                        <strong>清空临时数据:</strong> 清除搜索历史、临时设置等非关键数据。
                                    </p>
                                </div>

                                <div class="settings-section">
                                    <h4>系统操作</h4>
                                    <div class="action-buttons-top">
                                        <button id="resetSettingsBtn" class="btn warning">重置所有设置</button>
                                        <button id="reloadExtensionBtn" class="btn">重新加载扩展</button>
                                    </div>
                                    <p class="input-description">
                                        <strong>重置所有设置:</strong> 将所有设置恢复为默认值，但保留数据记录。<br>
                                        <strong>重新加载扩展:</strong> 重新加载扩展程序，用于解决某些问题。
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Emby增强设置 -->
                        <div class="settings-panel" id="emby-settings">
                            <div class="settings-panel-header">
                                <h3>Emby增强设置</h3>
                                <p class="settings-description">配置Emby/Jellyfin等媒体服务器的番号识别和跳转功能，自动将页面中的番号转换为可点击的链接。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="settings-section">
                                    <div class="test-info" style="margin-bottom: 12px; background-color: #fef3c7; color: #92400e; border: 1px solid #fcd34d;">
                                        <strong>测试功能</strong>：该功能仍在测试中，可能不稳定或与部分站点不兼容。建议先在本地环境尝试，遇到问题请在 issue 中反馈。可随时通过“启用Emby增强功能”开关关闭。
                                    </div>
                                </div>
                                <div class="settings-section">
                                    <h4>基本设置</h4>
                                    <div class="setting-item">
                                        <label class="setting-label">
                                            <input type="checkbox" id="emby-enabled">
                                            <span class="setting-title">启用Emby增强功能</span>
                                        </label>
                                        <p class="setting-description">
                                            启用后，扩展将在匹配的网站上自动识别番号并转换为可点击的链接。
                                        </p>
                                    </div>
                                </div>

                                <div class="settings-section">
                                    <h4>网址匹配</h4>
                                    <p class="setting-description">
                                        配置需要启用番号识别功能的网址模式。支持通配符 * 匹配任意字符。
                                    </p>
                                    <div class="setting-item">
                                        <div class="url-list-container">
                                            <div id="emby-match-urls-list" class="url-list">
                                                <!-- URL列表将通过JavaScript动态生成 -->
                                            </div>
                                            <button type="button" id="add-emby-url" class="btn btn-secondary">
                                                <i class="fas fa-plus"></i> 添加网址模式
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-section">
                                    <h4>链接行为</h4>
                                    <div class="setting-item">
                                        <label class="setting-label">
                                            <span class="setting-title">点击番号后的行为</span>
                                            <select id="emby-link-behavior" class="setting-select">
                                                <option value="javdb-search">跳转到JavDB搜索页面</option>
                                                <option value="javdb-direct">直接跳转到JavDB详情页（如果存在）</option>
                                            </select>
                                        </label>
                                        <p class="setting-description">
                                            选择点击番号链接后的跳转行为。推荐使用搜索模式以确保能找到相关内容。
                                        </p>
                                    </div>
                                </div>

                                <div class="settings-section">
                                    <h4>高级选项</h4>
                                    <div class="setting-item">
                                        <label class="setting-label">
                                            <input type="checkbox" id="emby-auto-detection">
                                            <span class="setting-title">启用自动检测</span>
                                        </label>
                                        <p class="setting-description">
                                            自动检测页面中的番号并转换为链接。关闭此选项后需要手动触发检测。
                                        </p>
                                    </div>
                                </div>

                                <div class="settings-section">
                                    <h4>快捷按钮</h4>
                                    <div class="setting-item">
                                        <label class="setting-label">
                                            <input type="checkbox" id="emby-show-quick-search-code">
                                            <span class="setting-title">显示“搜番号”按钮</span>
                                        </label>
                                        <p class="setting-description">在右侧显示悬浮按钮，快速按页面内容或选中文本进行番号搜索/直达。</p>
                                    </div>
                                    <div class="setting-item">
                                        <label class="setting-label">
                                            <input type="checkbox" id="emby-show-quick-search-actor">
                                            <span class="setting-title">显示“搜演员”按钮</span>
                                        </label>
                                        <p class="setting-description">在右侧显示悬浮按钮，快速按页面内容或选中文本进行演员搜索。</p>
                                    </div>
                                </div>

                                <div class="settings-section">
                                    <h4>测试功能</h4>
                                    <div class="setting-item">
                                        <div class="test-buttons-group">
                                            <button type="button" id="test-current-page" class="btn btn-primary">
                                                <i class="fas fa-globe"></i> 测试当前页面
                                            </button>
                                            <button type="button" id="test-sample-urls" class="btn btn-secondary">
                                                <i class="fas fa-vial"></i> 测试示例网址
                                            </button>
                                        </div>
                                        <p class="setting-description">
                                            测试网址模式匹配功能。可以测试当前页面或使用预设的示例网址（包含匹配和不匹配的案例）。
                                        </p>
                                        <div id="test-result" class="test-result"></div>
                                    </div>
                                </div>

                                <div class="settings-section">
                                    <h4>使用说明</h4>
                                    <div class="help-content">
                                        <ul>
                                            <li><strong>网址模式:</strong> 使用通配符 * 匹配任意字符，如 *.emby.com/* 匹配所有emby.com的子域名</li>
                                            <li><strong>番号识别:</strong> 自动识别常见的番号格式，如 ABC-123、FC2-PPV-123456 等</li>
                                            <li><strong>链接跳转:</strong> 所有链接都会在新标签页中打开，不影响当前页面</li>
                                            <li><strong>兼容性:</strong> 支持Emby、Jellyfin等主流媒体服务器</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 检查更新设置 -->
                        <div class="settings-panel" id="update-settings">
                            <div class="settings-panel-header">
                                <h3>检查更新</h3>
                                <p class="settings-description">管理扩展程序的更新检查设置，获取最新版本信息。</p>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 版本信息卡片 -->
                                <div class="settings-section">
                                    <h4>版本信息</h4>
                                    <div class="version-info">
                                        <div class="version-item">
                                            <span class="version-label">当前版本</span>
                                            <span class="version-value" id="currentVersion">加载中...</span>
                                        </div>
                                        <div class="version-item">
                                            <span class="version-label">最新版本</span>
                                            <span class="version-value" id="latestVersion">检查中...</span>
                                        </div>
                                        <div class="version-item">
                                            <span class="version-label">上次检查</span>
                                            <span class="version-value" id="lastUpdateCheck">从未检查</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- 自动检查设置卡片 -->
                                <div class="settings-section auto-check-section">
                                    <div class="section-header">
                                        <h4>
                                            <span class="section-icon">⚙️</span>
                                            自动检查设置
                                        </h4>
                                        <p class="section-description">配置自动更新检查的频率和范围</p>
                                    </div>
                                    
                                    <div class="auto-check-card">
                                        <div class="setting-item">
                                            <div class="setting-info">
                                                <div class="setting-title">
                                                    <span class="setting-icon">🔔</span>
                                                    启用自动检查更新
                                                </div>
                                                <div class="setting-desc">定期自动检查是否有新版本发布</div>
                                            </div>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="autoUpdateCheck">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>

                                        <div class="setting-item">
                                            <div class="setting-info">
                                                <div class="setting-title">
                                                    <span class="setting-icon">⏱️</span>
                                                    检查间隔
                                                </div>
                                                <div class="setting-desc">设置自动检查更新的时间间隔</div>
                                            </div>
                                            <div class="setting-control">
                                                <select id="updateCheckInterval" class="modern-select">
                                                    <option value="6">每 6 小时</option>
                                                    <option value="12">每 12 小时</option>
                                                    <option value="24">每 24 小时</option>
                                                    <option value="72">每 3 天</option>
                                                    <option value="168">每周</option>
                                                </select>
                                            </div>
                                        </div>

                                        <div class="setting-item">
                                            <div class="setting-info">
                                                <div class="setting-title">
                                                    <span class="setting-icon">🧪</span>
                                                    包含预发布版本
                                                </div>
                                                <div class="setting-desc">检查时包含测试版和预览版</div>
                                            </div>
                                            <label class="toggle-switch">
                                                <input type="checkbox" id="includePrerelease">
                                                <span class="toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- 手动操作区域 -->
                                <div class="settings-section">
                                    <h4>手动操作</h4>
                                    <div class="action-buttons-top">
                                        <button id="checkUpdateNow" class="btn primary">立即检查</button>
                                        <button id="viewChangelog" class="btn">查看更新日志</button>
                                        <button id="downloadUpdate" class="btn success" style="display: none;">下载更新</button>
                                    </div>
                                    <p class="input-description" style="margin-top: 12px; color: #6b7280; font-size: 13px; line-height: 1.6;">
                                        <strong style="color: #1f2937;">立即检查:</strong> 手动检查是否有新版本可用<br>
                                        <strong style="color: #1f2937;">查看更新日志:</strong> 查看最新版本的更新内容和修复<br>
                                        <strong style="color: #1f2937;">下载更新:</strong> 当有新版本时，跳转到下载页面
                                    </p>
                                </div>

                                <!-- 更新通知区域 -->
                                <div class="settings-section" id="updateNotification" style="display: none;">
                                    <h4>更新通知</h4>
                                    <div class="update-notification">
                                        <div class="notification-content">
                                            <i class="fas fa-info-circle"></i>
                                            <span id="updateMessage">检查更新状态...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
