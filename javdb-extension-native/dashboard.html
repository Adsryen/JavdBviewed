<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>JavDB 助手仪表盘</title>
  <link rel="stylesheet" href="dashboard.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <h1 class="panel-title">JavDB 助手 <span id="helpBtn" title="功能说明">❓</span></h1>

            <div class="sidebar-section">
                <h4>数据概览</h4>
                <div id="stats-overview">
                    <!-- 统计信息将由 JS 动态填充 -->
                </div>
            </div>

            <div class="sidebar-section">
                <h4>本地备份</h4>
                <div class="button-group-vertical">
                    <label for="importFile" class="button-like">导入本地备份 (JSON)</label>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                    <button id="exportBtn">导出本地备份 (JSON)</button>
                </div>
            </div>

            <div class="sidebar-section">
                <h4>WebDAV 同步</h4>
                <div class="button-group-vertical">
                    <button id="syncNow">立即上传至云端</button>
                    <button id="syncDown">从云端恢复...</button>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h4>全局操作</h4>
                <div class="button-group-vertical">
                    <button id="clearAllBtn" class="danger">清空所有本地记录</button>
                </div>
            </div>

            <div id="infoContainer">
                <!-- 版本和作者信息将由 JS 动态填充 -->
            </div>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab-link active" data-tab="tab-records">观看记录</button>
                <button class="tab-link" data-tab="tab-settings">设置</button>
                <button class="tab-link" data-tab="tab-advanced-settings">高级配置</button>
                <button class="tab-link" data-tab="tab-logs">日志</button>
            </div>
    
            <div id="tab-records" class="tab-content active">
                <div class="card">
                    <div class="search-and-filter">
                        <input type="text" id="searchInput" placeholder="搜索番号、标题...">
                        <select id="filterSelect">
                            <option value="all">所有记录</option>
                            <option value="viewed">已观看</option>
                            <option value="later">稍后观看</option>
                        </select>
                    </div>
                    <div class="video-list-container">
                        <ul id="videoList">
                            <!-- 视频列表将由 JS 动态填充 -->
                        </ul>
                    </div>
                    <div class="pagination">
                        <!-- 分页控件将由 JS 动态填充 -->
                    </div>
                </div>
            </div>
    
            <div id="tab-settings" class="tab-content">
                <div class="card">
                    <div class="settings-section">
                        <h3>列表显示设置</h3>
                        <p class="settings-description">控制在JavDB网站上访问时，是否自动隐藏符合条件的影片。</p>
                        <div class="form-group-checkbox">
                            <input type="checkbox" id="hideWatchedVideos">
                            <label for="hideWatchedVideos">隐藏已标记"看过"的影片</label>
                        </div>
                        <div class="form-group-checkbox">
                            <input type="checkbox" id="hideViewedVideos">
                            <label for="hideViewedVideos">隐藏已浏览详情页的影片</label>
                        </div>
                        <div class="form-group-checkbox">
                            <input type="checkbox" id="hideVRVideos">
                            <label for="hideVRVideos">隐藏所有VR影片</label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>WebDAV 设置</h3>
                        <p class="settings-description">通过WebDAV协议，将您的观看记录备份到兼容的云存储服务（如：坚果云、Nextcloud等）。</p>
                        <div class="form-group">
                            <label for="webdavEnabled">启用 WebDAV 同步</label>
                            <input type="checkbox" id="webdavEnabled">
                        </div>
                        <div id="webdav-fields-container">
                            <div class="form-group">
                                <label for="webdavUrl">WebDAV 地址:</label>
                                <input type="text" id="webdavUrl" placeholder="例如: https://dav.jianguoyun.com/dav/">
                            </div>
                            <div class="form-group">
                                <label for="webdavUser">用户名:</label>
                                <input type="text" id="webdavUser">
                            </div>
                            <div class="form-group">
                                <label for="webdavPass">密码/应用密钥:</label>
                                <input type="password" id="webdavPass">
                            </div>
                            <div class="form-group-checkbox">
                                <input type="checkbox" id="webdavAutoSync">
                                <label for="webdavAutoSync">每日自动上传</label>
                            </div>
                            <div class="button-group">
                                <button type="button" id="saveWebdavSettings">保存设置</button>
                                <button type="button" id="testWebdavConnection">测试连接</button>
                            </div>
                        </div>
                    </div>

                    <div id="fileListContainer" class="settings-section hidden">
                        <h4>云端文件列表 (点击恢复)</h4>
                        <ul id="fileList"></ul>
                    </div>
                </div>
            </div>

            <div id="tab-advanced-settings" class="tab-content">
                <div class="card">
                    <div class="settings-section">
                        <h3>原始JSON配置</h3>
                        <p class="settings-description">
                            这里显示了插件的所有内部配置。除非您了解其具体作用，否则请勿修改。
                            <strong>警告：不正确的修改可能导致插件功能异常。</strong>
                        </p>
                        <div class="button-group">
                            <button id="editJsonBtn">启用编辑</button>
                            <button id="saveJsonBtn" class="hidden">保存配置</button>
                        </div>
                        <textarea id="jsonConfig" readonly></textarea>
                    </div>
                </div>
            </div>

            <div id="tab-logs" class="tab-content">
                <div class="card">
                    <div class="settings-section">
                        <h4>日志记录</h4>
                        <p class="settings-description">此处显示插件运行期间的关键事件，便于问题排查。日志会自动保存。</p>
                        <div class="button-group">
                            <button id="clearLogsBtn" class="danger">清空日志</button>
                        </div>
                        <pre id="log"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>
  
  <div id="helpPanel"></div>
  <div id="messageContainer"></div>

  <script src="dashboard.js" type="module"></script>
</body>
</html> 