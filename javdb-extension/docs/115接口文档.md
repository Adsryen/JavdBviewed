# 授权

## 授权错误码

| 错误码 code | 描述                                                | 建议                                                         |
| ----------- | --------------------------------------------------- | ------------------------------------------------------------ |
| 40100000    | 参数缺失                                            |                                                              |
| 40101017    | 用户验证失败                                        |                                                              |
| 40110000    | 请求异常需要重试                                    |                                                              |
| 40140100    | client_id 错误                                      |                                                              |
| 40140101    | code_challenge 必填                                 |                                                              |
| 40140102    | code_challenge_method 必须是 sha256、sha1、md5 之一 |                                                              |
| 40140103    | sign 必填                                           |                                                              |
| 40140104    | sign 签名失败                                       |                                                              |
| 40140105    | 生成二维码失败                                      |                                                              |
| 40140106    | APP ID 无效                                         |                                                              |
| 40140107    | 应用不存在                                          |                                                              |
| 40140108    | 应用未审核通过                                      |                                                              |
| 40140109    | 应用已被停用                                        |                                                              |
| 40140110    | 应用已过期                                          |                                                              |
| 40140111    | APP Secret 错误                                     |                                                              |
| 40140112    | code_verifier 长度要求43~128位                      |                                                              |
| 40140113    | code_verifier 验证失败                              |                                                              |
| 40140114    | refresh_token 格式错误（防篡改）                    |                                                              |
| 40140115    | refresh_token 签名校验失败（防篡改）                |                                                              |
| 40140116    | refresh_token 无效（已解除授权）                    | 重新授权                                                     |
| 40140117    | access_token 刷新太频繁                             |                                                              |
| 40140118    | 开发者认证已过期                                    |                                                              |
| 40140119    | refresh_token 已过期                                | 重新授权                                                     |
| 40140120    | refresh_token 检验失败（防篡改）                    | 调用 /open/refreshToken 后，refresh_token 本身也会重新生成，检查本地是否有更新 refresh_token 的值 |
| 40140121    | access_token 刷新失败                               | 重试                                                         |
| 40140122    | 超出授权应用个数上限                                |                                                              |
| 40140123    | access_token 格式错误（防篡改）                     |                                                              |
| 40140124    | access_token 签名校验失败（防篡改）                 |                                                              |
| 40140125    | access_token 无效（已过期或者已解除授权）           | 调用 /open/refreshToken 刷新 token                           |
| 40140126    | access_token 校验失败（防篡改）                     |                                                              |
| 40140127    | response_type 错误                                  |                                                              |
| 40140128    | redirect_uri 缺少协议                               |                                                              |
| 40140129    | redirect_uri 缺少域名                               |                                                              |
| 40140130    | 没有配置重定向域名                                  | 到应用管理中配置域名                                         |
| 40140131    | redirect_uri 非法域名                               | 需要与应用管理应用配置的域名一致                             |
| 40140132    | grant_type 错误                                     |                                                              |
| 40140133    | client_secret 验证失败                              |                                                              |
| 40140134    | 授权码 code 验证失败                                |                                                              |
| 40140135    | client_id 验证失败                                  |                                                              |
| 40140136    | redirect_uri 验证失败（防MITM）                     |                                                              |

## 授权码模式

暂时使用[OpenList Token 获取工具](https://api.oplist.org/)的获取，开发者还在申请中

## **刷新 access_token**

### 基本信息

**接口名称：**

刷新 access_token

**接口路径：**

POST https://passportapi.115.com/open/refreshToken

### 备注

请勿频繁刷新，否则列入频控。

### 请求参数

**Headers**

| 参数名称     | 参数值                            | 是否必须 | 示例 | 备注 |
| ------------ | --------------------------------- | -------- | ---- | ---- |
| Content-Type | application/x-www-form-urlencoded | 是       |      |      |

**Body**

| 参数名称      | 参数类型 | 是否必须 | 示例 | 备注       |
| ------------- | -------- | -------- | ---- | ---------- |
| refresh_token | text     | 是       |      | 刷新的凭证 |

### 返回数据

| 名称             | 类型   | 是否必须 | 默认值 | 备注                                           | 其他信息      |
| ---------------- | ------ | -------- | ------ | ---------------------------------------------- | ------------- |
| state            | number | 非必须   |        |                                                |               |
| code             | number | 非必须   |        |                                                |               |
| message          | string | 非必须   |        |                                                |               |
| data             | object | 非必须   |        |                                                |               |
| ├─ access_token  | string | 非必须   |        | **新的** access_token，同时刷新有效期          |               |
| ├─ refresh_token | string | 非必须   |        | **新的** refresh_token，**有效期**不延长不改变 |               |
| ├─ expires_in    | number | 非必须   |        | access_token 有效期，单位秒                    | mock: 2592000 |
| error            | string | 非必须   |        |                                                |               |
| errno            | number | 非必须   |        |                                                |               |

# API列表

通常域名为：https://proapi.115.com/

## 用户管理

### 用户信息

API：GET 域名 + /open/user/info

说明：获取用户空间和vip信息

请求参数

Headers

| 参数名称      | 参数值              | 是否必须 | 示例                              |
| ------------- | ------------------- | -------- | --------------------------------- |
| Authorization | Bearer access_token | 是       | Bearer abcdefghijklmnopqrstuvwxyz |

返回数据

| state           | boolean | 接口状态；true正常；false：异常                              |
| --------------- | ------- | ------------------------------------------------------------ |
| message         | string  | 异常信息                                                     |
| code            | string  | 异常码                                                       |
| data            | object  | 数据                                                         |
| ├─user_id       | string  | 用户ID                                                       |
| ├─user_name     | string  | 用户名称                                                     |
| ├─user_face_s   | string  | 小尺寸用户头像                                               |
| ├─user_face_m   | string  | 中尺寸用户头像                                               |
| ├─user_face_l   | string  | 大尺寸用户头像                                               |
| ├─rt_space_info | object  | 用户空间信息                                                 |
| ├─all_total     | object  | 用户总空间                                                   |
| ├─size          | int     | 用户总空间大小(字节)                                         |
| ├─size_format   | string  | 用户总空间大小(格式化)                                       |
| ├─all_remain    | object  | 用户剩余空间                                                 |
| ├─size          | int     | 用户剩余空间大小(字节)                                       |
| ├─size_format   | string  | 用户剩余空间大小(格式化)                                     |
| ├─all_use       | object  | 用户已使用空间                                               |
| ├─size          | int     | 用户已使用空间大小(字节)                                     |
| ├─size_format   | string  | 用户已使用空间大小(格式化)                                   |
| ├─vip_info      | object  | 用户vip等级信息                                              |
| ├─level_name    | string  | vip等级名称；原石会员、尝鲜VIP、体验VIP、月费VIP、年费VIP、超级VIP、长期VIP； |
| ├─expire        | int     | 过期时间戳                                                   |

## 云下载

### 获取用户云下载任务列表

基本信息

Path 域名 + /open/offline/get_task_list 

Method：GET 

接口描述：获取用户云下载任务列表

请求参数head

| 参数名称      | 参数值              | 是否必须 | 示例                              |
| ------------- | ------------------- | -------- | --------------------------------- |
| Authorization | Bearer access_token | 是       | Bearer abcdefghijklmnopqrstuvwxyz |

请求参数

Query

| 参数名称 | 是否必须 | 示例 | 备注                           |
| -------- | -------- | ---- | ------------------------------ |
| page     | 否       | 1    | 获取列表第几，如不传默认第一页 |

返回数据说明

| 名称             | 类型    | 备注                                                   | 其他信息 |
| ---------------- | ------- | ------------------------------------------------------ | -------- |
| state            | boolean |                                                        |          |
| message          | string  |                                                        |          |
| code             | number  |                                                        |          |
| data             | array   |                                                        |          |
| ├─ page          | int     | 当前第几页                                             |          |
| ├─ page_count    | int     | 总页数                                                 |          |
| ├─ count         | int     | 总数量                                                 |          |
| ├─ tasks         | array   | 云下载任务列表                                         |          |
| ├─ info_hash     | string  | 任务sha1                                               |          |
| ├─ add_time      | int     | 任务添加时间戳                                         |          |
| ├─ percentDone   | int     | 任务下载进度                                           |          |
| ├─ size          | int     | 任务总大小（字节）                                     |          |
| ├─ name          | string  | 任务名                                                 |          |
| ├─ last_update   | int     | 任务最后更新时间戳                                     |          |
| ├─ file_id       | string  | 任务源文件（夹）对应文件（夹）id                       |          |
| ├─delete_file_id | string  | 删除任务需删除源文件（夹）时，对应需传递的文件（夹）id |          |
| ├─ status        | int     | 任务状态：-1下载失败；0分配中；1下载中；2下载成功      |          |
| ├─ url           | string  | 链接任务url                                            |          |
| ├─ wp_path_id    | string  | 任务源文件所在父文件夹id                               |          |
| ├─ def2          | int     | 视频清晰度；1:标清 2:高清 3:超清 4:1080P 5:4k;100:原画 |          |
| ├─ play_long     | int     | 视频时长                                               |          |
| ├─ can_appeal    | int     | 是否可申诉                                             |          |

### 获取云下载配额信息

基本信息

Path 域名 + /open/offline/get_quota_info

Method：GET 

接口描述：获取当前用户各个配额类型明细

请求参数

head

| 参数名称      | 参数值              | 是否必须 | 示例                              |
| ------------- | ------------------- | -------- | --------------------------------- |
| Authorization | Bearer access_token | 是       | Bearer abcdefghijklmnopqrstuvwxyz |

返回数据说明

| 名称           | 类型    | 备注                 | 其他信息 |
| -------------- | ------- | -------------------- | -------- |
| state          | boolean |                      |          |
| message        | string  |                      |          |
| code           | number  |                      |          |
| data           | array   |                      |          |
| ├─ package     | array   | 配额类型             |          |
| ├─ surplus     | int     | 该类型剩余配额       |          |
| ├─ used        | int     | 该类型已用配额       |          |
| ├─ count       | int     | 该类型总配额         |          |
| ├─ name        | string  | 该类型配额名称       |          |
| ├─ expire_info | array   | 该类型明细项过期信息 |          |
| ├─ surplus     | int     | 明细项剩余配额       |          |
| ├─ expire_time | int     | 明细项过期时间       |          |
| ├─ count       | int     | 用户总配额数量       |          |
| ├─ surplus     | int     | 用户总剩余配额数量   |          |
| ├─ used        | int     | 用户总已用配额数量   |          |

### 清空云下载任务

基本信息

Path 域名 + /open/offline/clear_task 

Method POST 

接口描述：清空云下载任务

请求参数

head

| 参数名称      | 参数值              | 是否必须 | 示例                              |
| ------------- | ------------------- | -------- | --------------------------------- |
| Authorization | Bearer access_token | 是       | Bearer abcdefghijklmnopqrstuvwxyz |

Body(form-data)

| 参数名称 | 参数类型 | 是否必须 | 示例 | 备注                                                         |
| -------- | -------- | -------- | ---- | ------------------------------------------------------------ |
| flag     | int      | 是       | 1    | 清除任务类型：0清空已完成、1清空全部、2清空失败、3清空进行中、4清空已完成任务并清空对应源文件、5清空全部任务并清空对应源文件 |

返回数据说明

| 字段    | 类型及范围 | 说明                                |
| ------- | ---------- | ----------------------------------- |
| state   | bool       | 操作结果状态值，true成功，false失败 |
| message | string     | 操作返回消息，成功时空值            |
| code    | int        | 操作返回号码，成功返回0             |
| data    | array      | 数据                                |

### 添加云下载链接任务

基本信息

Path 域名 + /open/offline/add_task_urls 

Method POST 

接口描述：添加云下载链接任务,支持多个链接url,换行符分隔，支持HTTP(S)、FTP、磁力链和电驴链接

请求参数

head

| 参数名称      | 参数值              | 是否必须 | 示例                              |
| ------------- | ------------------- | -------- | --------------------------------- |
| Authorization | Bearer access_token | 是       | Bearer abcdefghijklmnopqrstuvwxyz |

Body(form-data)

| 参数名称   | 参数类型 | 是否必须 | 示例 | 备注                                                       |
| ---------- | -------- | -------- | ---- | ---------------------------------------------------------- |
| urls       | string   | 是       |      | 多个链接url,换行符分隔，支持HTTP(S)、FTP、磁力链和电驴链接 |
| wp_path_id | string   | 否       | 0    | 保存目标文件夹id；如不传或传0，则默认保存到根目录下面      |

返回数据说明

| 字段        | 类型及范围 | 说明                                     |
| ----------- | ---------- | ---------------------------------------- |
| state       | bool       | 操作结果状态值，true成功，false失败      |
| message     | string     | 操作返回消息，成功时空值                 |
| code        | int        | 操作返回号码，成功时返回0                |
| data        | array      | 数据                                     |
| ├─state     | bool       | 链接任务添加状态，成功true；失败false    |
| ├─code      | int        | 链接任务状态码，成功返回0                |
| ├─message   | string     | 链接任务状态描述，成功返回空字符串       |
| ├─info_hash | string     | 链接任务sha1，只有任务成功的时候才会返回 |
| ├─url       | string     | 链接任务url                              |

### 删除用户云下载任务

基本信息

Path 域名 + /open/offline/del_task 

Method POST 

接口描述：删除用户云下载任务务

请求参数

head

| 参数名称      | 参数值              | 是否必须 | 示例                              |
| ------------- | ------------------- | -------- | --------------------------------- |
| Authorization | Bearer access_token | 是       | Bearer abcdefghijklmnopqrstuvwxyz |

Body(form-data)

| 参数名称        | 参数类型 | 是否必须 | 示例 | 备注                           |
| --------------- | -------- | -------- | ---- | ------------------------------ |
| info_hash       | string   | 是       |      | 需删除的任务hash               |
| del_source_file | int      | 否       |      | 是否删除源文件：1删除；0不删除 |

返回数据说明

| 字段    | 类型及范围 | 说明                                |
| ------- | ---------- | ----------------------------------- |
| state   | bool       | 操作结果状态值，true成功，false失败 |
| message | string     | 操作返回消息，成功时空值            |
| code    | int        | 操作返回号码，成功时返回0           |
| data    | array      | 数据                                |