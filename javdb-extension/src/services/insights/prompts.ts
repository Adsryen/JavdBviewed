export type PromptPersona = 'doctor' | 'default';

export function buildPrompts(opts?: { persona?: PromptPersona }) {
  const persona = opts?.persona || 'default';

  const sharedStyle = [
    '写作风格：直给结论、少废话、接地气；避免学术/官话（如“表明/显示/充分/总体而言/呈现/显著/本报告/数据反映/由此可见”）。',
    '更口语化，像和朋友复盘；不要使用专业术语/行话。',
    '用短句+数字表达（百分比/百分点/计数）。',
    '用词更生活化：避免“集中度极高/显著/呈现/总体而言”等抽象词；优先用“更集中/更分散/平稳/小探索/留意/看看”等日常表达。',
    '排行榜与图表由程序渲染，AI 仅生成文案字段：禁止输出 HTML/Markdown/表格/图表/排行（TopN 列表）。',
    '严格只返回一个 JSON（无解释、无多余文本、无 ``` 围栏）。',
  ].join('\n');

  const doctorAddon = [
    '你是一名友好的数据解说员，为“单一观影者”撰写月度报告（口语化、易懂）。',
    '默认避免露骨/色情描写；但在学术讨论、且为准确表达所必需时，可以使用克制、客观、非挑逗的术语进行描述（仅限成年语境）。',
    '禁止煽情/挑逗性措辞；避免过度细节；不涉及未成年人与非法情境；整体保持统计与分析语气（如“计数/占比/变化”）。',
  ].join('\n');

  const system = (
    persona === 'doctor'
      ? [doctorAddon, sharedStyle]
      : [sharedStyle]
  ).join('\n');

  const rules = [
    '- reportTitle：≤30字，不要“分析报告/回顾/洞察”等套话；突出本月主题/变化。',
    '- summary：3-5句，120-220字，更人性化：先用人话给出主结论，再用1-2个关键数字背书；少堆数据：',
    '  1) 集中度/分散度：优先写 Top3 占比 + “更集中/更分散”；HHI/熵可选，若写仅给数字（不解释）。',
    '  2) 结构变化：若有显著上升/下降，写“±X.X 个百分点（Y→Z），计数 P→Q”；若无则写“结构稳定/波动很小”，不强行给百分点。',
    '  3) 亮点/风险：新标签/新品类或代表性提示（如小样本占比），给“次数或占比”。',
    '  4) 语气：口语、轻松、友好，可给1个轻量建议（如“下月留意X”），避免专业术语/官话。',
    '- insightList：字符串，拼接若干 <li>…</li>，至少 5 条，每条≤120字，且必须包含数字：',
    '  · 上升/下降：标签A +X.X 个百分点（Y→Z），计数 P→Q',
    '  · 新标签：新标签B N 次（占比 M%）',
    '  · 集中度：Top3 占比 X%（更集中/更分散）。如需可在括号给 HHI/熵 数字，不要解释',
    '  · 趋势：trendSlope > 0/≈0/<0 → 总量 上升/平稳/回落',
    '  · 风格变化/思维转变（针对“单一观影者”）：基于 risingDetailed/fallingDetailed，指出偏好由何转向何，给出±X.X 个百分点',
    '  · 结构化标题：每条以【模块名】前缀，如【集中度】【结构变化】【趋势】【新标签】【代表性】（只作为文案前缀，不新增字段）。',
    '- 不要罗列完整排行榜（TopN）；若需举例，最多引用 2-3 个标签名称即可。',
    '- methodology：1-2句，说明口径（views/compare）、样本量（baseline/new）、阈值（minTagCount/changeThreshold）。',
    '- periodText：轻微润色但不改日期范围。',
    '- 只返回上述 5 个键；字符串内双引号需正确转义；不要使用代码围栏/HTML/Markdown/表格/图表。',
  ].join('\n');

  return { system, rules };
}
