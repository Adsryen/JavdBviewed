<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Jav 助手管理面板</title>
  <link rel="stylesheet" href="./dashboard.css">
  <link rel="stylesheet" href="./actors.css">
  <link rel="stylesheet" href="./sync.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="dashboard-container">
        <div class="sidebar">
            <h1 class="panel-title">
                <div class="title-content">
                    <img id="title-icon" alt="Jav 助手" class="title-icon" style="display: none;">
                    <span class="title-text">Jav 助手</span>
                </div>
                <span id="helpBtn" title="功能说明">❓</span>
            </h1>

            <div class="sidebar-section">
                <h4>账号信息</h4>
                <div id="user-profile-section">
                    <!-- 账号信息将由 JS 动态填充 -->
                </div>
            </div>

            <div class="sidebar-section">
                <h4>本地备份</h4>
                <div class="button-group-vertical">
                    <label for="importFile" class="button-like">导入本地备份 (JSON)</label>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                    <button id="exportBtn">导出本地备份 (JSON)</button>
                </div>
            </div>

            <div class="sidebar-section">
                <h4>WebDAV 备份</h4>
                <div class="webdav-sync-container">
                    <div class="button-group-vertical">
                        <button id="syncNow">立即上传至云端</button>
                        <button id="syncDown">从云端恢复</button>
                    </div>
                    <div class="sync-status">
                        <div class="sync-time-info">
                            <i class="fas fa-clock"></i>
                            <span class="sync-label">上次同步:</span>
                            <span id="lastSyncTime" class="sync-time">从未</span>
                        </div>
                        <div class="sync-indicator" id="syncIndicator">
                            <span class="sync-dot"></span>
                            <span class="sync-status-text">未同步</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- 侧边栏分界线和切换按钮 -->
        <div class="sidebar-divider">
            <button id="sidebarToggleBtn" class="sidebar-toggle-btn" title="收缩/展开侧边栏">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab-link active" data-tab="tab-records">番号库</button>
                <button class="tab-link" data-tab="tab-actors">演员库</button>
                <button class="tab-link" data-tab="tab-sync">数据同步</button>
                <button class="tab-link" data-tab="tab-settings">设置</button>
                <button class="tab-link" data-tab="tab-logs">日志</button>
            </div>
    
            <div id="tab-records" class="tab-content active">
                <div class="card">
                    <!-- 番号库统计信息 -->
                    <div class="stats-section">
                        <h4>番号库概览</h4>
                        <div id="recordsStatsContainer" class="stats-grid">
                            <!-- 统计信息将由 JS 动态填充 -->
                        </div>
                    </div>

                    <div class="search-and-filter">
                        <input type="text" id="searchInput" placeholder="搜索番号或标题...">
                        <select id="filterSelect">
                            <option value="all">所有状态</option>
                            <option value="viewed">已观看</option>
                            <option value="browsed">已浏览</option>
                            <option value="want">我想看</option>
                        </select>
                        <select id="sortSelect">
                            <option value="updatedAt_desc">按更新时间排序 (最新)</option>
                            <option value="updatedAt_asc">按更新时间排序 (最旧)</option>
                            <option value="createdAt_desc">按创建时间排序 (最新)</option>
                            <option value="createdAt_asc">按创建时间排序 (最旧)</option>
                            <option value="id_asc">按番号排序 (A-Z)</option>
                            <option value="id_desc">按番号排序 (Z-A)</option>
                        </select>
                        <div class="tags-filter-container">
                            <input type="text" id="tagsFilterInput" placeholder="搜索标签..." readonly>
                            <div id="tagsFilterDropdown" class="tags-dropdown" style="display: none;">
                                <div class="tags-search-box">
                                    <input type="text" id="tagsSearchInput" placeholder="输入标签名称...">
                                </div>
                                <div id="tagsFilterList" class="tags-list">
                                    <!-- 标签列表将由 JS 动态填充 -->
                                </div>
                            </div>
                            <div id="selectedTagsContainer" class="selected-tags">
                                <!-- 已选择的标签将由 JS 动态填充 -->
                            </div>
                        </div>
                    </div>

                    <!-- 批量操作控件 -->
                    <div class="batch-operations" id="batchOperations" style="display: none;">
                        <div class="batch-selection">
                            <label class="batch-select-all">
                                <input type="checkbox" id="selectAllCheckbox">
                                <span>全选</span>
                            </label>
                            <span class="selected-count" id="selectedCount">已选择 0 项</span>
                        </div>
                        <div class="batch-actions">
                            <button class="batch-btn refresh-btn" id="batchRefreshBtn" disabled>
                                <i class="fas fa-sync-alt"></i>
                                批量刷新
                            </button>
                            <button class="batch-btn delete-btn" id="batchDeleteBtn" disabled>
                                <i class="fas fa-trash"></i>
                                批量删除
                            </button>
                            <button class="batch-btn cancel-btn" id="cancelBatchBtn">
                                <i class="fas fa-times"></i>
                                取消选择
                            </button>
                        </div>
                    </div>


                    <div class="video-list-container">
                        <ul id="videoList">
                            <!-- 视频列表将由 JS 动态填充 -->
                        </ul>
                    </div>
                    <div class="pagination-controls">
                        <div class="pagination">
                            <!-- 分页控件将由 JS 动态填充 -->
                        </div>
                         <div class="records-per-page-selector">
                            <label for="recordsPerPageSelect">每页显示:</label>
                            <select id="recordsPerPageSelect">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-actors" class="tab-content">
                <div class="card">
                    <!-- 演员库统计信息 -->
                    <div class="stats-section">
                        <h4>演员库概览</h4>
                        <div id="actorStatsContainer" class="stats-grid">
                            <!-- 统计信息将由 JS 动态填充 -->
                        </div>
                    </div>



                    <!-- 搜索和过滤 -->
                    <div class="search-and-filter">
                        <input type="text" id="actorSearchInput" placeholder="搜索演员姓名或别名...">
                        <select id="actorGenderFilter">
                            <option value="">所有性别</option>
                            <option value="female">女性</option>
                            <option value="male">男性</option>
                            <option value="unknown">未知</option>
                        </select>
                        <select id="actorCategoryFilter">
                            <option value="">所有分类</option>
                            <option value="censored">有码</option>
                            <option value="uncensored">无码</option>
                            <option value="western">欧美</option>
                            <option value="unknown">未知</option>
                        </select>
                        <select id="actorSortSelect">
                            <option value="name_asc">按姓名排序 (A-Z)</option>
                            <option value="name_desc">按姓名排序 (Z-A)</option>
                            <option value="updatedAt_desc">按更新时间排序 (最新)</option>
                            <option value="updatedAt_asc">按更新时间排序 (最旧)</option>
                            <option value="worksCount_desc">按作品数量排序 (多到少)</option>
                            <option value="worksCount_asc">按作品数量排序 (少到多)</option>
                        </select>
                        <select id="actorPageSizeSelect">
                            <option value="20">每页 20 个</option>
                            <option value="40">每页 40 个</option>
                            <option value="60">每页 60 个</option>
                            <option value="100">每页 100 个</option>
                        </select>
                    </div>

                    <!-- 演员列表容器 -->
                    <div class="actor-list-wrapper">
                        <div id="actorListLoading" class="loading-indicator" style="display: none;">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>加载中...</span>
                        </div>
                        <div id="actorListContainer" class="actor-list-container">
                            <!-- 演员列表将由 JS 动态填充 -->
                        </div>
                    </div>

                    <!-- 分页控件 -->
                    <div class="pagination-controls">
                        <div id="actorPaginationContainer" class="pagination">
                            <!-- 分页控件将由 JS 动态填充 -->
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-sync" class="tab-content">
                <div class="card">
                    <!-- 登录状态提示 -->
                    <div id="sync-login-notice" class="sync-login-notice" style="display: none;">
                        <div class="notice-content">
                            <i class="fas fa-info-circle notice-icon"></i>
                            <div class="notice-text">
                                <h5>需要登录才能使用数据同步功能</h5>
                                <p>请在左侧账号信息区域登录您的 JavDB 账号</p>
                            </div>
                        </div>
                    </div>

                    <!-- 数据同步区域 -->
                    <div id="data-sync-section-main" class="data-sync-section">
                        <h4>数据同步</h4>
                        <p class="section-description">将您在 JavDB 的观看记录、想看列表同步到本地，方便离线管理和搜索。</p>

                        <!-- 同步选项 -->
                        <div class="sync-options-grid">
                            <div class="sync-option-card" style="--card-index: 0">
                                <div class="sync-option-header">
                                    <i class="fas fa-sync-alt sync-option-icon"></i>
                                    <h5>同步全部数据</h5>
                                </div>
                                <p class="sync-option-description">同步所有观看记录和想看列表到本地</p>
                                <div class="sync-option-actions">
                                    <button id="syncAllData" class="sync-btn sync-btn-primary" data-sync-type="all">
                                        <i class="fas fa-sync-alt"></i>
                                        <span>开始同步</span>
                                    </button>
                                </div>
                                <div class="sync-option-stats">
                                    <span class="stat-item">已观看 + 想看</span>
                                </div>
                            </div>

                            <div class="sync-option-card" style="--card-index: 1">
                                <div class="sync-option-header">
                                    <i class="fas fa-heart sync-option-icon"></i>
                                    <h5>同步想看列表</h5>
                                </div>
                                <p class="sync-option-description">仅同步想看列表中的视频</p>
                                <div class="sync-option-actions">
                                    <button id="syncWantData" class="sync-btn sync-btn-secondary" data-sync-type="want">
                                        <i class="fas fa-heart"></i>
                                        <span>同步想看</span>
                                    </button>
                                </div>
                                <div class="sync-option-stats">
                                    <span class="stat-item">想看列表</span>
                                </div>
                            </div>

                            <div class="sync-option-card" style="--card-index: 2">
                                <div class="sync-option-header">
                                    <i class="fas fa-eye sync-option-icon"></i>
                                    <h5>同步观看记录</h5>
                                </div>
                                <p class="sync-option-description">仅同步已观看的视频记录</p>
                                <div class="sync-option-actions">
                                    <button id="syncWatchedData" class="sync-btn sync-btn-secondary" data-sync-type="watched">
                                        <i class="fas fa-eye"></i>
                                        <span>同步已看</span>
                                    </button>
                                </div>
                                <div class="sync-option-stats">
                                    <span class="stat-item">观看记录</span>
                                </div>
                            </div>

                            <div class="sync-option-card" style="--card-index: 3">
                                <div class="sync-option-header">
                                    <i class="fas fa-users sync-option-icon"></i>
                                    <h5>同步收藏演员</h5>
                                </div>
                                <p class="sync-option-description">同步您收藏的演员信息到本地演员库</p>
                                <div class="sync-option-actions">
                                    <button id="syncActorsData" class="sync-btn sync-btn-secondary" data-sync-type="actors">
                                        <i class="fas fa-users"></i>
                                        <span>同步演员基本信息</span>
                                        <small class="sync-btn-note">快速同步，不包含性别</small>
                                    </button>
                                    <button id="syncActorsGender" class="sync-btn sync-btn-tertiary" data-sync-type="actors-gender">
                                        <i class="fas fa-venus-mars"></i>
                                        <span>更新演员性别</span>
                                        <small class="sync-btn-note">需要额外时间</small>
                                    </button>
                                </div>
                                <div class="sync-option-stats">
                                    <span class="stat-item">收藏演员</span>
                                    <span class="stat-item" id="actorGenderStats">性别待更新</span>
                                </div>
                            </div>
                        </div>

                        <!-- 同步进度 -->
                        <div id="syncProgress" class="sync-progress-container" style="display: none;">
                            <div class="progress-section">
                                <h5>同步进度</h5>

                                <!-- 页面获取进度 -->
                                <div class="progress-stage" id="pagesProgress" style="display: none;">
                                    <div class="progress-header">
                                        <div class="progress-label">获取列表页面</div>
                                        <div class="progress-percentage" id="pagesProgressPercentage">0%</div>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="pagesProgressFill"></div>
                                    </div>
                                    <span class="progress-text" id="pagesProgressText">准备获取...</span>
                                </div>

                                <!-- 详情获取进度 -->
                                <div class="progress-stage" id="detailsProgress" style="display: none;">
                                    <div class="progress-header">
                                        <div class="progress-label">获取视频详情</div>
                                        <div class="progress-percentage" id="detailsProgressPercentage">0%</div>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="detailsProgressFill"></div>
                                    </div>
                                    <span class="progress-text" id="detailsProgressText">等待开始...</span>
                                </div>

                                <!-- 取消按钮 -->
                                <div class="progress-controls">
                                    <button class="cancel-sync-btn" id="cancelSyncBtn" title="取消同步">
                                        <i class="fas fa-times"></i> 取消同步
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 同步结果 -->
                        <div id="syncResult" class="sync-result" style="display: none;">
                            <i class="fas fa-check-circle"></i>
                            <span id="syncResultText">同步完成</span>
                        </div>
                    </div>


                </div>
            </div>

            <div id="tab-settings" class="tab-content">
                <div class="settings-container">
                    <!-- 移动端菜单切换按钮 -->
                    <button class="settings-menu-toggle" id="settingsMenuToggle">
                        <i class="fas fa-bars"></i>
                        <span>设置菜单</span>
                    </button>

                    <!-- 设置侧边栏 -->
                    <div class="settings-sidebar" id="settingsSidebar">
                        <div class="settings-nav">
                            <div class="settings-nav-item active" data-section="display-settings">
                                <i class="fas fa-eye"></i>
                                <span>显示设置</span>
                            </div>
                            <div class="settings-nav-item" data-section="search-engine-settings">
                                <i class="fas fa-search"></i>
                                <span>搜索引擎</span>
                            </div>
                            <div class="settings-nav-item" data-section="webdav-settings">
                                <i class="fas fa-cloud"></i>
                                <span>WebDAV同步</span>
                            </div>
                            <div class="settings-nav-item" data-section="sync-settings">
                                <i class="fas fa-sync-alt"></i>
                                <span>同步设置</span>
                            </div>
                            <div class="settings-nav-item" data-section="drive115-settings">
                                <i class="fas fa-cloud-download-alt"></i>
                                <span>115网盘</span>
                            </div>
                            <div class="settings-nav-item" data-section="enhancement-settings">
                                <i class="fas fa-magic"></i>
                                <span>功能增强</span>
                            </div>
                            <div class="settings-nav-item" data-section="network-test-settings">
                                <i class="fas fa-network-wired"></i>
                                <span>网络测试</span>
                            </div>
                            <div class="settings-nav-item" data-section="privacy-settings">
                                <i class="fas fa-shield-alt"></i>
                                <span>隐私保护</span>
                            </div>
                            <div class="settings-nav-item" data-section="advanced-settings">
                                <i class="fas fa-cogs"></i>
                                <span>高级配置</span>
                            </div>
                            <div class="settings-nav-item" data-section="log-settings">
                                <i class="fas fa-file-alt"></i>
                                <span>日志设置</span>
                            </div>
                            <div class="settings-nav-item" data-section="global-actions">
                                <i class="fas fa-tools"></i>
                                <span>全局操作</span>
                            </div>
                        </div>
                    </div>

                    <!-- 设置内容区域 -->
                    <div class="settings-content">
                        <!-- 显示设置 -->
                        <div class="settings-panel active" id="display-settings">
                            <div class="settings-panel-header">
                                <h3>列表显示设置</h3>
                                <p class="settings-description">控制在JavDB网站上访问时，是否自动隐藏符合条件的影片。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="hideViewed">
                                    <label for="hideViewed">隐藏已标记"看过"的影片</label>
                                </div>
                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="hideBrowsed">
                                    <label for="hideBrowsed">隐藏已浏览详情页的影片</label>
                                </div>
                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="hideVR">
                                    <label for="hideVR">隐藏所有VR影片</label>
                                </div>
                            </div>
                        </div>

                        <!-- 搜索引擎设置 -->
                        <div class="settings-panel" id="search-engine-settings">
                            <div class="settings-panel-header">
                                <h3>搜索引擎设置</h3>
                                <p class="settings-description">自定义点击番号后跳转的搜索网站。使用 <code>{{ID}}</code> 作为番号占位符。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="search-engine-header">
                                    <div class="engine-icon">图标</div>
                                    <div class="engine-name">搜索引擎名称</div>
                                    <div class="engine-url">URL模板</div>
                                    <div class="engine-icon-url">图标地址</div>
                                    <div class="engine-actions">操作</div>
                                </div>
                                <div id="search-engine-list">
                                    <!-- 搜索引擎列表将由 JS 动态填充 -->
                                </div>
                                <button id="add-search-engine" class="button-like">
                                    <i class="fas fa-plus"></i> 添加新的搜索引擎
                                </button>
                            </div>
                        </div>

                        <!-- WebDAV设置 -->
                        <div class="settings-panel" id="webdav-settings">
                            <div class="settings-panel-header">
                                <h3>WebDAV 设置</h3>
                                <p class="settings-description">通过WebDAV协议，将您的观看记录备份到兼容的云存储服务（如：坚果云、Nextcloud等）。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="webdav-controls-container">
                                    <div class="webdav-controls-row">
                                        <div class="form-group-checkbox webdav-enable-control">
                                            <input type="checkbox" id="webdavEnabled">
                                            <label for="webdavEnabled">
                                                <i class="fas fa-cloud-upload-alt"></i>
                                                启用 WebDAV 同步
                                            </label>
                                        </div>
                                    </div>

                                    <div class="webdav-controls-row webdav-sub-controls" id="webdavSubControls">
                                        <div class="form-group-checkbox webdav-auto-control">
                                            <input type="checkbox" id="webdavAutoSync">
                                            <label for="webdavAutoSync">
                                                <i class="fas fa-sync-alt"></i>
                                                自动上传
                                            </label>
                                        </div>

                                        <div class="form-group-inline webdav-interval-control">
                                            <label for="webdav-sync-interval">
                                                <i class="fas fa-clock"></i>
                                                同步间隔:
                                            </label>
                                            <input type="number" id="webdav-sync-interval" class="number-input" min="1" max="1440" value="30">
                                            <span class="input-suffix">分钟</span>
                                        </div>
                                    </div>
                                </div>

                                <div id="webdav-fields-container">
                                    <div class="form-group">
                                        <label for="webdavUrl">WebDAV 地址:</label>
                                        <input type="text" id="webdavUrl" placeholder="例如: https://dav.jianguoyun.com/dav/">
                                    </div>
                                    <div class="form-group">
                                        <label for="webdavUser">用户名:</label>
                                        <input type="text" id="webdavUser">
                                    </div>
                                    <div class="form-group">
                                        <label for="webdavPass">密码/应用密钥:</label>
                                        <input type="password" id="webdavPass">
                                    </div>

                                    <div class="button-group">
                                        <button type="button" id="saveWebdavSettings">保存设置</button>
                                        <button type="button" id="testWebdavConnection">测试连接</button>
                                        <button type="button" id="diagnoseWebdavConnection">诊断连接</button>
                                    </div>
                                    <div class="form-group">
                                        <p>上次同步: <span id="last-sync-time">从未</span></p>
                                    </div>
                                </div>

                                <div id="fileListContainer" class="settings-section hidden">
                                    <h4>云端文件列表 (点击恢复)</h4>
                                    <ul id="fileList"></ul>
                                </div>
                            </div>
                        </div>

                        <!-- 同步设置 -->
                        <div class="settings-panel" id="sync-settings">
                            <div class="settings-panel-header">
                                <h3>同步设置</h3>
                                <p class="settings-description">配置从JavDB同步观看记录、想看列表和演员数据的URL地址和行为参数。</p>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 视频数据同步配置 -->
                                <div class="form-section">
                                    <h4>视频数据同步配置</h4>
                                    <p class="section-description">配置观看记录和想看列表的同步URL地址，页码参数将由程序自动添加。</p>

                                    <div class="form-group">
                                        <label for="dataSyncWantWatchUrl">想看列表URL:</label>
                                        <input type="url" id="dataSyncWantWatchUrl" class="text-input" placeholder="https://javdb.com/users/want_watch_videos">
                                        <p class="input-description">想看视频列表的URL地址，程序会自动添加页码参数。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="dataSyncWatchedVideosUrl">已看列表URL:</label>
                                        <input type="url" id="dataSyncWatchedVideosUrl" class="text-input" placeholder="https://javdb.com/users/watched_videos">
                                        <p class="input-description">已观看视频列表的URL地址，程序会自动添加页码参数。</p>
                                    </div>

                                </div>

                                <!-- 演员数据同步配置 -->
                                <div class="form-section">
                                    <h4>演员数据同步配置</h4>
                                    <p class="section-description">配置演员数据同步的行为和URL地址。</p>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="actorSyncEnabled">
                                            <span class="checkmark"></span>
                                            启用演员同步功能
                                        </label>
                                        <p class="input-description">开启后可以从JavDB同步收藏演员数据到本地。</p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="actorAutoSync">
                                            <span class="checkmark"></span>
                                            自动同步演员数据
                                        </label>
                                        <p class="input-description">定期自动同步演员数据，避免手动操作。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncInterval">演员同步间隔 (分钟):</label>
                                        <input type="number" id="actorSyncInterval" class="number-input" min="60" max="10080" value="1440">
                                        <p class="input-description">自动同步演员数据的时间间隔，建议设置为24小时(1440分钟)或更长。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncCollectionUrl">收藏演员URL:</label>
                                        <input type="url" id="actorSyncCollectionUrl" class="text-input" placeholder="https://javdb.com/users/collection_actors">
                                        <p class="input-description">收藏演员列表的URL地址，程序会自动添加页码参数。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncDetailUrl">演员详情URL模板:</label>
                                        <input type="text" id="actorSyncDetailUrl" class="text-input" placeholder="https://javdb.com/actors/{{ACTOR_ID}}">
                                        <p class="input-description">演员详情页的URL模板，{{ACTOR_ID}}将被替换为实际的演员ID。</p>
                                    </div>
                                </div>

                                <!-- 通用同步行为配置 -->
                                <div class="form-section">
                                    <h4>通用同步行为配置</h4>
                                    <p class="section-description">配置所有数据同步时的请求间隔和批量处理设置。</p>

                                    <div class="form-group">
                                        <label for="dataSyncRequestInterval">请求间隔 (秒):</label>
                                        <input type="number" id="dataSyncRequestInterval" class="number-input" min="1" max="60" value="3">
                                        <p class="input-description">每次请求之间的间隔时间，建议至少3秒以缓解服务器压力。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="dataSyncBatchSize">批量处理大小:</label>
                                        <input type="number" id="dataSyncBatchSize" class="number-input" min="10" max="100" value="20">
                                        <p class="input-description">每批处理的视频数量，建议设置为20-50之间。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="dataSyncMaxRetries">最大重试次数:</label>
                                        <input type="number" id="dataSyncMaxRetries" class="number-input" min="1" max="10" value="3">
                                        <p class="input-description">网络请求失败时的最大重试次数。</p>
                                    </div>
                                    <div class="form-group">
                                        <label for="actorSyncRequestInterval">演员同步请求间隔 (秒):</label>
                                        <input type="number" id="actorSyncRequestInterval" class="number-input" min="3" max="60" value="3">
                                        <p class="input-description">演员详情页请求间隔，建议至少3秒以缓解服务器压力。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncBatchSize">演员批量处理大小:</label>
                                        <input type="number" id="actorSyncBatchSize" class="number-input" min="10" max="50" value="20">
                                        <p class="input-description">每批处理的演员数量，通常一页包含20个演员。</p>
                                    </div>

                                    <div class="form-group">
                                        <label for="actorSyncMaxRetries">演员同步最大重试次数:</label>
                                        <input type="number" id="actorSyncMaxRetries" class="number-input" min="1" max="10" value="3">
                                        <p class="input-description">演员数据获取失败时的最大重试次数。</p>
                                    </div>
                                </div>

                                <!-- 测试功能 -->
                                <div class="form-section">
                                    <h4>测试功能</h4>
                                    <p class="section-description">测试同步配置是否正确。</p>

                                    <div class="button-group">
                                        <button type="button" id="testActorSyncConnection" class="button-like" style="background-color: #17a2b8;">
                                            <i class="fas fa-network-wired"></i>
                                            测试演员同步连接
                                        </button>
                                        <button type="button" id="testActorSyncParsing" class="button-like" style="background-color: #28a745;">
                                            <i class="fas fa-code"></i>
                                            测试演员数据解析
                                        </button>
                                    </div>

                                    <div id="actorSyncTestResults" class="test-results" style="margin-top: 15px;"></div>
                                </div>

                                <!-- 保存按钮 -->
                                <div class="form-section">
                                    <div class="button-group">
                                        <button type="button" id="saveSyncSettings" class="button-like">
                                            <i class="fas fa-save"></i>
                                            保存同步设置
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>




                        <!-- 隐私保护 -->
                        <div class="settings-panel" id="privacy-settings">
                            <div class="settings-panel-header">
                                <h3><i class="fas fa-shield-alt"></i> 隐私保护设置</h3>
                                <p class="settings-description">配置截图模式和私密模式，保护您的隐私数据不被意外泄露。</p>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 截图模式设置 -->
                                <div class="settings-section privacy-card">
                                    <div class="privacy-section-header">
                                        <h4><i class="fas fa-camera"></i> 截图模式</h4>
                                        <div class="privacy-toggle-wrapper">
                                            <input type="checkbox" id="screenshotModeEnabled" class="privacy-toggle">
                                            <label for="screenshotModeEnabled" class="privacy-toggle-label">
                                                <span class="privacy-toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <p class="settings-description">对敏感内容应用模糊效果，防止截图时泄露隐私。</p>

                                    <div class="privacy-settings-grid">
                                        <div class="form-group">
                                            <label for="blurIntensity" class="privacy-label">
                                                <i class="fas fa-adjust"></i> 模糊强度:
                                                <span id="blurIntensityValue" class="privacy-value">5</span>
                                            </label>
                                            <input type="range" id="blurIntensity" min="1" max="10" value="5" class="privacy-slider">
                                        </div>

                                        <div class="form-group">
                                            <label for="autoBlurTrigger" class="privacy-label">
                                                <i class="fas fa-magic"></i> 自动模糊触发条件
                                            </label>
                                            <select id="autoBlurTrigger" class="privacy-select">
                                                <option value="manual">手动控制</option>
                                                <option value="tab-leave">离开标签页时</option>
                                                <option value="extension-reopen">重新打开拓展时</option>
                                                <option value="idle-timeout">空闲超时时</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label for="temporaryViewDuration" class="privacy-label">
                                                <i class="fas fa-clock"></i> 临时查看持续时间（秒）
                                            </label>
                                            <input type="number" id="temporaryViewDuration" min="5" max="60" value="10" class="privacy-input">
                                        </div>
                                    </div>

                                    <div class="privacy-options">
                                        <div class="form-group-checkbox privacy-checkbox">
                                            <input type="checkbox" id="showEyeIcon" checked>
                                            <label for="showEyeIcon">
                                                <i class="fas fa-eye"></i> 显示眼睛图标（点击临时查看）
                                            </label>
                                        </div>
                                    </div>

                                    <div class="privacy-actions">
                                        <button id="testBlurBtn" class="privacy-btn privacy-btn-test">
                                            <i class="fas fa-vial"></i> 测试模糊效果
                                        </button>
                                    </div>
                                </div>

                                <!-- 私密模式设置 -->
                                <div class="settings-section privacy-card">
                                    <div class="privacy-section-header">
                                        <h4><i class="fas fa-lock"></i> 私密模式</h4>
                                        <div class="privacy-toggle-wrapper">
                                            <input type="checkbox" id="privateModeEnabled" class="privacy-toggle">
                                            <label for="privateModeEnabled" class="privacy-toggle-label">
                                                <span class="privacy-toggle-slider"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <p class="settings-description">在截图模式基础上增加密码验证，适用于公共电脑环境。</p>

                                    <div class="privacy-settings-grid">
                                        <div class="form-group">
                                            <label class="privacy-label">
                                                <i class="fas fa-key"></i> 密码状态
                                            </label>
                                            <div class="privacy-status-row">
                                                <span id="passwordStatus" class="privacy-status privacy-status-warning">未设置</span>
                                                <div class="privacy-btn-group">
                                                    <button id="setPasswordBtn" class="privacy-btn privacy-btn-primary">
                                                        <i class="fas fa-plus"></i> 设置密码
                                                    </button>
                                                    <button id="changePasswordBtn" class="privacy-btn privacy-btn-secondary" style="display: none;">
                                                        <i class="fas fa-edit"></i> 更改密码
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="privacy-hint">
                                                <i class="fas fa-info-circle"></i>
                                                密码要求：至少6位，支持纯数字或字母数字组合
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label for="sessionTimeout" class="privacy-label">
                                                <i class="fas fa-hourglass-half"></i> 会话超时时间（分钟）
                                            </label>
                                            <input type="number" id="sessionTimeout" min="5" max="120" value="30" class="privacy-input">
                                        </div>
                                    </div>

                                    <div class="privacy-options">
                                        <div class="form-group-checkbox privacy-checkbox">
                                            <input type="checkbox" id="requirePassword">
                                            <label for="requirePassword">
                                                <i class="fas fa-shield-alt"></i> 需要密码验证
                                            </label>
                                        </div>

                                        <div class="form-group-checkbox privacy-checkbox">
                                            <input type="checkbox" id="lockOnTabLeave">
                                            <label for="lockOnTabLeave">
                                                <i class="fas fa-sign-out-alt"></i> 离开标签页时自动锁定
                                            </label>
                                        </div>

                                        <div class="form-group-checkbox privacy-checkbox">
                                            <input type="checkbox" id="lockOnExtensionClose">
                                            <label for="lockOnExtensionClose">
                                                <i class="fas fa-times-circle"></i> 关闭拓展时自动锁定
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- 密码恢复设置 -->
                                <div class="settings-section privacy-card">
                                    <div class="privacy-section-header">
                                        <h4><i class="fas fa-life-ring"></i> 密码恢复</h4>
                                    </div>
                                    <p class="settings-description">设置密码恢复选项，以防忘记密码。</p>

                                    <div class="privacy-settings-grid">
                                        <div class="form-group">
                                            <label class="privacy-label">
                                                <i class="fas fa-question-circle"></i> 安全问题
                                            </label>
                                            <div class="privacy-status-row">
                                                <span id="securityQuestionsStatus" class="privacy-status privacy-status-warning">未设置</span>
                                                <button id="setupSecurityQuestionsBtn" class="privacy-btn privacy-btn-secondary">
                                                    <i class="fas fa-cog"></i> 设置安全问题
                                                </button>
                                            </div>
                                        </div>

                                        <div class="form-group">
                                            <label class="privacy-label">
                                                <i class="fas fa-code"></i> 备份恢复码
                                            </label>
                                            <div class="privacy-status-row">
                                                <span id="backupCodeStatus" class="privacy-status privacy-status-warning">未生成</span>
                                                <button id="generateBackupCodeBtn" class="privacy-btn privacy-btn-secondary">
                                                    <i class="fas fa-key"></i> 生成备份码
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="privacy-alert privacy-alert-warning">
                                        <div class="privacy-alert-icon">
                                            <i class="fas fa-exclamation-triangle"></i>
                                        </div>
                                        <div class="privacy-alert-content">
                                            <strong>重要提醒：</strong>
                                            <ul>
                                                <li>请妥善保存备份恢复码，它只会显示一次</li>
                                                <li>如果忘记密码且没有恢复选项，只能重置所有数据</li>
                                                <li>建议至少设置一种恢复方式</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 网络测试 -->
                        <div class="settings-panel" id="network-test-settings">
                            <div class="settings-panel-header">
                                <h3>网络延迟测试 (Ping)</h3>
                                <p class="settings-description">此处显示插件运行期间的关键事件，便于问题排查。日志会自动保存。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="form-group-inline">
                                    <div class="input-with-icon">
                                        <i class="fas fa-link icon"></i>
                                        <input type="text" id="ping-url" placeholder="例如: https://javdb.com" value="https://javdb.com">
                                    </div>
                                    <button id="start-ping-test" class="button-like">
                                        <span class="button-text">开始测试</span>
                                        <div class="spinner hidden"></div>
                                    </button>
                                </div>
                                <div id="ping-results-container" style="margin-top: 20px;">
                                    <h4>测试结果:</h4>
                                    <div id="ping-results"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 115网盘设置 -->
                        <div class="settings-panel" id="drive115-settings">
                            <div class="settings-panel-header">
                                <h3>115网盘离线下载</h3>
                                <p class="settings-description">配置115网盘离线下载功能，支持磁链自动下载和验证。</p>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 基础设置 -->
                                <div class="settings-section">
                                    <h4>基础设置</h4>
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="drive115Enabled">
                                            <span class="checkmark"></span>
                                            启用115网盘功能
                                        </label>
                                        <p class="input-description">开启后可以使用115网盘离线下载功能。需要先登录115网盘。</p>
                                    </div>
                                </div>

                                <div class="drive115-settings-container disabled">
                                    <!-- 下载设置 -->
                                    <div class="settings-section">
                                        <h4>下载设置</h4>
                                        <div class="form-group">
                                            <label for="drive115DownloadDir">下载目录:</label>
                                            <input type="text" id="drive115DownloadDir" placeholder="例如: ${云下载} 或 具体目录ID">
                                            <p class="input-description">支持动态参数: ${#star}(演员), ${#series}(系列), ${#studio}(制作商)</p>
                                        </div>

                                        <div class="form-group">
                                            <label for="drive115VerifyCount">验证次数:</label>
                                            <input type="number" id="drive115VerifyCount" class="number-input" min="1" max="20" value="5">
                                            <p class="input-description">下载后验证文件的重试次数，建议3-5次。</p>
                                        </div>

                                        <div class="form-group">
                                            <label for="drive115MaxFailures">最大失败数:</label>
                                            <input type="number" id="drive115MaxFailures" class="number-input" min="0" max="50" value="5">
                                            <p class="input-description">批量下载时允许的最大失败次数，0表示不限制。</p>
                                        </div>

                                        <div class="form-group">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="drive115AutoNotify" checked>
                                                <span class="checkmark"></span>
                                                自动通知
                                            </label>
                                            <p class="input-description">下载完成后自动显示通知。</p>
                                        </div>
                                    </div>

                                    <!-- 测试功能 -->
                                    <div class="settings-section">
                                        <h4>测试功能</h4>
                                        <div class="form-group">
                                            <label for="testSearchInput">测试搜索:</label>
                                            <div class="form-group-inline">
                                                <input type="text" id="testSearchInput" placeholder="输入番号或关键词">
                                                <button id="testDrive115Search" class="button-like">测试搜索</button>
                                            </div>
                                            <p class="input-description">测试115网盘搜索功能是否正常工作。</p>
                                        </div>
                                        <div id="testResults" class="test-results"></div>
                                    </div>

                                    <!-- 日志查看 -->
                                    <div class="settings-section">
                                        <h4>115网盘日志</h4>
                                        <div class="action-buttons-top">
                                            <button id="refreshDrive115Logs" class="btn">刷新日志</button>
                                            <button id="clearDrive115Logs" class="btn danger">清空日志</button>
                                            <button id="exportDrive115Logs" class="btn">导出日志</button>
                                        </div>
                                        <div id="drive115LogStats" class="log-stats"></div>
                                        <div id="drive115LogsList" class="logs-list"></div>
                                    </div>
                                </div>

                                <!-- 保存按钮 -->
                                <div class="settings-section">
                                    <button id="saveDrive115Settings" class="btn btn-primary">保存115设置</button>
                                </div>
                            </div>
                        </div>

                        <!-- 功能增强设置 -->
                        <div class="settings-panel" id="enhancement-settings">
                            <div class="settings-panel-header">
                                <h3>🚀 功能增强设置</h3>
                                <p class="settings-description">解锁强大的增强功能，让您的JavDB体验更加丰富和高效！这些功能将显著提升浏览效率、数据完整性和操作便捷性。</p>

                                <!-- 快速入门提示 -->
                                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h4 style="margin: 0 0 10px 0; color: white;">🎯 快速入门推荐</h4>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 14px;">
                                        <div>
                                            <strong>🔰 新手推荐：</strong><br>
                                            1. 启用"多数据源聚合"<br>
                                            2. 启用"一键快捷复制"<br>
                                            3. 启用"智能内容过滤"
                                        </div>
                                        <div>
                                            <strong>🚀 高级用户：</strong><br>
                                            1. 全部功能都启用<br>
                                            2. 学习键盘快捷键<br>
                                            3. 自定义过滤规则
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-panel-body">
                                <!-- 数据增强 -->
                                <div class="settings-section">
                                    <h4>📊 数据增强 - 让信息更丰富</h4>
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableMultiSource">
                                            <span class="checkmark"></span>
                                            🌐 多数据源聚合
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>自动从BlogJav、JavLibrary等多个网站获取高清封面、详细评分、演员信息<br>
                                            <strong>使用：</strong>启用后，在视频详情页会自动显示增强信息，包括高质量封面图片和多站点评分对比
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableImageCache">
                                            <span class="checkmark"></span>
                                            🚀 智能图片缓存
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>缓存高质量封面和演员头像，第二次访问时瞬间加载<br>
                                            <strong>使用：</strong>自动工作，无需手动操作，显著提升页面加载速度
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableVideoPreview">
                                            <span class="checkmark"></span>
                                            🎬 视频预览增强
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在列表页鼠标悬停时显示视频预览片段（需要多数据源支持）<br>
                                            <strong>使用：</strong>鼠标悬停在视频封面上即可预览，无需点击进入详情页
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableTranslation">
                                            <span class="checkmark"></span>
                                            🈳 智能标题翻译
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>自动将日文标题翻译为中文，支持Google翻译等多种服务<br>
                                            <strong>使用：</strong>在视频详情页会在原标题下方显示中文翻译，帮助理解内容
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableRatingAggregation">
                                            <span class="checkmark"></span>
                                            ⭐ 多站点评分聚合
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>聚合JavLibrary、DMM等多个网站的评分数据，提供更全面的评价参考<br>
                                            <strong>使用：</strong>在视频详情页显示评分对比卡片，包含评分来源、分数和评价人数
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableActorInfo">
                                            <span class="checkmark"></span>
                                            👤 演员信息增强
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>获取演员详细信息、高清头像、个人资料和作品列表<br>
                                            <strong>使用：</strong>在视频详情页显示演员信息卡片，点击可查看演员详细资料
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label for="cacheExpiration">⏰ 缓存过期时间 (小时):</label>
                                        <input type="number" id="cacheExpiration" class="number-input" min="1" max="168" value="24">
                                        <p class="input-description">
                                            <strong>说明：</strong>增强数据的缓存保存时间，建议24小时。时间越长加载越快，但数据更新越慢
                                        </p>
                                    </div>
                                </div>

                                <!-- 用户体验 -->
                                <div class="settings-section">
                                    <h4>⚡ 用户体验 - 让操作更高效</h4>
                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableQuickCopy">
                                            <span class="checkmark"></span>
                                            📋 一键快捷复制
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>为番号、标题、链接、磁力等添加复制按钮，支持批量复制<br>
                                            <strong>使用：</strong>点击内容旁的📋按钮或按Ctrl+Shift+C打开复制面板，一键复制所需内容
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableContentFilter">
                                            <span class="checkmark"></span>
                                            🎯 智能内容过滤
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>自动隐藏已看过的视频、VR内容、FC2等，支持自定义过滤规则<br>
                                            <strong>使用：</strong>右侧会出现快速过滤面板，勾选即可隐藏对应内容，让列表更清爽
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableKeyboardShortcuts">
                                            <span class="checkmark"></span>
                                            ⌨️ 键盘快捷键大师
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>15+个快捷键让您告别鼠标，包括导航、复制、过滤等操作<br>
                                            <strong>使用：</strong>按?键查看帮助，如Alt+H回首页、Ctrl+Shift+V复制番号、/键聚焦搜索框
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="enableMagnetSearch">
                                            <span class="checkmark"></span>
                                            🧲 磁力资源搜索
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>在视频详情页一键搜索多个站点的磁力资源，自动识别画质和字幕<br>
                                            <strong>使用：</strong>点击右下角"🧲搜索磁力"按钮，查看搜索结果并一键复制磁力链接
                                        </p>
                                    </div>

                                    <div class="form-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="showEnhancedTooltips">
                                            <span class="checkmark"></span>
                                            💡 智能操作提示
                                        </label>
                                        <p class="input-description">
                                            <strong>效果：</strong>显示功能使用提示、快捷键说明和操作指导<br>
                                            <strong>使用：</strong>鼠标悬停在功能按钮上会显示详细说明，帮助快速上手
                                        </p>
                                    </div>
                                </div>

                                <!-- 保存按钮 -->
                                <div class="settings-section">
                                    <button id="saveEnhancementSettings" class="btn btn-primary">💾 保存增强设置</button>
                                    <p class="input-description" style="margin-top: 10px; text-align: center; color: #666;">
                                        保存后立即生效，无需重启浏览器。建议先启用"多数据源聚合"体验核心功能！
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- 高级配置 -->
                        <div class="settings-panel" id="advanced-settings">
                            <div class="settings-panel-header">
                                <h3>高级配置</h3>
                                <p class="settings-description">高级用户可以在此处查看和编辑原始配置数据。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="settings-section">
                                    <h4>原始设置 (JSON)</h4>
                                    <div class="action-buttons-top">
                                        <button id="editJsonBtn" class="btn">编辑</button>
                                        <button id="saveJsonBtn" class="btn hidden">保存</button>
                                        <button id="exportJsonBtn" class="btn">导出完整备份</button>
                                    </div>
                                    <textarea id="jsonConfig" readonly></textarea>
                                </div>



                                <div class="settings-section">
                                    <h4>原始番号库数据 (Raw Records)</h4>
                                    <div class="action-buttons-top">
                                        <button id="refreshRawRecordsBtn" class="btn">显示/刷新</button>
                                        <button id="checkDataStructureBtn" class="btn">检查数据结构</button>
                                        <!-- <button id="editRawRecordsBtn" class="btn">编辑</button> -->
                                        <!-- <button id="saveRawRecordsBtn" class="btn hidden">保存</button> -->
                                    </div>
                                    <textarea id="rawRecordsTextarea" readonly class="hidden"></textarea>
                                </div>

                                <div class="settings-section">
                                    <h4>演员库管理</h4>
                                    <div class="action-buttons-top">
                                        <button id="loadActorsBtn" class="btn">加载演员库</button>
                                        <button id="editActorsBtn" class="btn" disabled>编辑</button>
                                        <button id="saveActorsBtn" class="btn hidden">保存</button>
                                        <button id="exportActorsBtn" class="btn" disabled>导出演员库</button>
                                        <button id="importActorsBtn" class="btn">导入演员库</button>
                                        <input type="file" id="importActorsFile" accept=".json" style="display:none">
                                    </div>
                                    <div class="actors-stats" id="actorsStats" style="display:none">
                                        <div class="stats-grid">
                                            <div class="stat-item">
                                                <span class="stat-label">总演员数:</span>
                                                <span class="stat-value" id="totalActorsCount">0</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">女演员:</span>
                                                <span class="stat-value" id="femaleActorsCount">0</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">男演员:</span>
                                                <span class="stat-value" id="maleActorsCount">0</span>
                                            </div>
                                            <div class="stat-item">
                                                <span class="stat-label">性别未知:</span>
                                                <span class="stat-value" id="unknownGenderCount">0</span>
                                            </div>
                                        </div>
                                    </div>
                                    <textarea id="actorsConfig" readonly placeholder="点击加载演员库按钮加载演员数据"></textarea>
                                </div>

                                <div class="settings-section">
                                    <h4>原始日志 (Raw Logs)</h4>
                                    <div class="action-buttons-top">
                                        <button id="refreshRawLogsBtn" class="btn">显示/刷新日志</button>
                                        <button id="testLogBtn" class="btn">测试日志</button>
                                    </div>
                                    <textarea id="rawLogsTextarea" readonly class="hidden"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- 日志设置 -->
                        <div class="settings-panel" id="log-settings">
                            <div class="settings-panel-header">
                                <h3>日志设置</h3>
                                <p class="settings-description">配置扩展程序的日志记录行为。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="form-group">
                                    <label for="maxLogEntries">最大日志记录数:</label>
                                    <input type="number" id="maxLogEntries" class="number-input" min="100" max="10000">
                                    <p class="input-description">设置保留在存储中的最大日志条数，以防止占用过多空间。有效范围 100 - 10000。</p>
                                </div>

                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="verboseMode">
                                    <label for="verboseMode">
                                        <i class="fas fa-bug"></i>
                                        详细日志模式
                                    </label>
                                    <p class="input-description">启用后会显示更多调试信息，可能会产生大量日志输出。</p>
                                </div>

                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="showPrivacyLogs">
                                    <label for="showPrivacyLogs">
                                        <i class="fas fa-shield-alt"></i>
                                        显示隐私相关日志
                                    </label>
                                    <p class="input-description">显示隐私保护功能的详细日志信息。</p>
                                </div>

                                <div class="form-group-checkbox">
                                    <input type="checkbox" id="showStorageLogs">
                                    <label for="showStorageLogs">
                                        <i class="fas fa-database"></i>
                                        显示存储相关日志
                                    </label>
                                    <p class="input-description">显示数据存储和读取的详细日志信息。</p>
                                </div>
                            </div>
                        </div>

                        <!-- 全局操作 -->
                        <div class="settings-panel" id="global-actions">
                            <div class="settings-panel-header">
                                <h3>全局操作</h3>
                                <p class="settings-description">执行全局性的数据管理操作。请谨慎使用这些功能。</p>
                            </div>
                            <div class="settings-panel-body">
                                <div class="settings-section">
                                    <h4>数据管理</h4>
                                    <div class="action-buttons-top">
                                        <button id="clearAllBtn" class="btn danger">清空所有本地记录</button>
                                        <button id="exportAllBtn" class="btn">导出所有数据</button>
                                        <button id="importAllBtn" class="btn">导入数据</button>
                                        <input type="file" id="importAllFile" accept=".json" style="display: none;">
                                    </div>
                                    <p class="input-description">
                                        <strong>清空所有本地记录:</strong> 删除所有本地存储的视频记录、演员数据和设置。此操作不可撤销！<br>
                                        <strong>导出所有数据:</strong> 将所有数据导出为JSON文件，用于备份或迁移。<br>
                                        <strong>导入数据:</strong> 从JSON文件导入数据，可用于恢复备份或迁移数据。
                                    </p>
                                </div>

                                <div class="settings-section">
                                    <h4>缓存管理</h4>
                                    <div class="action-buttons-top">
                                        <button id="clearCacheBtn" class="btn">清空缓存</button>
                                        <button id="clearTempDataBtn" class="btn">清空临时数据</button>
                                    </div>
                                    <p class="input-description">
                                        <strong>清空缓存:</strong> 清除所有缓存的图片、头像等临时文件。<br>
                                        <strong>清空临时数据:</strong> 清除搜索历史、临时设置等非关键数据。
                                    </p>
                                </div>

                                <div class="settings-section">
                                    <h4>系统操作</h4>
                                    <div class="action-buttons-top">
                                        <button id="resetSettingsBtn" class="btn warning">重置所有设置</button>
                                        <button id="reloadExtensionBtn" class="btn">重新加载扩展</button>
                                    </div>
                                    <p class="input-description">
                                        <strong>重置所有设置:</strong> 将所有设置恢复为默认值，但保留数据记录。<br>
                                        <strong>重新加载扩展:</strong> 重新加载扩展程序，用于解决某些问题。
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="tab-logs" class="tab-content">
                <div class="card">
                    <div class="settings-section">
                        <h4>日志记录</h4>
                        <p class="settings-description">测试连接到指定服务器的延迟。输入一个URL，然后点击“开始测试”。</p>
                        <div class="filters">
                            <label for="log-level-filter">筛选等级:</label>
                            <select id="log-level-filter">
                                <option value="ALL">全部</option>
                                <option value="INFO">信息</option>
                                <option value="WARN">警告</option>
                                <option value="ERROR">错误</option>
                                <option value="DEBUG">调试</option>
                            </select>
                            <label for="log-source-filter">日志来源:</label>
                            <select id="log-source-filter">
                                <option value="ALL">全部来源</option>
                                <option value="GENERAL">常规日志</option>
                                <option value="DRIVE115">115网盘</option>
                            </select>
                            <button id="refresh-logs-button" class="button-like">刷新</button>
                            <button id="clear-logs-button" class="button-like danger">清空日志</button>
                        </div>
                        <div class="log-container">
                            <div id="log-body">
                                <!-- Log entries will be inserted here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="infoContainer">
                <!-- 版本和作者信息将由 JS 动态填充 -->
            </div>
        </div>
    </div>

  <div id="messageContainer"></div>

  <!-- Confirmation Modal -->
  <div id="confirmationModal" class="modal-overlay">
      <div class="modal-content">
          <h3 id="modalTitle">确认操作</h3>
          <p id="modalMessage">您确定要继续吗？</p>

          <!-- Restore options, hidden by default -->
          <div id="modalRestoreOptions" class="hidden">
              <p class="settings-description" style="margin-top: 15px; margin-bottom: 15px; text-align: left;">请选择要从备份文件中恢复的内容：</p>
              <div class="form-group-checkbox">
                  <input type="checkbox" id="modalRestoreSettings" checked>
                  <label for="modalRestoreSettings">扩展设置 (WebDAV, 搜索引擎等)</label>
              </div>
              <div class="form-group-checkbox">
                  <input type="checkbox" id="modalRestoreRecords" checked>
                  <label for="modalRestoreRecords">观看记录 (已观看, 我想看等)</label>
              </div>
              <p class="settings-description" style="font-size: 0.8em; margin-top: 10px; text-align: left; color: #999;">注意：未勾选的项目将保留当前数据，不会被覆盖。</p>
          </div>

          <div class="modal-actions">
              <button id="modalCancelBtn" class="button-like">取消</button>
              <button id="modalConfirmBtn" class="button-like danger">确认</button>
          </div>
      </div>
  </div>

  <!-- Smart Restore Confirmation Modal -->
  <div id="smartRestoreModal" class="modal-overlay hidden">
    <div class="modal-content smart-restore-modal">
      <div class="modal-header">
        <h3>
          <i class="fas fa-magic"></i>
          确认执行一键智能恢复？
        </h3>
        <button class="modal-close" id="smartRestoreModalClose">&times;</button>
      </div>

      <div class="modal-body">
        <div class="restore-preview">
          <h4>
            <i class="fas fa-eye"></i>
            操作预览：
          </h4>
          <div class="preview-list">
            <div class="preview-item">
              <i class="fas fa-shield-alt"></i>
              <span>保留本地视频记录：<strong id="localRecordsCount">0</strong>条</span>
            </div>
            <div class="preview-item">
              <i class="fas fa-users"></i>
              <span>保留本地演员收藏：<strong id="localActorsCount">0</strong>个</span>
            </div>
            <div class="preview-item">
              <i class="fas fa-cloud-download-alt"></i>
              <span>添加云端新增数据：<strong id="cloudNewDataCount">0</strong>项</span>
            </div>
            <div class="preview-item">
              <i class="fas fa-code-branch"></i>
              <span>自动处理冲突：<strong id="conflictsCount">0</strong>个（保留最新数据）</span>
            </div>
          </div>
        </div>

        <div class="restore-notice">
          <div class="notice-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="notice-content">
            <strong>注意：</strong>此操作将修改您的本地数据，建议在操作前确保已备份重要信息。
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button id="smartRestoreCancel" class="btn btn-secondary">
          <i class="fas fa-times"></i>
          取消
        </button>
        <button id="smartRestoreConfirm" class="btn btn-primary">
          <i class="fas fa-check"></i>
          确定
        </button>
      </div>
    </div>
  </div>

  <!-- Data Migration Modal -->
  <div id="migration-modal" class="modal-overlay hidden">
    <div class="modal-content">
      <h3 id="migration-modal-title">数据迁移</h3>
      <p id="migration-modal-message">检测到旧版本的数据格式。为了使用最新功能，建议您进行数据迁移。过程可能需要一些时间，请勿关闭此页面。</p>

      <div id="migration-progress-container" class="hidden">
        <div class="progress-bar-container">
          <div id="migration-progress-bar" class="progress-bar"></div>
        </div>
        <p id="migration-status-text">正在迁移...</p>
      </div>

      <div id="migration-modal-actions" class="modal-actions">
        <button id="migration-cancel-btn" class="button-like">稍后提醒</button>
        <button id="migration-confirm-btn" class="button-like primary">开始迁移</button>
      </div>
    </div>
  </div>

  <main class="main-content">
      <div id="dashboard-container" class="container is-fluid">
          <!-- Tabs will be dynamically generated here -->
          <div id="tabs-content" class="tabs-content">
              <!-- Tab content will be dynamically loaded here -->
          </div>
      </div>
  </main>

  <!-- Modal for confirmation and choices -->
  <div id="import-modal" class="import-modal-overlay">
      <div class="import-modal-content">
          <header class="import-modal-header">
              <p class="title">导入确认</p>
          </header>
          <section id="modal-text" class="import-modal-body">
              在这里显示确认信息或选项。
          </section>
          <footer class="import-modal-footer">
              <!-- Buttons will be dynamically added here -->
          </footer>
      </div>
  </div>

  <!-- Migration/Data Check Modal -->
  <div id="migration-modal" class="modal-overlay hidden">
      <div class="modal-content">
          <h3 class="modal-title">数据迁移</h3>
          <p id="migration-modal-message">检测到旧版本的数据格式。为了使用最新功能，建议您进行数据迁移。过程可能需要一些时间，请勿关闭此页面。</p>
          <div id="migration-progress-container" class="progress-container hidden">
              <div id="migration-progress-bar" class="progress-bar"></div>
              <p id="migration-status-text">正在处理...</p>
          </div>
          <div class="modal-actions" id="migration-modal-actions">
              <button id="migration-cancel-btn" class="button-like">稍后提醒</button>
              <button id="migration-confirm-btn" class="button-like primary">开始迁移</button>
          </div>
      </div>
  </div>

  <!-- Data Structure Check Confirmation Modal -->
  <div id="data-check-modal" class="modal-overlay hidden">
      <div class="modal-content">
          <h3 class="modal-title">确认数据结构修复</h3>
          <p id="data-check-modal-message"></p>
          <div class="diff-container">
              <div class="diff-view">
                  <h4>修复前</h4>
                  <pre id="data-check-diff-before"></pre>
              </div>
              <div class="diff-view">
                  <h4>修复后</h4>
                  <pre id="data-check-diff-after"></pre>
              </div>
          </div>
          <div class="modal-actions" id="data-check-modal-actions">
              <button id="data-check-cancel-btn" class="button-like">取消</button>
              <button id="data-check-confirm-btn" class="button-like primary">确认修复</button>
          </div>
      </div>
  </div>

  <!-- Help Panel Modal -->
  <div id="helpPanel" class="modal-overlay hidden">
      <div class="help-content-wrapper">
          <div class="help-header">
              <h2>Jav 助手 - 功能说明</h2>
              <button id="closeHelpBtn" title="关闭">&times;</button>
          </div>
          <div class="help-body">
              <!-- Help content will be dynamically loaded here -->
          </div>
      </div>
  </div>

  <!-- WebDAV 恢复弹窗 -->
  <div id="webdavRestoreModal" class="modal-overlay hidden">
      <div class="modal-content webdav-restore-modal">
          <div class="modal-header">
              <h3>
                  <i class="fas fa-cloud-download-alt"></i>
                  从云端恢复数据
              </h3>
              <button class="modal-close" id="webdavRestoreModalClose">&times;</button>
          </div>

          <div class="modal-body">
              <div id="webdavRestoreLoading" class="restore-loading hidden">
                  <div class="loading-spinner">
                      <i class="fas fa-spinner fa-spin"></i>
                  </div>
                  <p>正在获取云端文件列表...</p>
              </div>

              <div id="webdavRestoreContent" class="restore-content hidden">
                  <div class="restore-description">
                      <p>选择要恢复的备份文件。恢复操作将覆盖本地数据，请谨慎操作。</p>
                  </div>

                  <div class="file-list-container">
                      <div class="file-list-header">
                          <h4>
                              <i class="fas fa-folder-open"></i>
                              可用的备份文件
                          </h4>
                      </div>
                      <ul id="webdavFileList" class="webdav-file-list">
                          <!-- 文件列表将动态生成 -->
                      </ul>
                  </div>

                  <!-- 数据预览和分析阶段 -->
                  <div id="webdavDataPreview" class="data-preview hidden">

                      <!-- 模式选择器 -->
                      <div class="restore-mode-selector">
                          <div class="mode-tabs">
                              <button class="mode-tab active" data-mode="quick">
                                  <i class="fas fa-bolt"></i>
                                  <span>快捷恢复</span>
                              </button>
                              <button class="mode-tab" data-mode="wizard">
                                  <i class="fas fa-route"></i>
                                  <span>向导模式</span>
                              </button>
                              <button class="mode-tab" data-mode="expert">
                                  <i class="fas fa-cog"></i>
                                  <span>专家模式</span>
                              </button>
                          </div>
                      </div>

                      <!-- 快捷模式界面 -->
                      <div id="quickMode" class="restore-mode-content active">
                          <div class="quick-restore-card">
                              <div class="quick-header">
                                  <i class="fas fa-magic"></i>
                                  <h3>一键智能恢复</h3>
                                  <span class="recommended-badge">推荐</span>
                              </div>
                              <div class="quick-description">
                                  <p>自动分析并处理所有数据冲突，保留最新和最完整的信息</p>
                                  <div class="quick-features">
                                      <div class="feature-item">
                                          <i class="fas fa-check-circle"></i>
                                          <span>智能合并冲突数据</span>
                                      </div>
                                      <div class="feature-item">
                                          <i class="fas fa-shield-alt"></i>
                                          <span>安全保留本地数据</span>
                                      </div>
                                      <div class="feature-item">
                                          <i class="fas fa-clock"></i>
                                          <span>预计用时：2-5分钟</span>
                                      </div>
                                  </div>
                              </div>
                              <div class="quick-stats" id="quickModeStats">
                                  <div class="stat-item">
                                      <span class="stat-number" id="quickVideoCount">-</span>
                                      <span class="stat-label">视频记录</span>
                                  </div>
                                  <div class="stat-item">
                                      <span class="stat-number" id="quickActorCount">-</span>
                                      <span class="stat-label">演员收藏</span>
                                  </div>
                                  <div class="stat-item">
                                      <span class="stat-number" id="quickConflictCount">-</span>
                                      <span class="stat-label">需处理冲突</span>
                                  </div>
                              </div>
                              <button class="btn btn-primary btn-large" id="quickRestoreBtn">
                                  <i class="fas fa-play"></i>
                                  开始智能恢复
                              </button>
                          </div>
                      </div>

                      <!-- 向导模式界面 -->
                      <div id="wizardMode" class="restore-mode-content">
                          <!-- 步骤指示器 -->
                          <div class="wizard-steps">
                              <div class="step active" data-step="1">
                                  <div class="step-number">1</div>
                                  <div class="step-title">选择策略</div>
                              </div>
                              <div class="step" data-step="2">
                                  <div class="step-number">2</div>
                                  <div class="step-title">选择内容</div>
                              </div>
                              <div class="step" data-step="3">
                                  <div class="step-number">3</div>
                                  <div class="step-title">确认执行</div>
                              </div>
                          </div>

                          <!-- 步骤内容 -->
                          <div class="wizard-content">
                              <!-- 步骤1：策略选择 -->
                              <div class="wizard-step-content active" id="wizardStep1">
                                  <h4>选择恢复策略</h4>
                                  <p class="step-description">请选择如何处理本地数据与云端备份的差异</p>

                                  <div class="strategy-grid">
                                      <div class="strategy-card recommended">
                                          <input type="radio" id="wizardSmartMerge" name="wizardStrategy" value="smart" checked>
                                          <label for="wizardSmartMerge">
                                              <div class="strategy-icon">
                                                  <i class="fas fa-magic"></i>
                                              </div>
                                              <div class="strategy-content">
                                                  <h5>智能合并 <span class="recommended-text">推荐</span></h5>
                                                  <p>自动处理冲突，保留最新数据</p>
                                                  <div class="strategy-tags">
                                                      <span class="tag">安全</span>
                                                      <span class="tag">智能</span>
                                                  </div>
                                              </div>
                                          </label>
                                      </div>

                                      <div class="strategy-card">
                                          <input type="radio" id="wizardKeepLocal" name="wizardStrategy" value="local">
                                          <label for="wizardKeepLocal">
                                              <div class="strategy-icon">
                                                  <i class="fas fa-hdd"></i>
                                              </div>
                                              <div class="strategy-content">
                                                  <h5>保留本地</h5>
                                                  <p>完全保留本地数据，忽略云端</p>
                                                  <div class="strategy-tags">
                                                      <span class="tag">保守</span>
                                                  </div>
                                              </div>
                                          </label>
                                      </div>

                                      <div class="strategy-card">
                                          <input type="radio" id="wizardKeepCloud" name="wizardStrategy" value="cloud">
                                          <label for="wizardKeepCloud">
                                              <div class="strategy-icon">
                                                  <i class="fas fa-cloud"></i>
                                              </div>
                                              <div class="strategy-content">
                                                  <h5>使用云端</h5>
                                                  <p>用云端数据覆盖本地</p>
                                                  <div class="strategy-tags">
                                                      <span class="tag warning">有风险</span>
                                                  </div>
                                              </div>
                                          </label>
                                      </div>

                                      <div class="strategy-card">
                                          <input type="radio" id="wizardManual" name="wizardStrategy" value="manual">
                                          <label for="wizardManual">
                                              <div class="strategy-icon">
                                                  <i class="fas fa-hand-paper"></i>
                                              </div>
                                              <div class="strategy-content">
                                                  <h5>手动处理</h5>
                                                  <p>查看详细差异，手动选择</p>
                                                  <div class="strategy-tags">
                                                      <span class="tag">精确</span>
                                                  </div>
                                              </div>
                                          </label>
                                      </div>
                                  </div>

                                  <!-- 策略预览 -->
                                  <div class="strategy-preview" id="strategyPreview">
                                      <h5>操作预览</h5>
                                      <div class="preview-content" id="previewContent">
                                          <p>选择策略后将显示详细的操作预览</p>
                                      </div>
                                  </div>
                              </div>

                              <!-- 步骤2：内容选择 -->
                              <div class="wizard-step-content" id="wizardStep2">
                                  <h4>选择恢复内容</h4>
                                  <p class="step-description">选择要从云端备份恢复的数据类型</p>

                                  <div class="content-selection-grid" id="contentSelectionGrid">
                                      <!-- 内容选择项将动态生成 -->
                                  </div>
                              </div>

                              <!-- 步骤3：确认执行 -->
                              <div class="wizard-step-content" id="wizardStep3">
                                  <h4>确认恢复操作</h4>
                                  <p class="step-description">请确认以下操作，点击开始恢复后将无法撤销</p>

                                  <div class="confirmation-summary" id="confirmationSummary">
                                      <!-- 确认摘要将动态生成 -->
                                  </div>

                                  <div class="confirmation-warning">
                                      <i class="fas fa-exclamation-triangle"></i>
                                      <p>恢复操作将修改您的本地数据，建议在操作前确保已备份重要信息</p>
                                  </div>
                              </div>
                          </div>

                          <!-- 向导导航 -->
                          <div class="wizard-navigation">
                              <button class="btn btn-secondary" id="wizardPrevBtn" disabled>
                                  <i class="fas fa-chevron-left"></i>
                                  上一步
                              </button>
                              <button class="btn btn-primary" id="wizardNextBtn">
                                  下一步
                                  <i class="fas fa-chevron-right"></i>
                              </button>
                              <button class="btn btn-primary hidden" id="wizardStartBtn">
                                  <i class="fas fa-play"></i>
                                  开始恢复
                              </button>
                          </div>
                      </div>

                      <!-- 专家模式界面 -->
                      <div id="expertMode" class="restore-mode-content">
                          <h4>
                              <i class="fas fa-chart-line"></i>
                              数据差异分析
                          </h4>

                      <div class="diff-summary">
                          <div class="diff-category">
                              <div class="diff-header">
                                  <i class="fas fa-video"></i>
                                  <span>视频记录</span>
                              </div>
                              <div class="diff-stats">
                                  <div class="stat-item">
                                      <span class="stat-label">云端新增:</span>
                                      <span class="stat-value" id="videoCloudOnlyCount">0</span>
                                  </div>
                                  <div class="stat-item">
                                      <span class="stat-label">本地保留:</span>
                                      <span class="stat-value" id="videoLocalCount">0</span>
                                  </div>
                                  <div class="stat-item conflict">
                                      <span class="stat-label">发现冲突:</span>
                                      <span class="stat-value" id="videoConflictCount">0</span>
                                      <button class="btn-link" id="viewVideoConflicts">查看详情</button>
                                  </div>
                                  <div class="stat-item">
                                      <span class="stat-label">本地独有:</span>
                                      <span class="stat-value" id="videoLocalOnlyCount">0</span>
                                      <small>(云端没有)</small>
                                  </div>
                              </div>
                          </div>

                          <div class="diff-category">
                              <div class="diff-header">
                                  <i class="fas fa-users"></i>
                                  <span>演员收藏</span>
                              </div>
                              <div class="diff-stats">
                                  <div class="stat-item">
                                      <span class="stat-label">云端新增:</span>
                                      <span class="stat-value" id="actorCloudOnlyCount">0</span>
                                  </div>
                                  <div class="stat-item">
                                      <span class="stat-label">本地保留:</span>
                                      <span class="stat-value" id="actorLocalCount">0</span>
                                  </div>
                                  <div class="stat-item conflict">
                                      <span class="stat-label">发现冲突:</span>
                                      <span class="stat-value" id="actorConflictCount">0</span>
                                      <button class="btn-link" id="viewActorConflicts">查看详情</button>
                                  </div>
                              </div>
                          </div>

                          <div class="diff-category">
                              <div class="diff-header">
                                  <i class="fas fa-cogs"></i>
                                  <span>扩展设置</span>
                              </div>
                              <div class="diff-stats">
                                  <div class="stat-item" id="settingsDiffStatus">
                                      <span class="stat-label">状态:</span>
                                      <span class="stat-value">检测中...</span>
                                      <button class="btn-link hidden" id="viewSettingsDiff">查看详情</button>
                                  </div>
                              </div>
                          </div>
                      </div>

                      <div class="merge-strategy-section">
                          <h5>
                              <i class="fas fa-code-branch"></i>
                              处理方式选择
                          </h5>
                          <div class="strategy-options">
                              <div class="strategy-option">
                                  <input type="radio" id="strategySmartMerge" name="mergeStrategy" value="smart" checked>
                                  <label for="strategySmartMerge">
                                      <div class="strategy-title">
                                          <i class="fas fa-magic"></i>
                                          智能合并 (推荐)
                                      </div>
                                      <div class="strategy-description">
                                          保留本地数据，添加云端新数据，冲突项按时间戳保留最新
                                      </div>
                                  </label>
                              </div>

                              <div class="strategy-option">
                                  <input type="radio" id="strategyCloudPriority" name="mergeStrategy" value="cloud-priority">
                                  <label for="strategyCloudPriority">
                                      <div class="strategy-title">
                                          <i class="fas fa-cloud-download-alt"></i>
                                          云端优先
                                      </div>
                                      <div class="strategy-description">
                                          用云端数据覆盖本地，丢失本地独有数据
                                      </div>
                                  </label>
                              </div>

                              <div class="strategy-option">
                                  <input type="radio" id="strategyLocalPriority" name="mergeStrategy" value="local-priority">
                                  <label for="strategyLocalPriority">
                                      <div class="strategy-title">
                                          <i class="fas fa-hdd"></i>
                                          本地优先
                                      </div>
                                      <div class="strategy-description">
                                          保持本地数据不变，只添加云端新增
                                      </div>
                                  </label>
                              </div>

                              <div class="strategy-option">
                                  <input type="radio" id="strategyCustom" name="mergeStrategy" value="custom">
                                  <label for="strategyCustom">
                                      <div class="strategy-title">
                                          <i class="fas fa-sliders-h"></i>
                                          自定义处理
                                      </div>
                                      <div class="strategy-description">
                                          手动选择每个冲突项的处理方式
                                      </div>
                                  </label>
                              </div>
                          </div>
                      </div>

                      <div class="restore-options-section">
                          <h5>
                              <i class="fas fa-check-square"></i>
                              恢复内容选择
                          </h5>
                          <div class="restore-options-grid">
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreSettings" checked>
                                  <label for="webdavRestoreSettings">
                                      <i class="fas fa-cogs"></i>
                                      扩展设置
                                  </label>
                                  <small>WebDAV配置、搜索引擎、显示设置等</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreRecords" checked>
                                  <label for="webdavRestoreRecords">
                                      <i class="fas fa-database"></i>
                                      观看记录
                                  </label>
                                  <small>已观看、我想看、已浏览等状态记录</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreUserProfile" checked>
                                  <label for="webdavRestoreUserProfile">
                                      <i class="fas fa-user-circle"></i>
                                      账号信息
                                  </label>
                                  <small>JavDB账号邮箱、用户名、用户类型等</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreActorRecords" checked>
                                  <label for="webdavRestoreActorRecords">
                                      <i class="fas fa-users"></i>
                                      演员库
                                  </label>
                                  <small>收藏的演员信息、性别、分类等数据</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreLogs">
                                  <label for="webdavRestoreLogs">
                                      <i class="fas fa-file-alt"></i>
                                      日志记录
                                  </label>
                                  <small>扩展运行日志，用于故障排查（可选）</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreImportStats">
                                  <label for="webdavRestoreImportStats">
                                      <i class="fas fa-chart-bar"></i>
                                      导入统计
                                  </label>
                                  <small>最后一次导入的统计信息（可选）</small>
                              </div>
                          </div>
                      </div>

                      <div class="impact-preview">
                          <h5>
                              <i class="fas fa-exclamation-triangle"></i>
                              影响预览
                          </h5>
                          <div class="impact-summary" id="impactSummary">
                              <!-- 动态生成影响预览内容 -->
                          </div>
                      </div>
                      </div> <!-- 关闭 expertMode -->

                  </div> <!-- 关闭 webdavDataPreview -->

                  <!-- 原有的简单恢复选项（向后兼容，隐藏） -->
                  <div id="webdavRestoreOptions" class="restore-options hidden" style="display: none;">
                      <h4>
                          <i class="fas fa-cog"></i>
                          恢复选项
                      </h4>
                      <div class="restore-options-grid">
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreSettingsSimple" checked>
                              <label for="webdavRestoreSettingsSimple">
                                  <i class="fas fa-cogs"></i>
                                  扩展设置
                              </label>
                              <small>WebDAV配置、搜索引擎、显示设置等</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreRecordsSimple" checked>
                              <label for="webdavRestoreRecordsSimple">
                                  <i class="fas fa-database"></i>
                                  观看记录
                              </label>
                              <small>已观看、我想看、已浏览等状态记录</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreUserProfileSimple" checked>
                              <label for="webdavRestoreUserProfileSimple">
                                  <i class="fas fa-user-circle"></i>
                                  账号信息
                              </label>
                              <small>JavDB账号邮箱、用户名、用户类型等</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreActorRecordsSimple" checked>
                              <label for="webdavRestoreActorRecordsSimple">
                                  <i class="fas fa-users"></i>
                                  演员库
                              </label>
                              <small>收藏的演员信息、性别、分类等数据</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreLogsSimple">
                              <label for="webdavRestoreLogsSimple">
                                  <i class="fas fa-file-alt"></i>
                                  日志记录
                              </label>
                              <small>扩展运行日志，用于故障排查（可选）</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreImportStatsSimple">
                              <label for="webdavRestoreImportStatsSimple">
                                  <i class="fas fa-chart-bar"></i>
                                  导入统计
                              </label>
                              <small>最后一次导入的统计信息（可选）</small>
                          </div>
                      </div>
                  </div>
              </div>

              <div id="webdavRestoreError" class="restore-error hidden">
                  <div class="error-icon">
                      <i class="fas fa-exclamation-triangle"></i>
                  </div>
                  <h4>获取文件列表失败</h4>
                  <p id="webdavRestoreErrorMessage">请检查WebDAV设置是否正确。</p>
                  <button id="webdavRestoreRetry" class="btn btn-primary">
                      <i class="fas fa-redo"></i>
                      重试
                  </button>
              </div>
          </div>

          <div class="modal-footer">
              <button id="webdavRestoreBack" class="btn btn-secondary hidden">
                  <i class="fas fa-arrow-left"></i>
                  返回
              </button>
              <button id="webdavRestoreCancel" class="btn btn-secondary">取消</button>
              <button id="webdavRestoreAnalyze" class="btn btn-primary hidden">
                  <i class="fas fa-search"></i>
                  分析数据
              </button>
              <button id="webdavRestoreConfirm" class="btn btn-primary" disabled>
                  <i class="fas fa-download"></i>
                  开始恢复
              </button>
          </div>
      </div>
  </div>

  <!-- 冲突解决弹窗 -->
  <div id="conflictResolutionModal" class="modal-overlay hidden">
      <div class="modal-content conflict-resolution-modal">
          <div class="modal-header">
              <h3>
                  <i class="fas fa-exclamation-triangle"></i>
                  解决数据冲突
              </h3>
              <button class="modal-close" id="conflictResolutionModalClose">&times;</button>
          </div>

          <div class="modal-body">
              <div class="conflict-navigation">
                  <div class="conflict-info">
                      <p>请选择每个冲突项的保留方式，完成后点击确认应用解决方案</p>
                      <small>您可以使用批量操作快速处理多个冲突项</small>
                  </div>
              </div>

              <div class="conflict-details">
                  <div class="conflict-item-header">
                      <h4 id="conflictItemTitle">SSIS-001</h4>
                      <span class="conflict-type" id="conflictItemType">视频记录</span>
                  </div>

                  <div class="conflict-comparison">
                      <div class="version-column local-version">
                          <div class="version-header">
                              <i class="fas fa-hdd"></i>
                              <span>本地版本</span>
                              <small id="localVersionTime">2024-01-01 14:30</small>
                          </div>
                          <div class="version-content" id="localVersionContent">
                              <!-- 动态生成本地版本内容 -->
                          </div>
                      </div>

                      <div class="version-column cloud-version">
                          <div class="version-header">
                              <i class="fas fa-cloud"></i>
                              <span>云端版本</span>
                              <small id="cloudVersionTime">2024-01-01 16:45</small>
                          </div>
                          <div class="version-content" id="cloudVersionContent">
                              <!-- 动态生成云端版本内容 -->
                          </div>
                      </div>
                  </div>

                  <div class="resolution-options">
                      <h5>选择保留:</h5>
                      <div class="resolution-buttons">
                          <label class="resolution-option">
                              <input type="radio" name="currentResolution" value="local">
                              <span class="resolution-label">
                                  <i class="fas fa-hdd"></i>
                                  保留本地
                              </span>
                          </label>
                          <label class="resolution-option">
                              <input type="radio" name="currentResolution" value="cloud">
                              <span class="resolution-label">
                                  <i class="fas fa-cloud"></i>
                                  保留云端
                              </span>
                          </label>
                          <label class="resolution-option">
                              <input type="radio" name="currentResolution" value="merge" checked>
                              <span class="resolution-label">
                                  <i class="fas fa-code-branch"></i>
                                  智能合并
                              </span>
                          </label>
                      </div>
                  </div>

                  <div class="batch-operations">
                      <h5>批量操作:</h5>
                      <div class="batch-buttons">
                          <button id="batchSelectLocal" class="btn btn-sm btn-outline">
                              <i class="fas fa-hdd"></i>
                              全选本地
                          </button>
                          <button id="batchSelectCloud" class="btn btn-sm btn-outline">
                              <i class="fas fa-cloud"></i>
                              全选云端
                          </button>
                          <button id="batchSelectMerge" class="btn btn-sm btn-outline">
                              <i class="fas fa-code-branch"></i>
                              全选合并
                          </button>
                      </div>
                  </div>
              </div>
          </div>

          <div class="modal-footer conflict-footer">
              <div class="footer-left">
                  <div class="conflict-progress">
                      <span class="progress-text">
                          冲突 <span id="currentConflictIndex">1</span> / <span id="totalConflictsCount">0</span>
                      </span>
                      <div class="progress-bar">
                          <div class="progress-fill" id="conflictProgressFill"></div>
                      </div>
                  </div>
              </div>

              <div class="footer-center">
                  <div class="nav-buttons">
                      <button id="prevConflict" class="btn btn-nav" title="上一个冲突">
                          <i class="fas fa-chevron-left"></i>
                          上一个
                      </button>
                      <button id="nextConflict" class="btn btn-nav" title="下一个冲突">
                          下一个
                          <i class="fas fa-chevron-right"></i>
                      </button>
                  </div>
              </div>

              <div class="footer-right">
                  <button id="conflictResolutionCancel" class="btn btn-secondary">
                      <i class="fas fa-times"></i>
                      取消
                  </button>
                  <button id="conflictResolutionConfirm" class="btn btn-primary">
                      <i class="fas fa-check"></i>
                      确认解决方案
                  </button>
              </div>
          </div>
      </div>
  </div>

  <!-- 恢复结果摘要弹窗 -->
  <div id="restoreResultModal" class="modal-overlay hidden">
      <div class="modal-content restore-result-modal">
          <div class="modal-header">
              <h3>
                  <i class="fas fa-check-circle"></i>
                  恢复完成
              </h3>
              <button class="modal-close" id="restoreResultModalClose">&times;</button>
          </div>

          <div class="modal-body">
              <div class="result-summary">
                  <div class="result-icon success">
                      <i class="fas fa-check-circle"></i>
                  </div>
                  <h4>数据恢复成功</h4>
                  <p>已成功从云端恢复数据并应用到本地。</p>
              </div>

              <div class="operation-summary">
                  <h5>
                      <i class="fas fa-chart-bar"></i>
                      操作摘要
                  </h5>
                  <div class="summary-grid" id="operationSummaryGrid">
                      <!-- 动态生成操作摘要 -->
                  </div>
              </div>

              <div class="backup-info">
                  <h5>
                      <i class="fas fa-shield-alt"></i>
                      安全备份
                  </h5>
                  <p>已自动备份原数据到:</p>
                  <div class="backup-file-info">
                      <code id="backupFileName">backup-before-restore-20240101.json</code>
                      <button id="downloadBackup" class="btn btn-sm btn-outline">
                          <i class="fas fa-download"></i>
                          下载备份
                      </button>
                  </div>
              </div>
          </div>

          <div class="modal-footer">
              <button id="restoreResultViewDetails" class="btn btn-secondary">查看详情</button>
              <button id="restoreResultConfirm" class="btn btn-primary">
                  <i class="fas fa-check"></i>
                  确定
              </button>
          </div>
      </div>
  </div>

  <script type="module" src="dashboard.ts"></script>
</body>
</html>