  <!-- Confirmation Modal -->
  <div id="confirmationModal" class="modal-overlay">
      <div class="modal-content">
          <h3 id="modalTitle">确认操作</h3>
          <p id="modalMessage">您确定要继续吗？</p>

          <!-- Restore options, hidden by default -->
          <div id="modalRestoreOptions" class="hidden">
              <p class="settings-description" style="margin-top: 15px; margin-bottom: 15px; text-align: left;">请选择要从备份文件中恢复的内容：</p>
              <div class="form-group-checkbox">
                  <input type="checkbox" id="modalRestoreSettings" checked>
                  <label for="modalRestoreSettings">扩展设置 (WebDAV, 搜索引擎等)</label>
              </div>
              <div class="form-group-checkbox">
                  <input type="checkbox" id="modalRestoreRecords" checked>
                  <label for="modalRestoreRecords">观看记录 (已观看, 我想看等)</label>
              </div>
              <p class="settings-description" style="font-size: 0.8em; margin-top: 10px; text-align: left; color: #999;">注意：未勾选的项目将保留当前数据，不会被覆盖。</p>
          </div>

          <div class="modal-actions">
              <button id="modalCancelBtn" class="button-like">取消</button>
              <button id="modalConfirmBtn" class="button-like danger">确认</button>
          </div>
      </div>
  </div>

  <!-- Orchestrator Visualization Modal -->
  <div id="orchestratorModal" class="modal-overlay hidden">
    <div id="orchestratorModalContent" class="modal-content" style="width:94vw; max-width: 1600px; max-height: 88vh; background:#fff; color:#111; box-shadow: 0 12px 28px rgba(0,0,0,0.25); display:flex; flex-direction:column; overflow:hidden;">
      <div class="modal-header">
        <h3>
          <i class="fas fa-project-diagram"></i>
          功能编排可视化
        </h3>
        <div style="display:flex; gap:8px; align-items:center;">
          <button class="button-like" id="orchestratorFullscreenBtn" title="全屏/退出全屏">全屏</button>
          <button class="modal-close" id="orchestratorModalClose">&times;</button>
        </div>
      </div>
      <div class="modal-body" style="overflow:auto;">
        <div id="orchestratorSummary" class="settings-description" style="margin-bottom:10px;">正在读取当前页面编排信息...</div>
        <div class="orchestrator-toolbar" style="margin: 6px 0 10px 0;">
          <label>视图
            <select id="orchViewMode">
              <option value="design">设计</option>
              <option value="realtime">实时</option>
            </select>
          </label>
          <label>状态
            <select id="orchFilterStatus">
              <option value="all">全部</option>
              <option value="running">运行中</option>
              <option value="done">已完成</option>
              <option value="error">错误</option>
              <option value="scheduled">已排程</option>
            </select>
          </label>
          <label>阶段
            <select id="orchFilterPhase">
              <option value="all">全部</option>
              <option value="critical">critical</option>
              <option value="high">high</option>
              <option value="deferred">deferred</option>
              <option value="idle">idle</option>
            </select>
          </label>
          <input id="orchFilterSearch" type="search" placeholder="按任务关键词搜索…" style="flex:1;" />
        </div>
        <div class="orch-legend" style="margin:8px 0 12px 0; font-size:12px; color:#52525b; line-height:1.6; background:#f8fafc; border:1px solid #e5e7eb; border-radius:8px; padding:8px 10px; text-align:left;">
          <div><strong>说明：</strong>本设计视图仅展示“代码中约定的任务编排顺序”，不依赖页面加载。</div>
          <div>• <strong>critical</strong>：关键路径，首屏必须；串行完成。</div>
          <div>• <strong>high</strong>：较高优先，尽快执行；并行触发。</div>
          <div>• <strong>deferred</strong>：延后执行；常结合 <code>delay</code>/<code>idle</code>，避免阻塞首屏。</div>
          <div>• <strong>idle</strong>：空闲时机再执行，对交互影响最低。</div>
        </div>
        <div class="orchestrator-grid" style="display:grid; grid-template-columns: 1fr 1.2fr; gap:14px;">
          <div>
            <h4 style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
              <span>已注册任务</span>
              <button id="orchestratorCopyPhasesBtn" class="button-like" title="复制下方任务清单文本">复制</button>
            </h4>
            <div id="orchestratorPhases" class="scrollable" style="max-height:60vh; overflow:auto; border:1px solid var(--border-color); border-radius:8px; padding:10px;"></div>
          </div>
          <div>
            <h4 style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
              <span>事件时间线</span>
              <button id="orchestratorCopyTimelineBtn" class="button-like" title="复制下方时间线文本">复制</button>
            </h4>
            <div id="orchestratorTimeline" class="scrollable" style="max-height:60vh; overflow:auto; border:1px solid var(--border-color); border-radius:8px; padding:10px;"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="display:flex; justify-content:flex-end; gap:8px;">
        <button id="orchestratorOpenJavdbBtn" class="button-like" title="打开一个 JavDB 标签页用于连接">打开 JavDB</button>
        <button id="orchestratorRefreshBtn" class="button-like">
          <i class="fas fa-sync-alt"></i>
          刷新
        </button>
        <button id="orchestratorCloseBtn" class="button-like">关闭</button>
      </div>
    </div>
  </div>

  <!-- Filter Rule Modal -->
  <div id="filterRuleModal" class="modal-overlay hidden">
    <div class="modal-content modal-dialog" style="max-width: 720px; background:#fff; color:#111; box-shadow: 0 12px 28px rgba(0,0,0,0.25);">
      <div class="modal-header">
        <h3 id="filterRuleModalTitle">添加过滤规则</h3>
        <button class="modal-close" id="filterRuleModalClose" title="关闭">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="modalInlineRuleName" class="form-label">规则名称</label>
          <input id="modalInlineRuleName" type="text" class="form-control" placeholder="给规则起个名字，便于识别">
          <div class="form-text">例如：隐藏含广告词条</div>
        </div>

        <div class="form-group">
          <label for="modalInlineRuleKeyword" class="form-label">关键词 / 正则</label>
          <input id="modalInlineRuleKeyword" type="text" class="form-control" placeholder="支持普通文本或正则表达式">
          <div class="form-text">正则需勾选下方“正则表达式”，如：^(FC2|HEYZO)-\d+</div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="modalInlineRuleAction" class="form-label">动作</label>
            <select id="modalInlineRuleAction" class="form-select">
              <option value="hide">隐藏</option>
              <option value="highlight">高亮</option>
              <option value="blur">模糊</option>
              <option value="mark">标记</option>
            </select>
          </div>

          <div class="form-group">
            <label for="modalInlineRuleFields" class="form-label">作用字段</label>
            <select id="modalInlineRuleFields" class="form-select" multiple>
              <option value="title">标题</option>
              <option value="actor">演员</option>
              <option value="studio">厂牌/片商</option>
              <option value="genre">类型</option>
              <option value="tag">标签</option>
              <option value="video-id">番号</option>
            </select>
            <div class="form-text">按住 Ctrl/Shift 可多选</div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-check-label"><input id="modalInlineRuleIsRegex" type="checkbox" class="form-check-input"> 正则表达式</label>
          </div>
          <div class="form-group">
            <label class="form-check-label"><input id="modalInlineRuleCaseSensitive" type="checkbox" class="form-check-input"> 区分大小写</label>
          </div>
          <div class="form-group">
            <label class="form-check-label"><input id="modalInlineRuleEnabled" type="checkbox" class="form-check-input" checked> 启用</label>
          </div>
        </div>

        <div class="form-group">
          <label for="modalInlineRuleMessage" class="form-label">提示信息（可选）</label>
          <textarea id="modalInlineRuleMessage" rows="3" class="form-control" placeholder="为匹配项添加备注或提示文本"></textarea>
        </div>
      </div>
      <div class="modal-footer" style="display:flex; justify-content:flex-end; gap:8px;">
        <button id="cancelFilterRuleBtn" class="btn btn-secondary">取消</button>
        <button id="saveFilterRuleBtn" class="btn btn-primary">保存</button>
      </div>
    </div>
  </div>

  <!-- Smart Restore Confirmation Modal -->
  <div id="smartRestoreModal" class="modal-overlay hidden">
    <div class="modal-content smart-restore-modal">
      <div class="modal-header">
        <h3>
          <i class="fas fa-magic"></i>
          确认执行一键智能恢复？
        </h3>
        <button class="modal-close" id="smartRestoreModalClose">&times;</button>
      </div>

      <div class="modal-body">
        <div class="restore-preview">
          <h4>
            <i class="fas fa-eye"></i>
            操作预览：
          </h4>
          <div class="preview-list">
            <div class="preview-item">
              <i class="fas fa-shield-alt"></i>
              <span>保留本地视频记录：<strong id="localRecordsCount">0</strong>条</span>
            </div>
            <div class="preview-item">
              <i class="fas fa-users"></i>
              <span>保留本地演员收藏：<strong id="localActorsCount">0</strong>个</span>
            </div>
            <div class="preview-item">
              <i class="fas fa-cloud-download-alt"></i>
              <span>添加云端新增数据：<strong id="cloudNewDataCount">0</strong>项</span>
            </div>
            <div class="preview-item">
              <i class="fas fa-code-branch"></i>
             &#x6062;&#x590D;&#x65B9;&#x5F0F;&#x9009;&#x62E9;&#xFF08;&#x8986;&#x76D6;&#x5F0F;&#xFF09;<span>自动处理冲突：<strong id="conflictsCount">0</strong>个（保留最新数据）</span>
            </div>
          </div>
        </div>

        <div class="restore-notice">
          <div class="notice-icon">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div class="notice-content">
            <strong>注意：</strong>此操作将修改您的本地数据，建议在操作前确保已备份重要信息。
          </div>
        </div>
      </div>

      <div class="modal-footer" style="position: relative !important; z-index: 9999 !important; display: flex !important; justify-content: flex-end !important; gap: 16px !important;">
        <button id="smartRestoreCancel" class="btn btn-secondary">
          <i class="fas fa-times"></i>
          取消
        </button>
        <button id="smartRestoreConfirm" class="btn btn-primary">
          <i class="fas fa-check"></i>
          确定
        </button>
      </div>
    </div>
  </div>



  <!-- Modal for confirmation and choices -->
  <div id="import-modal" class="import-modal-overlay">
      <div class="import-modal-content">
          <header class="import-modal-header">
              <p class="title">导入确认</p>
          </header>
          <section id="modal-text" class="import-modal-body">
              在这里显示确认信息或选项。
          </section>
          <footer class="import-modal-footer">
              <!-- Buttons will be dynamically added here -->
          </footer>
      </div>
  </div>

  <!-- Migration/Data Check Modal -->
  <div id="migration-modal" class="modal-overlay hidden">
      <div class="modal-content">
          <h3 class="modal-title">数据迁移</h3>
          <p id="migration-modal-message">检测到旧版本的数据格式。为了使用最新功能，建议您进行数据迁移。过程可能需要一些时间，请勿关闭此页面。</p>
          <div id="migration-progress-container" class="progress-container hidden">
              <div id="migration-progress-bar" class="progress-bar"></div>
              <p id="migration-status-text">正在处理...</p>
          </div>
          <div class="modal-actions" id="migration-modal-actions">
              <button id="migration-cancel-btn" class="button-like">稍后提醒</button>
              <button id="migration-confirm-btn" class="button-like primary">开始迁移</button>
          </div>
      </div>
  </div>

  <!-- Data Structure Check Confirmation Modal -->
  <div id="data-check-modal" class="modal-overlay hidden">
      <div class="modal-content">
          <h3 class="modal-title">确认数据结构修复</h3>
          <p id="data-check-modal-message"></p>
          <div class="diff-container">
              <div class="diff-view">
                  <h4>修复前</h4>
                  <pre id="data-check-diff-before"></pre>
              </div>
              <div class="diff-view">
                  <h4>修复后</h4>
                  <pre id="data-check-diff-after"></pre>
              </div>
          </div>
          <div class="modal-actions" id="data-check-modal-actions">
              <button id="data-check-cancel-btn" class="button-like">取消</button>
              <button id="data-check-confirm-btn" class="button-like primary">确认修复</button>
          </div>
      </div>
  </div>

  <!-- Help Panel Modal -->
  <div id="helpPanel" class="modal-overlay hidden">
      <div class="help-content-wrapper">
          <div class="help-header">
              <h2>Jav 助手 - 功能说明</h2>
              <button id="closeHelpBtn" title="关闭">&times;</button>
          </div>
          <div class="help-body">
              <!-- Help content will be dynamically loaded here -->
          </div>
      </div>
  </div>

  <!-- WebDAV 恢复弹窗 -->
  <div id="webdavRestoreModal" class="modal-overlay hidden">
      <div class="modal-content webdav-restore-modal">
          <div class="modal-header">
              <h3>
                  <i class="fas fa-cloud-download-alt"></i>
                  从云端恢复数据
              </h3>
              <button class="modal-close" id="webdavRestoreModalClose">&times;</button>
          </div>

          <div class="modal-body">
              <div id="webdavRestoreLoading" class="restore-loading hidden">
                  <div class="loading-spinner">
                      <i class="fas fa-spinner fa-spin"></i>
                  </div>
                  <p>正在获取云端文件列表...</p>
              </div>

              <div id="webdavRestoreContent" class="restore-content hidden">
                  <div class="restore-description">
                      <p>选择要恢复的备份文件。恢复操作将覆盖本地数据，请谨慎操作。</p>
                  </div>

                  <div class="file-list-container">
                      <div class="file-list-header">
                          <h4>
                              <i class="fas fa-folder-open"></i>
                              可用的备份文件
                          </h4>
                      </div>
                      <div class="file-list-summary">
                          <div class="summary-item">
                              <i class="fas fa-database"></i>
                              <span>云端备份：</span><strong id="webdavBackupCount">-</strong> 个
                          </div>
                          <div class="summary-item">
                              <i class="fas fa-calendar-alt"></i>
                              <span>范围：</span><strong id="webdavBackupRange">-</strong>
                          </div>
                      </div>
                      <ul id="webdavFileList" class="webdav-file-list">
                          <!-- 文件列表将动态生成 -->
                      </ul>
                  </div>

                  <!-- 数据预览和分析阶段 -->
                  <div id="webdavDataPreview" class="data-preview hidden">
                      <!-- 快捷模式界面 -->
                      <!-- 简化的覆盖式恢复界面 -->
                      <div id="restoreMode" class="restore-mode-content active">
                          <div class="restore-summary-card">
                              <div class="summary-header">
                                  <i class="fas fa-sync-alt"></i>
                                  <h3>云端备份统计</h3>
                              </div>
                              <div class="summary-stats" id="restoreModeStats">
                                  <div class="stat-item">
                                      <span class="stat-number" id="quickVideoCount">-</span>
                                      <span class="stat-label">视频记录</span>
                                  </div>
                                  <div class="stat-item">
                                      <span class="stat-number" id="quickActorCount">-</span>
                                      <span class="stat-label">演员收藏</span>
                                  </div>
                                  <div class="stat-item">
                                      <span class="stat-number" id="quickNewWorksSubsCount">-</span>
                                      <span class="stat-label">新作品订阅</span>
                                  </div>
                                  <div class="stat-item">
                                      <span class="stat-number" id="quickNewWorksRecsCount">-</span>
                                      <span class="stat-label">新作品记录</span>
                                  </div>
                                  
                              </div>
                              <div class="restore-action">
                                  <button class="btn btn-primary btn-large" id="quickRestoreBtn">
                                      <i class="fas fa-download"></i>
                                      开始覆盖式恢复
                                  </button>
                              </div>
                          </div>
                      </div>
                      <div class="restore-options-section">
                          <h5>
                              <i class="fas fa-check-square"></i>
                              恢复内容选择
                          </h5>
                          <div class="restore-options-grid">
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreSettings" checked>
                                  <label for="webdavRestoreSettings">
                                      <i class="fas fa-cogs"></i>
                                      扩展设置
                                  </label>
                                  <small>WebDAV配置、搜索引擎、显示设置等</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreRecords" checked>
                                  <label for="webdavRestoreRecords">
                                      <i class="fas fa-database"></i>
                                      观看记录
                                  </label>
                                  <small>已观看、我想看、已浏览等状态记录</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreUserProfile" checked>
                                  <label for="webdavRestoreUserProfile">
                                      <i class="fas fa-user-circle"></i>
                                      账号信息
                                  </label>
                                  <small>JavDB账号邮箱、用户名、用户类型等</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreActorRecords" checked>
                                  <label for="webdavRestoreActorRecords">
                                      <i class="fas fa-users"></i>
                                      演员库
                                  </label>
                                  <small>收藏的演员信息、性别、分类等数据</small>
                              </div>
                              <div class="form-group-checkbox available">
                                  <input type="checkbox" id="webdavRestoreLogs">
                                  <label for="webdavRestoreLogs">
                                      <i class="fas fa-file-alt"></i>
                                      日志记录
                                  </label>
                                  <small>扩展运行日志，用于故障排查（可选）</small>
                              </div>
                              <div class="form-group-checkbox available">
    <input type="checkbox" id="webdavRestoreMagnets">
    <label for="webdavRestoreMagnets">
        <i class="fas fa-magnet"></i>
        &#30913;&#38142;&#32531;&#23384;
    </label>
    <small>&#x78C1;&#x94FE;&#x89E3;&#x6790;&#x4E0E;&#x7F13;&#x5B58;&#x6570;&#x636E;&#xFF08;&#x53EF;&#x9009;&#xFF09;</small>
</div>
<div class="form-group-checkbox available">
                                  <input type="checkbox" id="webdavRestoreNewWorks" checked>
                                  <label for="webdavRestoreNewWorks">
                                      <i class="fas fa-bell"></i>
                                      新作品（订阅/记录/配置）
                                  </label>
                                  <small>演员订阅、新作品采集记录以及新作品全局配置</small>
                              </div>
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavRestoreImportStats" checked>
                                  <label for="webdavRestoreImportStats">
                                      <i class="fas fa-chart-bar"></i>
                                      导入统计
                                  </label>
                                  <small>最后一次导入的统计信息（可选）</small>
                              </div>
                          </div>
                      </div>

                      <!-- 恢复前自动备份选项 -->
                      <div class="restore-options-section">
                          <h5>
                              <i class="fas fa-shield-alt"></i>
                              安全选项
                          </h5>
                          <div class="restore-options-grid">
                              <div class="form-group-checkbox">
                                  <input type="checkbox" id="webdavAutoBackupBeforeRestore" checked>
                                  <label for="webdavAutoBackupBeforeRestore">
                                      <i class="fas fa-save"></i>
                                      恢复前自动备份
                                  </label>
                                  <small>在执行恢复前自动创建当前数据的备份（推荐）</small>
                              </div>
                          </div>
                      </div>

                      <div class="impact-preview">
                          <h5>
                              <i class="fas fa-exclamation-triangle"></i>
                              影响预览
                          </h5>
                          <div class="impact-summary" id="impactSummary">
                              <!-- 动态生成影响预览内容 -->
                          </div>
                      </div>
                      </div> <!-- 关闭 expertMode -->

                  </div> <!-- 关闭 webdavDataPreview -->


                  <!-- 原有的简单恢复选项（向后兼容，隐藏） -->
                  <div id="webdavRestoreOptions" class="restore-options hidden" style="display: none;">
                      <h4>
                          <i class="fas fa-cog"></i>
                          恢复选项
                      </h4>
                      <div class="restore-options-grid">
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreSettingsSimple" checked>
                              <label for="webdavRestoreSettingsSimple">
                                  <i class="fas fa-cogs"></i>
                                  扩展设置
                              </label>
                              <small>WebDAV配置、搜索引擎、显示设置等</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreRecordsSimple" checked>
                              <label for="webdavRestoreRecordsSimple">
                                  <i class="fas fa-database"></i>
                                  观看记录
                              </label>
                              <small>已观看、我想看、已浏览等状态记录</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreUserProfileSimple" checked>
                              <label for="webdavRestoreUserProfileSimple">
                                  <i class="fas fa-user-circle"></i>
                                  账号信息
                              </label>
                              <small>JavDB账号邮箱、用户名、用户类型等</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreActorRecordsSimple" checked>
                              <label for="webdavRestoreActorRecordsSimple">
                                  <i class="fas fa-users"></i>
                                  演员库
                              </label>
                              <small>收藏的演员信息、性别、分类等数据</small>
                          </div>
                          <div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreLogsSimple">
                              <label for="webdavRestoreLogsSimple">
                                  <i class="fas fa-file-alt"></i>
                                  日志记录
                              </label>
                              <small>扩展运行日志，用于故障排查（可选）</small>
                          </div>
                          <div class="form-group-checkbox">
    <input type="checkbox" id="webdavRestoreMagnetsSimple">
    <label for="webdavRestoreMagnetsSimple">
        <i class="fas fa-magnet"></i>
        &#30913;&#38142;&#32531;&#23384;
    </label>
    <small>&#x78C1;&#x94FE;&#x89E3;&#x6790;&#x4E0E;&#x7F13;&#x5B58;&#x6570;&#x636E;&#xFF08;&#x53EF;&#x9009;&#xFF09;</small>
</div>
<div class="form-group-checkbox">
                              <input type="checkbox" id="webdavRestoreImportStatsSimple" checked>
                              <label for="webdavRestoreImportStatsSimple">
                                  <i class="fas fa-chart-bar"></i>
                                  导入统计
                              </label>
                              <small>最后一次导入的统计信息（可选）</small>
                          </div>
                      </div>
                  </div>
              </div>

              </div> <!-- 关闭 webdavRestoreContent -->

              <div id="webdavRestoreError" class="restore-error hidden">
                  <div class="error-icon">
                      <i class="fas fa-exclamation-triangle"></i>
                  </div>
                  <h4>获取文件列表失败</h4>
                  <p id="webdavRestoreErrorMessage">请检查WebDAV设置是否正确。</p>
                  <button id="webdavRestoreRetry" class="btn btn-primary">
                      <i class="fas fa-redo"></i>
                      重试
                  </button>
              </div>
          </div>

          <div class="modal-footer" style="position: relative !important; z-index: 9999 !important; display: flex !important; justify-content: flex-end !important; gap: 16px !important;">
              <button id="webdavRestoreBack" class="btn btn-secondary hidden">
                  <i class="fas fa-arrow-left"></i>
                  返回
              </button>
              <button id="webdavRestoreCancel" class="btn btn-secondary">取消</button>
              
              <button id="webdavRestoreConfirm" class="btn btn-primary" disabled>
                  <i class="fas fa-download"></i>
                  开始覆盖式恢复
              </button>
          </div>
      </div>
  </div>

  <!-- 冲突解决弹窗 -->
  <div id="conflictResolutionModal" class="modal-overlay hidden">
      <div class="modal-content conflict-resolution-modal">
          <div class="modal-header">
              <h3>
                  <i class="fas fa-exclamation-triangle"></i>
                  解决数据冲突
              </h3>
              <button class="modal-close" id="conflictResolutionModalClose">&times;</button>
          </div>

          <div class="modal-body">
              <div class="conflict-navigation">
                  <div class="conflict-info">
                      <p>请选择每个冲突项的保留方式，完成后点击确认应用解决方案</p>
                      <small>您可以使用批量操作快速处理多个冲突项</small>
                  </div>
              </div>

              <div class="conflict-details">
                  <div class="conflict-item-header">
                      <h4 id="conflictItemTitle">SSIS-001</h4>
                      <span class="conflict-type" id="conflictItemType">视频记录</span>
                  </div>

                  <div class="conflict-comparison">
                      <div class="version-column local-version">
                          <div class="version-header">
                              <i class="fas fa-hdd"></i>
                              <span>本地版本</span>
                              <small id="localVersionTime">2024-01-01 14:30</small>
                          </div>
                          <div class="version-content" id="localVersionContent">
                              <!-- 动态生成本地版本内容 -->
                          </div>
                      </div>

                      <div class="version-column cloud-version">
                          <div class="version-header">
                              <i class="fas fa-cloud"></i>
                              <span>云端版本</span>
                              <small id="cloudVersionTime">2024-01-01 16:45</small>
                          </div>
                          <div class="version-content" id="cloudVersionContent">
                              <!-- 动态生成云端版本内容 -->
                          </div>
                      </div>
                  </div>

                  <div class="resolution-options">
                      <h5>选择保留:</h5>
                      <div class="resolution-buttons">
                          <label class="resolution-option">
                              <input type="radio" name="currentResolution" value="local">
                              <span class="resolution-label">
                                  <i class="fas fa-hdd"></i>
                                  保留本地
                              </span>
                          </label>
                          <label class="resolution-option">
                              <input type="radio" name="currentResolution" value="cloud">
                              <span class="resolution-label">
                                  <i class="fas fa-cloud"></i>
                                  保留云端
                              </span>
                          </label>
                          <label class="resolution-option">
                              <input type="radio" name="currentResolution" value="merge" checked>
                              <span class="resolution-label">
                                  <i class="fas fa-code-branch"></i>
                                  &#x6062;&#x590D;&#x65B9;&#x5F0F;&#x9009;&#x62E9;&#xFF08;&#x8986;&#x76D6;&#x5F0F;&#xFF09;
                              </span>
                          </label>
                      </div>
                  </div>

                  <div class="batch-operations">
                      <h5>批量操作:</h5>
                      <div class="batch-buttons">
                          <button id="batchSelectLocal" class="btn btn-sm btn-outline">
                              <i class="fas fa-hdd"></i>
                              全选本地
                          </button>
                          <button id="batchSelectCloud" class="btn btn-sm btn-outline">
                              <i class="fas fa-cloud"></i>
                              全选云端
                          </button>
                          <button id="batchSelectMerge" class="btn btn-sm btn-outline">
                              <i class="fas fa-code-branch"></i>
                              &#x6062;&#x590D;&#x65B9;&#x5F0F;&#x9009;&#x62E9;&#xFF08;&#x8986;&#x76D6;&#x5F0F;&#xFF09;
                          </button>
                      </div>
                  </div>
              </div>
          </div>

          <div class="modal-footer conflict-footer">
              <div class="footer-left">
                  <div class="conflict-progress">
                      <span class="progress-text">
                          冲突 <span id="currentConflictIndex">1</span> / <span id="totalConflictsCount">0</span>
                      </span>
                      <div class="progress-bar">
                          <div class="progress-fill" id="conflictProgressFill"></div>
                      </div>
                  </div>
              </div>

              <div class="footer-center">
                  <div class="nav-buttons">
                      <button id="prevConflict" class="btn btn-nav" title="上一个冲突">
                          <i class="fas fa-chevron-left"></i>
                          上一个
                      </button>
                      <button id="nextConflict" class="btn btn-nav" title="下一个冲突">
                          下一个
                          <i class="fas fa-chevron-right"></i>
                      </button>
                  </div>
              </div>

              <div class="footer-right">
                  <button id="conflictResolutionCancel" class="btn btn-secondary">
                      <i class="fas fa-times"></i>
                      取消
                  </button>
                  <button id="conflictResolutionConfirm" class="btn btn-primary">
                      <i class="fas fa-check"></i>
                      确认解决方案
                  </button>
              </div>
          </div>
      </div>
  </div>

  <!-- 恢复结果摘要弹窗 -->
  <div id="restoreResultModal" class="modal-overlay hidden">
      <div class="modal-content restore-result-modal">
          <div class="modal-header">
              <h3>
                  <i class="fas fa-check-circle"></i>
                  恢复完成
              </h3>
              <button class="modal-close" id="restoreResultModalClose">&times;</button>
          </div>

          <div class="modal-body">
              <div class="result-summary">
                  <div class="result-icon success">
                      <i class="fas fa-check-circle"></i>
                  </div>
                  <h4>数据恢复成功</h4>
                  <p>已成功从云端恢复数据并应用到本地。</p>
              </div>

              <div class="operation-summary">
                  <h5>
                      <i class="fas fa-chart-bar"></i>
                      操作摘要
                  </h5>
                  <div class="summary-grid" id="operationSummaryGrid">
                      <!-- 动态生成操作摘要 -->
                  </div>
              </div>

              <div class="backup-info">
                  <h5>
                      <i class="fas fa-shield-alt"></i>
                      安全备份
                  </h5>
                  <p>已自动备份原数据到:</p>
                  <div class="backup-file-info">
                      <code id="backupFileName">backup-before-restore-20240101.json</code>
                      <button id="downloadBackup" class="btn btn-sm btn-outline">
                          <i class="fas fa-download"></i>
                          下载备份
                      </button>
                  </div>
              </div>
      </div>

      <div class="modal-footer" style="position: relative; z-index: 9999; display: flex; justify-content: flex-end; gap: 16px;">
          <button id="restoreResultViewDetails" class="btn btn-secondary">查看详情</button>
          <button id="restoreResultConfirm" class="btn btn-primary">
              <i class="fas fa-check"></i>
              确定
          </button>
          </div>
      </div>
  </div>

  <!-- 数据查看弹窗 -->
  <div id="dataViewModal" class="modal">
      <div class="modal-overlay">
          <div class="modal-content data-view-modal">
              <div class="modal-header">
                  <h3 id="dataViewModalTitle">数据查看</h3>
                  <button class="modal-close" id="dataViewModalClose">&times;</button>
              </div>
              <div class="modal-body">
                  <div class="data-view-controls">
                      <div class="control-group">
                          <button id="dataViewEditBtn" class="btn btn-secondary">编辑</button>
                          <button id="dataViewSaveBtn" class="btn btn-primary hidden">保存</button>
                          <button id="dataViewCancelBtn" class="btn btn-secondary hidden">取消</button>
                          <button id="dataViewCopyBtn" class="btn btn-outline">复制</button>
                          <button id="dataViewDownloadBtn" class="btn btn-outline">下载</button>
                      </div>
                      <div class="data-info">
                          <span id="dataViewInfo" class="data-info-text"></span>
                      </div>
                  </div>
                  <div class="data-view-container">
                      <textarea id="dataViewTextarea" readonly></textarea>
                  </div>
              </div>
              <div class="modal-footer" style="position: relative !important; z-index: 9999 !important; display: flex !important; justify-content: flex-end !important; gap: 16px !important;">
                  <button id="dataViewCloseBtn" class="btn btn-secondary">关闭</button>
              </div>
          </div>
      </div>
  </div>
